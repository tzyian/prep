/* Autogenerated by esbuild. Source code available in the pluginâ€™s repository: https://github.com/Ssentiago/image-zoom-drag */
"use strict";var R=require("obsidian");let Gs=class extends R.Component{observer=null;subscribers=new Map;constructor(){super(),this.load(),this.enable()}enable(){this.observer=new MutationObserver(async e=>{for(const n of e)await this.processMutation(n)}),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0})}async processMutation(e){for(const[n,i]of this.subscribers)n(e)&&await i(e)}onunload(){super.onunload(),this.observer?.disconnect(),this.subscribers.clear()}subscribe(e,n){this.subscribers.set(e,n)}unsubscribe(e){this.subscribers.delete(e)}};function hi(t){return t.closest(".workspace-leaf-content")?.dataset.type==="markdown"}function Ut(t){if(!(t instanceof SVGElement))return!1;const e=t;if(e.closest("button")||e.closest(".edit-block-button")||e.classList.contains("svg-icon"))return!0;const n=e.getBoundingClientRect();if(n.width>0&&n.width<=32&&n.height>0&&n.height<=32)return!0;const i=e.parentElement;if(i){const o=i.getBoundingClientRect();if(o.width>0&&o.width<=32&&o.height>0&&o.height<=32)return!0}return!1}let Ws=class{constructor(e){this.leafIndex=e}enable(){this.leafIndex.plugin.registerMarkdownPostProcessor((e,n)=>{this.processPreviewImages(e,n),this.observePreviewChanges(e,n)}),this.startLivePreviewObserver()}disable(){this.mutationObserver?.disconnect()}processPreviewImages(e,n){this.findImages(e).forEach(i=>{const o=this.getPreviewSource({context:n,contextEl:e}),s=this.getImageOrigin(i,o),r={sourceData:o,element:i,origin:s,elementType:i instanceof HTMLImageElement?"img":"svg",mode:"preview"};this.finalizePreviewSource(r),this.leafIndex.pushImageContext(r)})}observePreviewChanges(e,n){const i=new MutationObserver(o=>{for(const s of this.filteredMutations(o))for(const r of this.getAddedImages(s.addedNodes)){const l=this.getPreviewSource({context:n,contextEl:e}),d=this.getImageOrigin(r,l),u={sourceData:l,element:r,origin:d,elementType:r instanceof HTMLImageElement?"img":"svg",mode:"preview"};this.finalizePreviewSource(u),this.leafIndex.pushImageContext(u)}});i.observe(e,{childList:!0,subtree:!0}),setTimeout(()=>{i.disconnect()},5e3)}startLivePreviewObserver(){this.leafIndex.activeLeafContext&&(this.mutationObserver=new MutationObserver(e=>{for(const n of this.filteredMutations(e))if(!(!(n.target instanceof Element)||!n.target.closest(".markdown-source-view")))for(const i of this.getAddedImages(n.addedNodes)){const o=this.getLivePreviewSource(i),s={origin:this.getImageOrigin(i,o),sourceData:o,element:i,elementType:i instanceof HTMLImageElement?"img":"svg",mode:"live-preview"};this.leafIndex.pushImageContext(s)}}),this.mutationObserver.observe(this.leafIndex.activeLeafContext.view.containerEl,{childList:!0,subtree:!0}))}*filteredMutations(e){for(const n of e)n.type==="childList"&&(yield n)}findImages(e){return Array.from(e.querySelectorAll("img, svg")).filter(n=>!Ut(n))}*getAddedImages(e){for(const n of Array.from(e)){if(!(n instanceof Element))continue;const i=n.matches("svg,img")&&n||n.querySelector("svg,img");!i||Ut(i)||i.matches(".cm-widgetBuffer")||(yield i)}}getPreviewSource(e){const n=e.context.getSectionInfo(e.contextEl);if(!n)return{source:"No source available",lineStart:0,lineEnd:0};if(n.lineEnd===n.lineStart)return{source:n.text,lineStart:n.lineStart,lineEnd:n.lineEnd};const{lineStart:i,lineEnd:o,text:s}=n,r=i,l=o;return{source:s.split(`
`).slice(r,l+1).join(`
`),lineStart:r,lineEnd:l}}getLivePreviewSource(e){const n=this.findElementWithLivePreviewWidget(e)?.cmView?.deco?.widget,i={source:"No source available",lineStart:0,lineEnd:0};return n===void 0?i:"title"in n&&"href"in n&&"start"in n&&"end"in n?{source:`![[${n.href}]]`,lineStart:n.start,lineEnd:n.end}:"url"in n&&"start"in n&&"end"in n?{source:`![${n.title||""}](${n.url})`,lineStart:n.start,lineEnd:n.end}:"code"in n&&"lineStart"in n&&"lineEnd"in n&&"lang"in n?{source:`\`\`\`${n.lang}
${n.code}
\`\`\``,lineStart:n.lineStart,lineEnd:n.lineEnd}:i}findElementWithLivePreviewWidget(e){if(e===void 0)return;let n=e;for(;n&&n!==document.body;){if(n?.cmView)return n;n=n?.parentElement}}getImageOrigin(e,n){return/^```[^\n]+?\n?[\s\S]+?\n?```$/.test(n.source)?"generated":"src"in e&&/^https?:\/\//.test(e.src)?"external":"local"}finalizePreviewSource(e){if(e.origin!=="generated"){const n="alt"in e.element?e.element.alt:"",i="src"in e.element?e.element.src:"",o={lineStart:0,lineEnd:0,source:`![${n}](${i})`};e.sourceData=o}}},Ys=class extends R.Component{constructor(e){super(),this.plugin=e,this.load(),this.setupObsidianEventHandlers()}data=new Map;setupObsidianEventHandlers(){this.plugin.app.workspace.on("layout-change",async()=>{await this.updateIndex()}),this.plugin.app.workspace.on("active-leaf-change",async()=>{await this.updateIndex()})}async updateIndex(){await this.cleanupActiveLeaf(),await this.initializeActiveLeaf(),await this.setupImageIndexer()}async setupImageIndexer(){if(!this.activeLeafContext?.id)return;const e=this.data.get(this.activeLeafContext.id);e&&(e.indexer||(e.indexer=new Ws(this),e.indexer?.enable()))}async onunload(){for(const e of this.data.keys())await this.cleanupLeafData(e)}async initializeActiveLeaf(){const e=this.plugin.app.workspace.getActiveViewOfType(R.MarkdownView);e&&(this.activeLeafContext={id:e.leaf.id,view:e},this.initializeLeafData(this.activeLeafContext))}async cleanupActiveLeaf(){this.activeLeafContext?.id&&this.plugin.app.workspace.getLeafById(this.activeLeafContext.id)===null&&(await this.cleanupLeafData(this.activeLeafContext.id),this.activeLeafContext=void 0)}initializeLeafData(e){this.data.get(e.id)||(this.data.set(e.id,{imageIndex:new Map,indexer:void 0}),this.plugin.logger.debug(`Initialized data for leaf width id: ${e.id}...`,{functionName:"initializeLeafData",lineNumber:96,columnNumber:2646,fileName:"src\\core\\services\\leaf-index\\leaf-index.ts"}))}async cleanupLeafData(e){if(!this.data.get(e)){this.plugin.logger.error("No data for leaf",{leafID:e,functionName:"cleanupLeafData",lineNumber:104,columnNumber:3065,fileName:"src\\core\\services\\leaf-index\\leaf-index.ts"});return}this.data.delete(e),this.plugin.logger.debug(`Data for leaf with id ${e} was cleaned successfully.`,{functionName:"cleanupLeafData",lineNumber:111,columnNumber:3391,fileName:"src\\core\\services\\leaf-index\\leaf-index.ts"})}finalizeElementContext(e){if(!(!e.element||!e.elementType||!e.origin||!e.mode||!e.sourceData))return e}pushImageContext(e){if(!this.activeLeafContext)return;const n=this.finalizeElementContext(e);if(!n){this.plugin.logger.warn("Invalid image context data, cannot push to index.",{functionName:"pushImageContext",lineNumber:137,columnNumber:4247,fileName:"src\\core\\services\\leaf-index\\leaf-index.ts"});return}const i=this.data.get(this.activeLeafContext.id);i&&(i.imageIndex.get(n.element)||(i.imageIndex.set(n.element,n),this.plugin.emitter.emit("leaf-index.image.added",n)))}},Ks=class{constructor(e){this.plugin=e}isFirstLaunch=!1;shouldShowTips=!1;async initialize(){this.isFirstLaunch=await this.getIsFirstLaunch(),this.shouldShowTips=this.getShouldShowTips()}async getIsFirstLaunch(){const e=await this.getPluginCtime(),n=this.plugin.app.loadLocalStorage("izd-ctime");return typeof n!="string"?(this.plugin.app.saveLocalStorage("izd-ctime",e),!0):n===e?!1:(this.plugin.app.saveLocalStorage("izd-ctime",e),!0)}getShouldShowTips(){if(typeof this.plugin.app.loadLocalStorage("izd-should-show-tips")=="string")return!1;const e=this.plugin.app.loadLocalStorage("izd-ctime");if(typeof e!="string")return!0;const n=R.moment(Number(e)),i=R.moment().diff(n,"weeks")>=1;return i&&this.markTipsViewed(),!i}markTipsViewed(){this.plugin.app.saveLocalStorage("izd-should-show-tips","viewed")}async getPluginCtime(){const e=this.plugin.manifest.dir;if(!e)throw new Error("Plugin directory not found in manifest");return((await this.plugin.app.vault.adapter.stat(e))?.ctime??0).toString()}};function ie(t,e){return t.replace(/\{\{(\w+)\}\}/g,(n,i)=>e[i]??`{{${i}}}`)}let f;async function qs(){f=(await Promise.resolve().then(function(){return Uu})).t}const Zs=qs();class Xs{constructor(e){this.integratedMode=e}get leafID(){return this.leaf&&this.leaf.id}get active(){return this.leaf!==void 0&&this.view!==void 0&&this.view.file!==null}get inPreviewMode(){return this.view?.getState()?.mode==="preview"}get inLivePreviewMode(){const e=this.view?.getState();return!e?.source&&e?.mode==="source"}get nativeTouchEventsEnabled(){const e=this.integratedMode.state.data.get(this.leafID);if(e)return e.nativeTouchEventsEnabled}initialize(e){const n=this.integratedMode.plugin.app.workspace.getActiveViewOfType(R.MarkdownView);n&&(this.leaf=n.leaf,this.view=n,e(this.leafID))}cleanup(e){this.leaf&&this.integratedMode.plugin.app.workspace.getLeafById(this.leafID)===null&&(e(this.leafID),this.view=void 0,this.leaf=void 0)}getAvailableSize(){if(!this.active)return{width:0,height:0};const e=this.inPreviewMode?".markdown-preview-view":".markdown-source-view",n=this.view.contentEl.querySelector(e);if(!n)return{width:0,height:0};const i=n.querySelector(".markdown-preview-sizer, .cm-sizer"),o=i&&parseInt(window.getComputedStyle(i).marginLeft)||0;return{width:n.clientWidth*.9-o,height:n.clientHeight*.9}}}var Me=(t=>(t.Default=".izd-default",t.IMG_SVG="img,svg",t.Mermaid=".mermaid",t.Mehrmaid=".block-language-mehrmaid",t.PlantUML=".block-language-plantuml",t.Graphviz=".block-language-dot",t))(Me||{}),Z=(t=>(t[t.NONE=1]="NONE",t[t.MOUSE=2]="MOUSE",t[t.FOCUS=4]="FOCUS",t[t.KEYPRESS=8]="KEYPRESS",t[t.FOLD=16]="FOLD",t[t.FORCE=32]="FORCE",t[t.SERVICE_HIDING=64]="SERVICE_HIDING",t))(Z||{}),jt=(t=>(t.Interactive="interactive",t.NonInteractive="non-interactive",t))(jt||{}),vt=(t=>(t.Initialized="initialized",t.NotInitialized="not-initialized",t))(vt||{});class Js{constructor(e){this.unit=e}moveElement(e,n,i){const o=this.unit.context.content;this.unit.dx+=e,this.unit.dy+=n,o.setCssStyles({transition:i?.animated?"transform 0.3s ease-out":"none",transform:`translate(${this.unit.dx}px, ${this.unit.dy}px) scale(${this.unit.scale})`}),i?.animated&&this.unit.registerDomEvent(o,"transitionend",()=>{o.setCssStyles({transition:"none"})},{once:!0})}zoomElement(e,n){const{content:i,container:o}=this.unit.context,s=o.getBoundingClientRect(),r=s.left+s.width/2,l=s.top+s.height/2,d=i.getBoundingClientRect(),u=d.left+d.width/2,p=d.top+d.height/2,c=(r-u)/this.unit.scale,v=(l-p)/this.unit.scale;this.unit.scale*=e,this.unit.scale=Math.max(.125,this.unit.scale),this.unit.dx=this.unit.dx-c*(e-1)*this.unit.scale/e,this.unit.dy=this.unit.dy-v*(e-1)*this.unit.scale/e,i.setCssStyles({transition:n?.animated?"transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1)":"none",transform:`translate(${this.unit.dx}px, ${this.unit.dy}px) scale(${this.unit.scale})`}),n?.animated&&this.unit.registerDomEvent(i,"transitionend",()=>{i.setCssStyles({transition:"none"})},{once:!0})}resetZoomAndMove(e){this.fitToContainer(e)}fitToContainer(e){const{content:n,container:i}=this.unit.context,o=i.clientWidth,s=i.clientHeight,r=n.clientWidth,l=n.clientHeight;this.unit.scale=Math.min(o/r,s/l,1),this.unit.dx=(o-r*this.unit.scale)/2,this.unit.dy=(s-l*this.unit.scale)/2,n.setCssStyles({transition:e?.animated?"transform 0.3s cubic-bezier(0.42, 0, 0.58, 1)":"none",transform:`translate(${this.unit.dx}px, ${this.unit.dy}px) scale(${this.unit.scale})`,transformOrigin:"top left"}),e?.animated&&this.unit.registerDomEvent(n,"transitionend",()=>{n.setCssStyles({transition:"none"})},{once:!0})}async toggleFullscreen(){const e=this.unit.context.container;document.fullscreenElement?(e.removeClass("is-fullscreen"),await document.exitFullscreen()):(e.addClass("is-fullscreen"),await e.requestFullscreen({navigationUI:"auto"})),requestAnimationFrame(()=>{this.resetZoomAndMove()})}}function je(t,e,n){e&&R.setIcon(t,e),n&&R.setTooltip(t,n)}class xt extends R.Component{constructor(e){super(),this.controlPanel=e}setupPanelContents(){this.getButtonsConfig().forEach(e=>{const n=this.createButton(e.icon,e.action,e.title,e.id,e.gridArea);this.buttons.set(e.id,{element:n,listener:e.action}),e.dataAttributes&&Object.entries(e.dataAttributes).forEach(([i,o])=>{n.setAttribute(i,o)}),this.panel.appendChild(n)})}get unit(){return this.controlPanel.unit}initialize(){if(!this.enabled)return;const e=["izd-fold-panel","izd-tip-panel"];!this.controlPanel.canRender&&!e.includes(this.cssClass)||(this.panel=this.createPanelElement(),this.setupPanelContents(),this.visibilityInitialization())}createPanelElement(){const e=this.controlPanel.controlPanel.createEl("div");return e.addClass(this.cssClass),e.addClass("izd-panel"),e.addClass("visible"),e.setCssStyles(this.cssStyles),e}createButton(e,n,i,o,s){const r=document.createElement("button");return r.id=o,r.setCssStyles({background:"transparent",border:"none",color:"var(--text-muted)",cursor:"pointer",padding:"4px",borderRadius:"3px",display:"flex",justifyContent:"center",alignItems:"center",transition:"background-color 0.2s ease",gridArea:s??"unset"}),je(r,e,i),this.registerDomEvent(r,"click",n),this.registerDomEvent(r,"mouseenter",()=>{r.setCssStyles({color:"var(--interactive-accent)"})}),this.registerDomEvent(r,"mouseleave",()=>{r.setCssStyles({color:"var(--text-muted)"})}),r}visibilityInitialization(){const e=this.controlPanel.unit.plugin.settings.$.panels.global.triggering.mode,n=this.controlPanel.unit.context.container.dataset.folded==="true";let i=Z.NONE;n&&(i|=Z.FOLD),e==="focus"&&(i|=Z.FOCUS),e==="hover"&&(i|=Z.MOUSE),this.hide(i)}show(e){this.shouldRespondToTrigger(e)&&this.panel&&(this.panel.removeClass("hidden"),this.panel.addClass("visible"))}hide(e){this.shouldRespondToTrigger(e)&&this.panel&&(this.panel.removeClass("visible"),this.panel.addClass("hidden"))}isVisible(){return this.panel?.classList?.contains("visible")&&!this.panel.classList.contains("hidden")}shouldRespondToTrigger(e){return e===Z.FORCE?!0:!!(this.supportedTriggers&e)}get supportedTriggers(){const e=this.unit.plugin.settings.$.panels.global.triggering;let n=Z.FORCE|Z.FOLD|Z.SERVICE_HIDING;return e.mode==="hover"&&(n=n|Z.MOUSE),e.mode==="focus"&&(n=n|Z.FOCUS),n}onunload(){super.onunload()}}var xn=(t=>(t.Fold="fold",t))(xn||{}),Pe=(t=>(t.Up="up",t.Down="down",t.Left="left",t.Right="right",t.UpRight="upRight",t.UpLeft="upLeft",t.DownLeft="downLeft",t.DownRight="downRight",t))(Pe||{}),Ue=(t=>(t.Hide="hide",t.Fullscreen="fullscreen",t.Touch="touch",t))(Ue||{}),Dt=(t=>(t.In="in",t.Out="out",t.Reset="reset",t))(Dt||{}),lo=(t=>(t.Ribbon="ribbon",t))(lo||{});let Qs=class extends xt{constructor(e){super(e),this.controlPanel=e,this.setupSubscriptions()}buttons=new Map;title={folded:f("g"),expanded:f("f")};get enabled(){return!0}get cssStyles(){return{position:"absolute",left:"50%",bottom:"0",transform:"translateX(-50%)",gridTemplateColumns:"1fr"}}get cssClass(){return"izd-fold-panel"}getButtonsConfig(){return this.unit.context.container.setAttribute("data-folded",this.unit.plugin.settings.$.units.folding.foldByDefault.toString()),[{icon:"",action:()=>{this.unit.context.container.dataset.folded==="true"?this.unfold():this.fold()},title:"",id:xn.Fold}]}fold(){this.unit.context.container.setAttribute("data-folded","true"),this.unit.applyLayout(),this.controlPanel.hide(Z.FOLD)}unfold(){this.unit.context.container.setAttribute("data-folded","false"),this.unit.applyLayout(),this.controlPanel.show(Z.FOLD)}get supportedTriggers(){return super.supportedTriggers&~Z.FOLD&~Z.SERVICE_HIDING&~Z.FOCUS&~Z.MOUSE}setupSubscriptions(){const e=n=>n.target===this.unit.context.container&&n.type==="attributes"&&n.attributeName==="data-folded";this.register(()=>this.unit.plugin.domWatcher.unsubscribe(e)),this.unit.plugin.domWatcher.subscribe(e,n=>{if(!(n.target instanceof HTMLElement))return;const i=n.target.dataset.folded==="true",o=this.buttons.get(xn.Fold);o&&je(o.element,i?"unfold-vertical":"fold-vertical",this.title[i?"folded":"expanded"])})}};var Ke=(t=>(t.ALWAYS="always",t.HOVER="hover",t.FOCUS="focus",t))(Ke||{}),co=(t=>(t.None="none",t.Debug="debug",t.Info="info",t.Warn="warn",t.Error="error",t))(co||{});class er extends xt{buttons=new Map;constructor(e){super(e)}get enabled(){return this.unit.plugin.settings.$.panels.local.panels.move.on&&this.unit.context.options.panels.move?.on}get cssClass(){return"izd-move-panel"}get cssStyles(){return{...this.unit.plugin.settings.$.panels.local.panels.move.position,gridTemplateColumns:"repeat(3, 1fr)",gridTemplateRows:"repeat(3, 1fr)"}}getButtonsConfig(){const e=this.unit.plugin.settings.$.panels.local.panels.move.buttons;return[{id:Pe.UpLeft,icon:"arrow-up-left",title:f("p"),gridArea:"1 / 1",x:50,y:50},{id:Pe.Up,icon:"arrow-up",title:f("o"),gridArea:"1 / 2",x:0,y:50},{id:Pe.UpRight,icon:"arrow-up-right",title:f("q"),gridArea:"1 / 3",x:-50,y:50},{id:Pe.Left,icon:"arrow-left",title:f("p"),gridArea:"2 / 1",x:50,y:0},{id:Pe.Right,icon:"arrow-right",title:f("n"),gridArea:"2 / 3",x:-50,y:0},{id:Pe.DownLeft,icon:"arrow-down-left",title:f("j"),gridArea:"3 / 1",x:50,y:-50},{id:Pe.Down,icon:"arrow-down",title:f("i"),gridArea:"3 / 2",x:0,y:-50},{id:Pe.DownRight,icon:"arrow-down-right",title:f("k"),gridArea:"3 / 3",x:-50,y:-50}].filter(n=>e[n.id]).map(n=>({id:n.id,icon:n.icon,action:()=>this.unit.actions.moveElement(n.x,n.y,{animated:!0}),title:n.title,gridArea:n.gridArea}))}setupPanelContents(){super.setupPanelContents(),this.panel.toggleClass("hidden",this.unit.plugin.settings.$.panels.global.triggering.mode!==Ke.ALWAYS)}}class tr extends xt{buttons=new Map;constructor(e){super(e)}initialize(){super.initialize(),this.setupEventListeners()}get enabled(){return this.unit.plugin.settings.$.panels.local.panels.service.on&&this.unit.context.options.panels.service.on}get cssClass(){return"izd-service-panel"}get cssStyles(){return{...this.unit.plugin.settings.$.panels.local.panels.service.position,gridTemplateColumns:"repeat(auto-fit, minmax(24px, 1fr))",gridAutoFlow:"column"}}getButtonsConfig(){const e=[],n=this.unit.plugin.settings.$.panels.local.panels.service.buttons;return n.hide&&e.push({id:Ue.Hide,icon:"eye",action:()=>{const i=this.buttons.get(Ue.Hide)?.element;if(!i)return;const o=i.dataset.hiding==="true",s=!o;i.dataset.hiding=s.toString(),o?this.controlPanel.show(Z.SERVICE_HIDING):this.controlPanel.hide(Z.SERVICE_HIDING),je(i,o?"eye":"eye-off",f(s?"u":"w"))},title:f("w"),dataAttributes:{hiding:"false"}}),n.fullscreen&&e.push({id:Ue.Fullscreen,icon:"maximize",action:async()=>{const i=this.buttons.get(Ue.Fullscreen)?.element;i&&(await this.unit.actions.toggleFullscreen(),document.fullscreenElement===this.unit.context.container?je(i,"maximize",f("t")):je(i,"minimize",f("s")))},title:f("t")}),e}setupPanelContents(){const e=this.unit.plugin.settings;this.panel.toggleClass("hidden",e.$.panels.global.triggering.mode!==Ke.ALWAYS&&!e.$.panels.global.triggering.ignoreService),super.setupPanelContents()}setupEventListeners(){this.buttons.get(Ue.Fullscreen)?.element&&this.registerDomEvent(this.unit.context.container,"fullscreenchange",this.onFullScreenChange)}onFullScreenChange=()=>{const e=this.buttons.get(Ue.Fullscreen)?.element;e&&(document.fullscreenElement?(requestAnimationFrame(()=>{this.unit.actions.resetZoomAndMove()}),je(e,"minimize",f("t"))):(requestAnimationFrame(()=>{this.unit.actions.resetZoomAndMove()}),je(e,"maximize",f("s"))))};get supportedTriggers(){const e=super.supportedTriggers&~Z.SERVICE_HIDING;if(!this.unit.plugin.settings.$.panels.global.triggering.ignoreService)return e;const n=Z.MOUSE|Z.FOCUS;return e&~n}}let nr=class extends xt{buttons=new Map;constructor(e){super(e)}get enabled(){return!0}get cssClass(){return"izd-tip-panel"}get cssStyles(){return{position:"absolute",left:"0%",top:"0%"}}getButtonsConfig(){const{plugin:e}=this.unit;return!e.userState.shouldShowTips||e.help.isHelpOpen?[]:[{id:lo.Ribbon,icon:"ribbon",action:()=>{this.unit.plugin.help.showModal("minimal")},title:"Tips"}]}get supportedTriggers(){return super.supportedTriggers}};class ir extends xt{buttons=new Map;constructor(e){super(e)}get enabled(){return this.controlPanel.unit.plugin.settings.$.panels.local.panels.zoom.on&&this.controlPanel.unit.context.options.panels.zoom.on}get cssClass(){return"izd-zoom-panel"}get cssStyles(){return{...this.controlPanel.unit.plugin.settings.$.panels.local.panels.zoom.position,transform:"translateY(-50%)",gridTemplateColumns:"1fr"}}getButtonsConfig(){const e=this.controlPanel.unit.plugin.settings.$.panels.local.panels.zoom.buttons,n=[];return e.in&&n.push({id:Dt.In,icon:"zoom-in",action:()=>this.controlPanel.unit.actions.zoomElement(1.1,{animated:!0}),title:f("y")}),e.reset&&n.push({id:Dt.Reset,icon:"refresh-cw",action:()=>this.controlPanel.unit.actions.resetZoomAndMove({animated:!0}),title:f("B")}),e.out&&n.push({id:Dt.Out,icon:"zoom-out",action:()=>this.controlPanel.unit.actions.zoomElement(.9,{animated:!0}),title:f("A")}),n}setupPanelContents(){this.panel.toggleClass("hidden",this.controlPanel.unit.plugin.settings.$.panels.global.triggering.mode!==Ke.ALWAYS),super.setupPanelContents()}}class Qe extends R.Component{constructor(e){super(),this.unit=e}static BUTTON_SIZE=34;static MIN_BUTTONS_HEIGHT=7;static MIN_BUTTONS_WIDTH=4;initialize(){this.load(),this.controlPanel=this.unit.context.container.createDiv(),this.controlPanel.addClass("izd-control-panel"),this.move=new er(this),this.zoom=new ir(this),this.fold=new Qs(this),this.service=new tr(this),this.tip=new nr(this),this.panels.forEach(e=>{this.addChild(e),e.initialize()}),this.unit.context.container.appendChild(this.controlPanel)}get canRender(){const{width:e,height:n}=this.unit.realSize;return n>=Qe.BUTTON_SIZE*Qe.MIN_BUTTONS_HEIGHT&&e>=Qe.BUTTON_SIZE*Qe.MIN_BUTTONS_WIDTH}get panels(){return[this.move,this.zoom,this.fold,this.service,this.tip]}show(e=Z.FORCE){this.canRender&&this.panels.forEach(n=>n.show(e))}hide(e=Z.FORCE){this.canRender&&this.panels.forEach(n=>n.hide(e))}get hasVisiblePanels(){return this.panels.some(e=>e.isVisible())}onunload(){super.onunload(),this.controlPanel?.remove()}}let uo=class{async imgToBlob(e,n){let i;if(e instanceof SVGElement)n==="svg"?i=this.svgToBlob(e):i=await this.drawSVGAsRaster(e,n==="png"?"png":"jpeg");else{const o=n==="png"?"png":"jpeg";try{i=await this.fetchImg(e,o)}catch{i=await this.drawLocalImage(e,o)}}return i}async drawSVGAsRaster(e,n){const i=this.svgToCode(e),o=new Image,s=document.createElement("canvas"),r=s.getContext("2d"),l=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(i)}`;return o.src=l,await new Promise((d,u)=>{o.onload=d,o.onerror=u}),s.width=o.naturalWidth||800,s.height=o.naturalHeight||600,r.drawImage(o,0,0),new Promise(d=>{s.toBlob(u=>d(u),`image/${n}`)})}svgToCode(e){return e instanceof SVGElement?new XMLSerializer().serializeToString(e):""}svgToBlob(e){const n=this.svgToCode(e),i=`<?xml version="1.0" standalone="no"?>\r
`;return new Blob([i,n],{type:"image/svg+xml;charset=utf-8"})}async fetchImg(e,n){const i=await R.requestUrl(e.src);return new Blob([i.arrayBuffer],{type:`image/${n}`})}async drawLocalImage(e,n){const i=document.createElement("canvas"),o=i.getContext("2d");return i.width=e.naturalWidth,i.height=e.naturalHeight,o.drawImage(e,0,0),new Promise(s=>{i.toBlob(r=>s(r),`image/${n}`)})}};class or extends R.Component{constructor(e){super(),this.contextMenu=e,this.imageConverter=new uo}async copyAsPNG(e){try{const n=await this.imageConverter.imgToBlob(e,"png");await this.writeToBuffer(n,"png")}catch(n){this.contextMenu.events.unit.plugin.logger.error("Error copying as PNG:",{...n,functionName:"copyAsPNG",lineNumber:19,columnNumber:609,fileName:"src\\modes\\integrated-mode\\integrated-unit\\events\\handlers\\context-menu\\context-actions\\copy.ts"}),this.contextMenu.events.unit.plugin.showNotice("Failed to copy image as PNG. Please try again.")}}async copyAsPlain(e){const n=this.imageConverter.svgToCode(e),i=new Blob([n],{type:"text/plain"});await this.writeToBuffer(i,"plain")}async copyAsSource(){const e=this.contextMenu.events.unit.context.sourceData.source,n=new Blob([e],{type:"text/plain"});await this.writeToBuffer(n,"plain")}async writeToBuffer(e,n){const i={png:"image/png",plain:"text/plain"}[n];await navigator.clipboard.write([new ClipboardItem({[i]:e})])}}class sr extends R.Component{constructor(e){super(),this.contextMenu=e,this.imageConverter=new uo}async exportAsPNG(e){try{const n=await this.imageConverter.imgToBlob(e,"png");this.downloadFile(n,"png")}catch(n){this.contextMenu.events.unit.plugin.logger.error("Error exporting as PNG:",{...n,functionName:"exportAsPNG",lineNumber:19,columnNumber:614,fileName:"src\\modes\\integrated-mode\\integrated-unit\\events\\handlers\\context-menu\\context-actions\\export.ts"}),this.contextMenu.events.unit.plugin.showNotice("Failed to export image as PNG. Please try again.")}}async exportAsJPG(e){try{const n=await this.imageConverter.imgToBlob(e,"jpg");this.downloadFile(n,"jpg")}catch(n){this.contextMenu.events.unit.plugin.logger.error("Error exporting as JPG:",{...n,functionName:"exportAsJPG",lineNumber:35,columnNumber:1370,fileName:"src\\modes\\integrated-mode\\integrated-unit\\events\\handlers\\context-menu\\context-actions\\export.ts"}),this.contextMenu.events.unit.plugin.showNotice("Failed to export image as JPG. Please try again.")}}async exportAsSVG(e){try{const n=await this.imageConverter.imgToBlob(e,"svg");this.downloadFile(n,"svg")}catch(n){this.contextMenu.events.unit.plugin.logger.error("Error exporting as SVG:",{...n,functionName:"exportAsSVG",lineNumber:51,columnNumber:2108,fileName:"src\\modes\\integrated-mode\\integrated-unit\\events\\handlers\\context-menu\\context-actions\\export.ts"}),this.contextMenu.events.unit.plugin.showNotice("Failed to export SVG. Please try again.")}}downloadFile(e,n){const{unit:i}=this.contextMenu.events,o=`export_${i.plugin.integratedMode.context.view?.file?.basename??"unit"}}_${R.moment().format("YYYYMMDDHHmmss")}.${n}`,s=URL.createObjectURL(e),r=document.createElement("a");r.href=s,r.download=o,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}}var Ct,H,ho,Be,pi,po,go,mo,Bn,Cn,Sn,fo,yt={},vo=[],rr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,St=Array.isArray;function Ce(t,e){for(var n in e)t[n]=e[n];return t}function Hn(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function ue(t,e,n){var i,o,s,r={};for(s in e)s=="key"?i=e[s]:s=="ref"?o=e[s]:r[s]=e[s];if(arguments.length>2&&(r.children=arguments.length>3?Ct.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)r[s]===void 0&&(r[s]=t.defaultProps[s]);return gt(t,r,i,o,null)}function gt(t,e,n,i,o){var s={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++ho,__i:-1,__u:0};return o==null&&H.vnode!=null&&H.vnode(s),s}function yo(){return{current:null}}function W(t){return t.children}function we(t,e){this.props=t,this.context=e}function nt(t,e){if(e==null)return t.__?nt(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?nt(t):null}function bo(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return bo(t)}}function $n(t){(!t.__d&&(t.__d=!0)&&Be.push(t)&&!Bt.__r++||pi!=H.debounceRendering)&&((pi=H.debounceRendering)||po)(Bt)}function Bt(){for(var t,e,n,i,o,s,r,l=1;Be.length;)Be.length>l&&Be.sort(go),t=Be.shift(),l=Be.length,t.__d&&(n=void 0,o=(i=(e=t).__v).__e,s=[],r=[],e.__P&&((n=Ce({},i)).__v=i.__v+1,H.vnode&&H.vnode(n),Vn(e.__P,n,i,e.__n,e.__P.namespaceURI,32&i.__u?[o]:null,s,o??nt(i),!!(32&i.__u),r),n.__v=i.__v,n.__.__k[n.__i]=n,xo(s,n,r),n.__e!=o&&bo(n)));Bt.__r=0}function wo(t,e,n,i,o,s,r,l,d,u,p){var c,v,m,x,C,E,N=i&&i.__k||vo,I=e.length;for(d=ar(n,e,N,d,I),c=0;c<I;c++)(m=n.__k[c])!=null&&(v=m.__i==-1?yt:N[m.__i]||yt,m.__i=c,E=Vn(t,m,v,o,s,r,l,d,u,p),x=m.__e,m.ref&&v.ref!=m.ref&&(v.ref&&Gn(v.ref,null,m),p.push(m.ref,m.__c||x,m)),C==null&&x!=null&&(C=x),4&m.__u||v.__k===m.__k?d=_o(m,d,t):typeof m.type=="function"&&E!==void 0?d=E:x&&(d=x.nextSibling),m.__u&=-7);return n.__e=C,d}function ar(t,e,n,i,o){var s,r,l,d,u,p=n.length,c=p,v=0;for(t.__k=new Array(o),s=0;s<o;s++)(r=e[s])!=null&&typeof r!="boolean"&&typeof r!="function"?(d=s+v,(r=t.__k[s]=typeof r=="string"||typeof r=="number"||typeof r=="bigint"||r.constructor==String?gt(null,r,null,null,null):St(r)?gt(W,{children:r},null,null,null):r.constructor==null&&r.__b>0?gt(r.type,r.props,r.key,r.ref?r.ref:null,r.__v):r).__=t,r.__b=t.__b+1,l=null,(u=r.__i=lr(r,n,d,c))!=-1&&(c--,(l=n[u])&&(l.__u|=2)),l==null||l.__v==null?(u==-1&&(o>p?v--:o<p&&v++),typeof r.type!="function"&&(r.__u|=4)):u!=d&&(u==d-1?v--:u==d+1?v++:(u>d?v--:v++,r.__u|=4))):t.__k[s]=null;if(c)for(s=0;s<p;s++)(l=n[s])!=null&&(2&l.__u)==0&&(l.__e==i&&(i=nt(l)),So(l,l));return i}function _o(t,e,n){var i,o;if(typeof t.type=="function"){for(i=t.__k,o=0;i&&o<i.length;o++)i[o]&&(i[o].__=t,e=_o(i[o],e,n));return e}t.__e!=e&&(e&&t.type&&!n.contains(e)&&(e=nt(t)),n.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Le(t,e){return e=e||[],t==null||typeof t=="boolean"||(St(t)?t.some(function(n){Le(n,e)}):e.push(t)),e}function lr(t,e,n,i){var o,s,r,l=t.key,d=t.type,u=e[n],p=u!=null&&(2&u.__u)==0;if(u===null&&t.key==null||p&&l==u.key&&d==u.type)return n;if(i>(p?1:0)){for(o=n-1,s=n+1;o>=0||s<e.length;)if((u=e[r=o>=0?o--:s++])!=null&&(2&u.__u)==0&&l==u.key&&d==u.type)return r}return-1}function gi(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||rr.test(e)?n:n+"px"}function Pt(t,e,n,i,o){var s,r;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||gi(t.style,e,"");if(n)for(e in n)i&&n[e]==i[e]||gi(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(mo,"$1")),r=e.toLowerCase(),e=r in t||e=="onFocusOut"||e=="onFocusIn"?r.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?i?n.u=i.u:(n.u=Bn,t.addEventListener(e,s?Sn:Cn,s)):t.removeEventListener(e,s?Sn:Cn,s);else{if(o=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function mi(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=Bn++;else if(e.t<n.u)return;return n(H.event?H.event(e):e)}}}function Vn(t,e,n,i,o,s,r,l,d,u){var p,c,v,m,x,C,E,N,I,L,D,M,A,T,G,U,de,re=e.type;if(e.constructor!=null)return null;128&n.__u&&(d=!!(32&n.__u),s=[l=e.__e=n.__e]),(p=H.__b)&&p(e);e:if(typeof re=="function")try{if(N=e.props,I="prototype"in re&&re.prototype.render,L=(p=re.contextType)&&i[p.__c],D=p?L?L.props.value:p.__:i,n.__c?E=(c=e.__c=n.__c).__=c.__E:(I?e.__c=c=new re(N,D):(e.__c=c=new we(N,D),c.constructor=re,c.render=ur),L&&L.sub(c),c.props=N,c.state||(c.state={}),c.context=D,c.__n=i,v=c.__d=!0,c.__h=[],c._sb=[]),I&&c.__s==null&&(c.__s=c.state),I&&re.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=Ce({},c.__s)),Ce(c.__s,re.getDerivedStateFromProps(N,c.__s))),m=c.props,x=c.state,c.__v=e,v)I&&re.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),I&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(I&&re.getDerivedStateFromProps==null&&N!==m&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(N,D),!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(N,c.__s,D)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(c.props=N,c.state=c.__s,c.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(ge){ge&&(ge.__=e)}),M=0;M<c._sb.length;M++)c.__h.push(c._sb[M]);c._sb=[],c.__h.length&&r.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(N,c.__s,D),I&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(m,x,C)})}if(c.context=D,c.props=N,c.__P=t,c.__e=!1,A=H.__r,T=0,I){for(c.state=c.__s,c.__d=!1,A&&A(e),p=c.render(c.props,c.state,c.context),G=0;G<c._sb.length;G++)c.__h.push(c._sb[G]);c._sb=[]}else do c.__d=!1,A&&A(e),p=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++T<25);c.state=c.__s,c.getChildContext!=null&&(i=Ce(Ce({},i),c.getChildContext())),I&&!v&&c.getSnapshotBeforeUpdate!=null&&(C=c.getSnapshotBeforeUpdate(m,x)),U=p,p!=null&&p.type===W&&p.key==null&&(U=Co(p.props.children)),l=wo(t,St(U)?U:[U],e,n,i,o,s,r,l,d,u),c.base=e.__e,e.__u&=-161,c.__h.length&&r.push(c),E&&(c.__E=c.__=null)}catch(ge){if(e.__v=null,d||s!=null)if(ge.then){for(e.__u|=d?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;s[s.indexOf(l)]=null,e.__e=l}else{for(de=s.length;de--;)Hn(s[de]);kn(e)}else e.__e=n.__e,e.__k=n.__k,ge.then||kn(e);H.__e(ge,e,n)}else s==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):l=e.__e=cr(n.__e,e,n,i,o,s,r,d,u);return(p=H.diffed)&&p(e),128&e.__u?void 0:l}function kn(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(kn)}function xo(t,e,n){for(var i=0;i<n.length;i++)Gn(n[i],n[++i],n[++i]);H.__c&&H.__c(e,t),t.some(function(o){try{t=o.__h,o.__h=[],t.some(function(s){s.call(o)})}catch(s){H.__e(s,o.__v)}})}function Co(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:St(t)?t.map(Co):Ce({},t)}function cr(t,e,n,i,o,s,r,l,d){var u,p,c,v,m,x,C,E=n.props,N=e.props,I=e.type;if(I=="svg"?o="http://www.w3.org/2000/svg":I=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),s!=null){for(u=0;u<s.length;u++)if((m=s[u])&&"setAttribute"in m==!!I&&(I?m.localName==I:m.nodeType==3)){t=m,s[u]=null;break}}if(t==null){if(I==null)return document.createTextNode(N);t=document.createElementNS(o,I,N.is&&N),l&&(H.__m&&H.__m(e,s),l=!1),s=null}if(I==null)E===N||l&&t.data==N||(t.data=N);else{if(s=s&&Ct.call(t.childNodes),E=n.props||yt,!l&&s!=null)for(E={},u=0;u<t.attributes.length;u++)E[(m=t.attributes[u]).name]=m.value;for(u in E)if(m=E[u],u!="children"){if(u=="dangerouslySetInnerHTML")c=m;else if(!(u in N)){if(u=="value"&&"defaultValue"in N||u=="checked"&&"defaultChecked"in N)continue;Pt(t,u,null,m,o)}}for(u in N)m=N[u],u=="children"?v=m:u=="dangerouslySetInnerHTML"?p=m:u=="value"?x=m:u=="checked"?C=m:l&&typeof m!="function"||E[u]===m||Pt(t,u,m,E[u],o);if(p)l||c&&(p.__html==c.__html||p.__html==t.innerHTML)||(t.innerHTML=p.__html),e.__k=[];else if(c&&(t.innerHTML=""),wo(e.type=="template"?t.content:t,St(v)?v:[v],e,n,i,I=="foreignObject"?"http://www.w3.org/1999/xhtml":o,s,r,s?s[0]:n.__k&&nt(n,0),l,d),s!=null)for(u=s.length;u--;)Hn(s[u]);l||(u="value",I=="progress"&&x==null?t.removeAttribute("value"):x!=null&&(x!==t[u]||I=="progress"&&!x||I=="option"&&x!=E[u])&&Pt(t,u,x,E[u],o),u="checked",C!=null&&C!=t[u]&&Pt(t,u,C,E[u],o))}return t}function Gn(t,e,n){try{if(typeof t=="function"){var i=typeof t.__u=="function";i&&t.__u(),i&&e==null||(t.__u=t(e))}else t.current=e}catch(o){H.__e(o,n)}}function So(t,e,n){var i,o;if(H.unmount&&H.unmount(t),(i=t.ref)&&(i.current&&i.current!=t.__e||Gn(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(s){H.__e(s,e)}i.base=i.__P=null}if(i=t.__k)for(o=0;o<i.length;o++)i[o]&&So(i[o],e,n||typeof t.type!="function");n||Hn(t.__e),t.__c=t.__=t.__e=void 0}function ur(t,e,n){return this.constructor(t,n)}function bt(t,e,n){var i,o,s,r;e==document&&(e=document.documentElement),H.__&&H.__(t,e),o=(i=typeof n=="function")?null:n&&n.__k||e.__k,s=[],r=[],Vn(e,t=(!i&&n||e).__k=ue(W,null,[t]),o||yt,yt,e.namespaceURI,!i&&n?[n]:o?null:e.firstChild?Ct.call(e.childNodes):null,s,!i&&n?n:o?o.__e:e.firstChild,i,r),xo(s,t,r)}function $o(t,e){bt(t,e,$o)}function dr(t,e,n){var i,o,s,r,l=Ce({},t.props);for(s in t.type&&t.type.defaultProps&&(r=t.type.defaultProps),e)s=="key"?i=e[s]:s=="ref"?o=e[s]:l[s]=e[s]===void 0&&r!=null?r[s]:e[s];return arguments.length>2&&(l.children=arguments.length>3?Ct.call(arguments,2):n),gt(t.type,l,i||t.key,o||t.ref,null)}function Fe(t){function e(n){var i,o;return this.getChildContext||(i=new Set,(o={})[e.__c]=this,this.getChildContext=function(){return o},this.componentWillUnmount=function(){i=null},this.shouldComponentUpdate=function(s){this.props.value!=s.value&&i.forEach(function(r){r.__e=!0,$n(r)})},this.sub=function(s){i.add(s);var r=s.componentWillUnmount;s.componentWillUnmount=function(){i&&i.delete(s),r&&r.call(s)}}),n.children}return e.__c="__cC"+fo++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,i){return n.children(i)}).contextType=e,e}Ct=vo.slice,H={__e:function(t,e,n,i){for(var o,s,r;e=e.__;)if((o=e.__c)&&!o.__)try{if((s=o.constructor)&&s.getDerivedStateFromError!=null&&(o.setState(s.getDerivedStateFromError(t)),r=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(t,i||{}),r=o.__d),r)return o.__E=o}catch(l){t=l}throw t}},ho=0,we.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Ce({},this.state),typeof t=="function"&&(t=t(Ce({},n),this.props)),t&&Ce(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),$n(this))},we.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),$n(this))},we.prototype.render=W,Be=[],po=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,go=function(t,e){return t.__v.__b-e.__v.__b},Bt.__r=0,mo=/(PointerCapture)$|Capture$/i,Bn=0,Cn=mi(!1),Sn=mi(!0),fo=0;var hr=0;function a(t,e,n,i,o,s){e||(e={});var r,l,d=e;if("ref"in d)for(l in d={},e)l=="ref"?r=e[l]:d[l]=e[l];var u={type:t,props:d,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--hr,__i:-1,__u:0,__source:o,__self:s};if(typeof t=="function"&&(r=t.defaultProps))for(l in r)d[l]===void 0&&(d[l]=r[l]);return H.vnode&&H.vnode(u),u}var De,Q,dn,fi,it=0,ko=[],ne=H,vi=ne.__b,yi=ne.__r,bi=ne.diffed,wi=ne.__c,_i=ne.unmount,xi=ne.__;function qe(t,e){ne.__h&&ne.__h(Q,t,it||e),it=0;var n=Q.__H||(Q.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function O(t){return it=1,Kt(Eo,t)}function Kt(t,e,n){var i=qe(De++,2);if(i.t=t,!i.__c&&(i.__=[n?n(e):Eo(void 0,e),function(l){var d=i.__N?i.__N[0]:i.__[0],u=i.t(d,l);d!==u&&(i.__N=[u,i.__[1]],i.__c.setState({}))}],i.__c=Q,!Q.__f)){var o=function(l,d,u){if(!i.__c.__H)return!0;var p=i.__c.__H.__.filter(function(v){return!!v.__c});if(p.every(function(v){return!v.__N}))return!s||s.call(this,l,d,u);var c=i.__c.props!==l;return p.forEach(function(v){if(v.__N){var m=v.__[0];v.__=v.__N,v.__N=void 0,m!==v.__[0]&&(c=!0)}}),s&&s.call(this,l,d,u)||c};Q.__f=!0;var s=Q.shouldComponentUpdate,r=Q.componentWillUpdate;Q.componentWillUpdate=function(l,d,u){if(this.__e){var p=s;s=void 0,o(l,d,u),s=p}r&&r.call(this,l,d,u)},Q.shouldComponentUpdate=o}return i.__N||i.__}function q(t,e){var n=qe(De++,3);!ne.__s&&qn(n.__H,e)&&(n.__=t,n.u=e,Q.__H.__h.push(n))}function $e(t,e){var n=qe(De++,4);!ne.__s&&qn(n.__H,e)&&(n.__=t,n.u=e,Q.__h.push(n))}function pe(t){return it=5,ce(function(){return{current:t}},[])}function Wn(t,e,n){it=6,$e(function(){if(typeof t=="function"){var i=t(e());return function(){t(null),i&&typeof i=="function"&&i()}}if(t)return t.current=e(),function(){return t.current=null}},n==null?n:n.concat(t))}function ce(t,e){var n=qe(De++,7);return qn(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function le(t,e){return it=8,ce(function(){return t},e)}function ke(t){var e=Q.context[t.__c],n=qe(De++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(Q)),e.props.value):t.__}function Yn(t,e){ne.useDebugValue&&ne.useDebugValue(e?e(t):t)}function pr(t){var e=qe(De++,10),n=O();return e.__=t,Q.componentDidCatch||(Q.componentDidCatch=function(i,o){e.__&&e.__(i,o),n[1](i)}),[n[0],function(){n[1](void 0)}]}function Kn(){var t=qe(De++,11);if(!t.__){for(var e=Q.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function gr(){for(var t;t=ko.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(At),t.__H.__h.forEach(En),t.__H.__h=[]}catch(e){t.__H.__h=[],ne.__e(e,t.__v)}}ne.__b=function(t){Q=null,vi&&vi(t)},ne.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),xi&&xi(t,e)},ne.__r=function(t){yi&&yi(t),De=0;var e=(Q=t.__c).__H;e&&(dn===Q?(e.__h=[],Q.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(At),e.__h.forEach(En),e.__h=[],De=0)),dn=Q},ne.diffed=function(t){bi&&bi(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(ko.push(e)!==1&&fi===ne.requestAnimationFrame||((fi=ne.requestAnimationFrame)||mr)(gr)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),dn=Q=null},ne.__c=function(t,e){e.some(function(n){try{n.__h.forEach(At),n.__h=n.__h.filter(function(i){return!i.__||En(i)})}catch(i){e.some(function(o){o.__h&&(o.__h=[])}),e=[],ne.__e(i,n.__v)}}),wi&&wi(t,e)},ne.unmount=function(t){_i&&_i(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{At(i)}catch(o){e=o}}),n.__H=void 0,e&&ne.__e(e,n.__v))};var Ci=typeof requestAnimationFrame=="function";function mr(t){var e,n=function(){clearTimeout(i),Ci&&cancelAnimationFrame(e),setTimeout(t)},i=setTimeout(n,35);Ci&&(e=requestAnimationFrame(n))}function At(t){var e=Q,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),Q=e}function En(t){var e=Q;t.__c=t.__(),Q=e}function qn(t,e){return!t||t.length!==e.length||e.some(function(n,i){return n!==t[i]})}function Eo(t,e){return typeof e=="function"?e(t):e}function No(t,e){for(var n in e)t[n]=e[n];return t}function Nn(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var i in e)if(i!=="__source"&&t[i]!==e[i])return!0;return!1}function Zn(t,e){var n=e(),i=O({t:{__:n,u:e}}),o=i[0].t,s=i[1];return $e(function(){o.__=n,o.u=e,hn(o)&&s({t:o})},[t,n,e]),q(function(){return hn(o)&&s({t:o}),t(function(){hn(o)&&s({t:o})})},[t]),n}function hn(t){var e,n,i=t.u,o=t.__;try{var s=i();return!((e=o)===(n=s)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch{return!0}}function Xn(t){t()}function Jn(t){return t}function Qn(){return[!1,Xn]}var qt=$e;function Ht(t,e){this.props=t,this.context=e}function Po(t,e){function n(o){var s=this.props.ref,r=s==o.ref;return!r&&s&&(s.call?s(null):s.current=null),e?!e(this.props,o)||!r:Nn(this.props,o)}function i(o){return this.shouldComponentUpdate=n,ue(t,o)}return i.displayName="Memo("+(t.displayName||t.name)+")",i.prototype.isReactComponent=!0,i.__f=!0,i}(Ht.prototype=new we).isPureReactComponent=!0,Ht.prototype.shouldComponentUpdate=function(t,e){return Nn(this.props,t)||Nn(this.state,e)};var Si=H.__b;H.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),Si&&Si(t)};var fr=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function $t(t){function e(n){var i=No({},n);return delete i.ref,t(i,n.ref||null)}return e.$$typeof=fr,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var $i=function(t,e){return t==null?null:Le(Le(t).map(e))},Io={map:$i,forEach:$i,count:function(t){return t?Le(t).length:0},only:function(t){var e=Le(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:Le},vr=H.__e;H.__e=function(t,e,n,i){if(t.then){for(var o,s=e;s=s.__;)if((o=s.__c)&&o.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),o.__c(t,e)}vr(t,e,n,i)};var ki=H.unmount;function Mo(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(i){typeof i.__c=="function"&&i.__c()}),t.__c.__H=null),(t=No({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c.__e=!0,t.__c=null),t.__k=t.__k&&t.__k.map(function(i){return Mo(i,e,n)})),t}function Lo(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(i){return Lo(i,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function mt(){this.__u=0,this.o=null,this.__b=null}function Do(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function Ao(t){var e,n,i;function o(s){if(e||(e=t()).then(function(r){n=r.default||r},function(r){i=r}),i)throw i;if(!n)throw e;return ue(n,s)}return o.displayName="Lazy",o.__f=!0,o}function et(){this.i=null,this.l=null}H.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),ki&&ki(t)},(mt.prototype=new we).__c=function(t,e){var n=e.__c,i=this;i.o==null&&(i.o=[]),i.o.push(n);var o=Do(i.__v),s=!1,r=function(){s||(s=!0,n.__R=null,o?o(l):l())};n.__R=r;var l=function(){if(!--i.__u){if(i.state.__a){var d=i.state.__a;i.__v.__k[0]=Lo(d,d.__c.__P,d.__c.__O)}var u;for(i.setState({__a:i.__b=null});u=i.o.pop();)u.forceUpdate()}};i.__u++||32&e.__u||i.setState({__a:i.__b=i.__v.__k[0]}),t.then(r,r)},mt.prototype.componentWillUnmount=function(){this.o=[]},mt.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),i=this.__v.__k[0].__c;this.__v.__k[0]=Mo(this.__b,n,i.__O=i.__P)}this.__b=null}var o=e.__a&&ue(W,null,t.fallback);return o&&(o.__u&=-33),[ue(W,null,e.__a?null:t.children),o]};var Ei=function(t,e,n){if(++n[1]===n[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(n=t.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.i=n=n[2]}};function yr(t){return this.getChildContext=function(){return t.context},t.children}function br(t){var e=this,n=t.h;if(e.componentWillUnmount=function(){bt(null,e.v),e.v=null,e.h=null},e.h&&e.h!==n&&e.componentWillUnmount(),!e.v){for(var i=e.__v;i!==null&&!i.__m&&i.__!==null;)i=i.__;e.h=n,e.v={nodeType:1,parentNode:n,childNodes:[],__k:{__m:i.__m},contains:function(){return!0},insertBefore:function(o,s){this.childNodes.push(o),e.h.insertBefore(o,s)},removeChild:function(o){this.childNodes.splice(this.childNodes.indexOf(o)>>>1,1),e.h.removeChild(o)}}}bt(ue(yr,{context:e.context},t.__v),e.v)}function Zt(t,e){var n=ue(br,{__v:t,h:e});return n.containerInfo=e,n}(et.prototype=new we).__a=function(t){var e=this,n=Do(e.__v),i=e.l.get(t);return i[0]++,function(o){var s=function(){e.props.revealOrder?(i.push(o),Ei(e,t,i)):o()};n?n(s):s()}},et.prototype.render=function(t){this.i=null,this.l=new Map;var e=Le(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.l.set(e[n],this.i=[1,0,this.i]);return t.children},et.prototype.componentDidUpdate=et.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,n){Ei(t,n,e)})};var To=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,wr=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,_r=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,xr=/[A-Z0-9]/g,Cr=typeof document<"u",Sr=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function ei(t,e,n){return e.__k==null&&(e.textContent=""),bt(t,e),typeof n=="function"&&n(),t?t.__c:null}function Oo(t,e,n){return $o(t,e),typeof n=="function"&&n(),t?t.__c:null}we.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(we.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var Ni=H.event;function $r(){}function kr(){return this.cancelBubble}function Er(){return this.defaultPrevented}H.event=function(t){return Ni&&(t=Ni(t)),t.persist=$r,t.isPropagationStopped=kr,t.isDefaultPrevented=Er,t.nativeEvent=t};var ti,Nr={enumerable:!1,configurable:!0,get:function(){return this.class}},Pi=H.vnode;H.vnode=function(t){typeof t.type=="string"&&function(e){var n=e.props,i=e.type,o={},s=i.indexOf("-")===-1;for(var r in n){var l=n[r];if(!(r==="value"&&"defaultValue"in n&&l==null||Cr&&r==="children"&&i==="noscript"||r==="class"||r==="className")){var d=r.toLowerCase();r==="defaultValue"&&"value"in n&&n.value==null?r="value":r==="download"&&l===!0?l="":d==="translate"&&l==="no"?l=!1:d[0]==="o"&&d[1]==="n"?d==="ondoubleclick"?r="ondblclick":d!=="onchange"||i!=="input"&&i!=="textarea"||Sr(n.type)?d==="onfocus"?r="onfocusin":d==="onblur"?r="onfocusout":_r.test(r)&&(r=d):d=r="oninput":s&&wr.test(r)?r=r.replace(xr,"-$&").toLowerCase():l===null&&(l=void 0),d==="oninput"&&o[r=d]&&(r="oninputCapture"),o[r]=l}}i=="select"&&o.multiple&&Array.isArray(o.value)&&(o.value=Le(n.children).forEach(function(u){u.props.selected=o.value.indexOf(u.props.value)!=-1})),i=="select"&&o.defaultValue!=null&&(o.value=Le(n.children).forEach(function(u){u.props.selected=o.multiple?o.defaultValue.indexOf(u.props.value)!=-1:o.defaultValue==u.props.value})),n.class&&!n.className?(o.class=n.class,Object.defineProperty(o,"className",Nr)):(n.className&&!n.class||n.class&&n.className)&&(o.class=o.className=n.className),e.props=o}(t),t.$$typeof=To,Pi&&Pi(t)};var Ii=H.__r;H.__r=function(t){Ii&&Ii(t),ti=t.__c};var Mi=H.diffed;H.diffed=function(t){Mi&&Mi(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),ti=null};var zo={ReactCurrentDispatcher:{current:{readContext:function(t){return ti.__n[t.__c].props.value},useCallback:le,useContext:ke,useDebugValue:Yn,useDeferredValue:Jn,useEffect:q,useId:Kn,useImperativeHandle:Wn,useInsertionEffect:qt,useLayoutEffect:$e,useMemo:ce,useReducer:Kt,useRef:pe,useState:O,useSyncExternalStore:Zn,useTransition:Qn}}},Pr="18.3.1";function Ro(t){return ue.bind(null,t)}function Ze(t){return!!t&&t.$$typeof===To}function Fo(t){return Ze(t)&&t.type===W}function Uo(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function Xt(t){return Ze(t)?dr.apply(null,arguments):t}function ni(t){return!!t.__k&&(bt(null,t),!0)}function jo(t){return t&&(t.base||t.nodeType===1&&t)||null}var Bo=function(t,e){return t(e)},Ho=function(t,e){return t(e)},Vo=W,Go=Ze,oe={useState:O,useId:Kn,useReducer:Kt,useEffect:q,useLayoutEffect:$e,useInsertionEffect:qt,useTransition:Qn,useDeferredValue:Jn,useSyncExternalStore:Zn,startTransition:Xn,useRef:pe,useImperativeHandle:Wn,useMemo:ce,useCallback:le,useContext:ke,useDebugValue:Yn,version:"18.3.1",Children:Io,render:ei,hydrate:Oo,unmountComponentAtNode:ni,createPortal:Zt,createElement:ue,createContext:Fe,createFactory:Ro,cloneElement:Xt,createRef:yo,Fragment:W,isValidElement:Ze,isElement:Go,isFragment:Fo,isMemo:Uo,findDOMNode:jo,Component:we,PureComponent:Ht,memo:Po,forwardRef:$t,flushSync:Ho,unstable_batchedUpdates:Bo,StrictMode:Vo,Suspense:mt,SuspenseList:et,lazy:Ao,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:zo},Ir=Object.freeze({__proto__:null,Children:Io,Component:we,Fragment:W,PureComponent:Ht,StrictMode:Vo,Suspense:mt,SuspenseList:et,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:zo,cloneElement:Xt,createContext:Fe,createElement:ue,createFactory:Ro,createPortal:Zt,createRef:yo,default:oe,findDOMNode:jo,flushSync:Ho,forwardRef:$t,hydrate:Oo,isElement:Go,isFragment:Fo,isMemo:Uo,isValidElement:Ze,lazy:Ao,memo:Po,render:ei,startTransition:Xn,unmountComponentAtNode:ni,unstable_batchedUpdates:Bo,useCallback:le,useContext:ke,useDebugValue:Yn,useDeferredValue:Jn,useEffect:q,useErrorBoundary:pr,useId:Kn,useImperativeHandle:Wn,useInsertionEffect:qt,useLayoutEffect:$e,useMemo:ce,useReducer:Kt,useRef:pe,useState:O,useSyncExternalStore:Zn,useTransition:Qn,version:Pr});function Jt(t){return{render:function(e){ei(e,t)},unmount:function(){ni(t)}}}class He{static instance;refCounts=new Map;styleElements=new Map;static getInstance(){return He.instance||(He.instance=new He),He.instance}addStyle(e,n){const i=(this.refCounts.get(e)||0)+1;if(this.refCounts.set(e,i),this.styleElements.has(e)){this.styleElements.get(e).setAttribute("data-ref-count",i.toString());return}const o=document.createElement("style");o.id=e,o.textContent=n,o.setAttribute("data-ref-count",i.toString()),document.head.appendChild(o),this.styleElements.set(e,o)}removeStyle(e){const n=this.refCounts.get(e)||0;if(n<=1){const i=this.styleElements.get(e);i&&(i.remove(),this.styleElements.delete(e)),this.refCounts.delete(e)}else{const i=n-1;this.refCounts.set(e,i);const o=this.styleElements.get(e);o&&o.setAttribute("data-ref-count",i.toString())}}}const Li="osetting-styles",Mr=`
   .osetting-item {
       padding: 8px !important;
       margin-bottom: 12px !important;
       transition: box-shadow 0.3s ease !important;
       border-bottom: 1px solid var(--color-base-30) !important;
   }
   
   .osetting-item.no-border {
       border-bottom: none !important;
   }
   
   .osetting-item:last-child {
       border-bottom: none !important;
   }
   
   .osetting-item .setting-item .button-active {
       background-color: var(--interactive-accent) !important;
       color: var(--text-on-accent) !important;
   }
   
   .osetting-item .setting-item .clickable-icon {
       color: var(--text-muted);
       transition: color 0.2s ease;
   }
   
   .osetting-item .setting-item .clickable-icon:hover {
       color: var(--text-normal);
   }
   
   .osetting-item .setting-item input[type='text'],
   .osetting-item .setting-item input[type='number'] {
       background-color: var(--background-secondary);
       border: 1px solid var(--background-modifier-border);
       border-radius: 4px;
       padding: 6px 8px;
       width: 100%;
   }
   
   .osetting-item svg {
       width: 18px;
       height: 18px;
       transition: transform 0.2s ease;
       flex-shrink: 0;
   }
   
   .osetting-item.collapsible {
    margin-bottom: 1em;
    }
    
    .osetting-item.collapsible details {
    border: 1px solid transparent;
    border-radius: 4px;
    padding: 0.5em;
}

.osetting-item.collapsible summary {
    outline: none;
    display: list-item;
    list-style: disclosure-closed;
    align-items: center;
    gap: 0.5em;
}

.osetting-item.collapsible details[open] > summary {
    list-style: disclosure-open;
}

.collapsible-content {
    margin-top: 0.75em;
    padding-left: 1em;
    display: flex;
    flex-direction: column;
    gap: 0.75em;
}


`,ct=({children:t,title:e,onOpen:n,onClose:i,maxHeight:o,maxWidth:s,width:r,height:l,closable:d=!0,className:u})=>{const p=document.body,c=le(m=>{m.key==="Escape"&&d&&i()},[i,d]);q(()=>(window.addEventListener("keydown",c),()=>{window.removeEventListener("keydown",c)}),[i]),q(()=>{n&&n()},[n]);const v=ce(()=>{const m={};return r&&(m["--dialog-width"]=r),l&&(m.height=l),s&&(m["--dialog-max-width"]=s),o&&(m["--dialog-max-height"]=o),r&&!s&&(m["--dialog-max-width"]=r),l&&!o&&(m["--dialog-max-height"]=l),m},[r,l,s,o]);return Zt(a("div",{className:"modal-container mod-dim",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",style:v,children:[a("div",{className:"modal-bg",onClick:()=>d&&i(),style:{opacity:"0.85"},"aria-hidden":"true"}),a("div",{className:`modal ${u??""}`,children:[a("div",{className:"modal-close-button",onClick:()=>d&&i(),"aria-label":"Close modal"}),a("div",{className:"modal-header",children:a("div",{className:"modal-title",children:e})}),a("div",{className:"modal-content",style:{position:"relative",zIndex:1e5},children:t})]})]}),p)},Lr=({children:t,disabled:e})=>{const n=pe(null),i=t.props,o=i["data-icon"];return $e(()=>{const s=n.current;!s||!o||e||R.setIcon(s,o)},[e,o]),oe.cloneElement(t,{ref:n,disabled:e,tabIndex:e?-1:i.tabIndex||0,style:{...i.style,opacity:e?.6:1,cursor:e?"not-allowed":"default"}})},Dr=({children:t,disabled:e})=>{const n=t.props,i=pe(null),o=n.disabled||e,s=n.checked!==void 0,[r,l]=O(n.defaultChecked||!1),d=s?n.checked:r,u=()=>{o||i.current?.click()},p=v=>{o||(s||l(v.target.checked),n.onChange&&n.onChange(v))},c=Object.keys(n).reduce((v,m)=>(m.startsWith("aria-")&&(v[m]=n[m]),v),{});return a("div",{className:`checkbox-container ${d?"is-enabled":""} ${o?"is-disabled":""}`,onPointerDown:u,...c,style:{cursor:o?"not-allowed":"default",opacity:o?.6:1},children:oe.cloneElement(t,{ref:i,tabIndex:o?-1:0,onChange:p,checked:d,disabled:o,style:{pointerEvents:"none"},...Object.keys(c).reduce((v,m)=>(v[m]=void 0,v),{})})})},Ar=({children:t,disabled:e})=>{const n=t.props,i=n.disabled||e;return oe.cloneElement(t,{className:`dropdown ${n.className||""}`.trim(),tabIndex:i?-1:0,disabled:i,style:{...n.style,opacity:i?.6:1,cursor:i?"not-allowed":"pointer"}})},Tr=({children:t,disabled:e})=>{const n=t.props,i=n.disabled||e,o=pe(null),[s,r]=O(!1),[l,d]=O(""),[u,p]=O({x:0,y:0}),c=pe(null),[v,m]=O(!1),x=()=>{if(o.current){const L=o.current.getBoundingClientRect();p({x:L.left+L.width/2,y:L.top-40})}},C=L=>{c.current&&clearTimeout(c.current),r(!0),v||(c.current=setTimeout(()=>{r(!1),c.current=null},200));const D=L.currentTarget.value;d(D),x(),n.onInput&&n.onInput(L)};q(()=>{const L=()=>{m(!1),r(!1)};if(v)return document.addEventListener("pointerup",L),document.addEventListener("pointercancel",L),()=>{document.removeEventListener("pointerup",L),document.removeEventListener("pointercancel",L)}},[v]),q(()=>()=>{c.current&&clearTimeout(c.current)},[]);const E=L=>{c.current&&clearTimeout(c.current),d(L.currentTarget.value),r(!0),x(),n.onMouseEnter&&n.onMouseEnter(L)},N=L=>{v||r(!1),n.onMouseLeave&&n.onMouseLeave(L)},I=()=>{m(!0),s||(d(o.current?.value||""),r(!0),x())};return a(W,{children:[oe.cloneElement(t,{ref:o,className:`slider ${n.className||""}`.trim(),tabIndex:i?-1:0,disabled:i,onInput:C,onPointerDown:I,onMouseEnter:E,onMouseLeave:N,style:{...n.style,opacity:i?.6:1,cursor:i?"not-allowed":"default"}}),s&&Zt(a("div",{className:"tooltip mod-top",style:{position:"fixed",left:u.x,top:u.y,transform:"translateX(-50%)",zIndex:1e3,pointerEvents:"none"},children:[l,a("div",{className:"tooltip-arrow"})]}),document.body)," "]})},Pn=(t,e)=>oe.Children.map(t,n=>{if(oe.isValidElement(n)){const i=n.props,o=i.disabled||e;if(n.type==="input")return i.type==="checkbox"?a(Dr,{disabled:o,children:n}):i.type==="range"?a(Tr,{disabled:o,children:n}):oe.cloneElement(n,{disabled:o,tabIndex:o?-1:i.tabIndex||0,style:{...i.style,opacity:o?.6:1,cursor:o?"not-allowed":"text"}});if(n.type==="button")return a(Lr,{disabled:o,children:n});if(n.type==="select")return a(Ar,{disabled:o,children:n});if(n.type==="textarea")return oe.cloneElement(n,{disabled:o,tabIndex:o?-1:i.tabIndex||0,style:{...i.style,opacity:o?.6:1,cursor:o?"not-allowed":"text"}});if(n.type==="a")return oe.cloneElement(n,{tabIndex:o?-1:i.tabIndex||0,onClick:o?s=>s.preventDefault():i.onClick,style:{...i.style,opacity:o?.6:1,cursor:o?"not-allowed":"pointer",pointerEvents:o?"none":"auto"}});if(i.onClick||i.onMouseDown||i.onMouseUp)return oe.cloneElement(n,{onClick:o?void 0:i.onClick,onMouseDown:o?void 0:i.onMouseDown,onMouseUp:o?void 0:i.onMouseUp,tabIndex:o?-1:i.tabIndex||0,style:{...i.style,opacity:o?.6:1,cursor:o?"not-allowed":i.style?.cursor||"pointer",pointerEvents:o?"none":"auto"},children:i.children?Pn(i.children,o):i.children});if(i.children)return oe.cloneElement(n,{children:Pn(i.children,o)})}return n}),Or=t=>{const e=document.createDocumentFragment(),n=(typeof t=="string"?t:t.join(`
`)).split(`
`);return n.forEach((i,o)=>{e.append(document.createTextNode(i)),o<n.length-1&&e.append(document.createElement("br"))}),e},z=({name:t,heading:e,desc:n,className:i,noBorder:o,disabled:s,setupObsidianSettingManually:r,children:l})=>{const d=pe(null),u=pe(null);return $e(()=>{if(window.OSETTING_DISABLE_STYLES!=="true")return He.getInstance().addStyle(Li,Mr),()=>{He.getInstance().removeStyle(Li)}},[]),$e(()=>{if(!(!r||!d.current))return u.current?.clear(),u.current=new R.Setting(d.current),t&&u.current.setName(t),e&&u.current.setHeading(),n&&u.current.setDesc(Or(n)),i&&u.current.setClass(i),r(u.current),s&&u.current.setDisabled(s),()=>{u.current?.clear(),u.current=null}},[r,t,e,n,i]),r?a("div",{className:"osetting-item",children:a("div",{ref:d})}):a("div",{className:`osetting-item ${o?"no-border":""} ${i??""}`,children:a("div",{className:`setting-item ${e?"setting-item-heading":""}`,children:[a("div",{className:"setting-item-info",children:[t&&a("div",{className:"setting-item-name",children:t}),n&&a("div",{className:"setting-item-description",children:typeof n=="string"?n:n.map((p,c)=>a("div",{children:p},c))})]}),a("div",{className:"setting-item-control",children:Pn(l,s)})]})})},zr=({info:t,onClose:e})=>a(ct,{title:"Image properties",onClose:e,width:"500px",maxHeight:"80vh",children:[a(z,{name:"General Information",heading:!0}),a(z,{name:"Name",desc:t.name}),a(z,{name:"Selector",desc:t.selector}),a(z,{name:"Status",desc:t.enabled?"Enabled":"Disabled"}),a(z,{name:"Element type",desc:t.elementType}),a(z,{name:"Dimensions",heading:!0}),a(z,{name:"Width",desc:`${t.dimensions.width}px`}),a(z,{name:"Height",desc:`${t.dimensions.height}px`}),a(z,{name:"Source Location",heading:!0}),a(z,{name:"Start line",desc:t.sourceLocation.lineStart.toString()}),a(z,{name:"End line",desc:t.sourceLocation.lineEnd.toString()}),a(z,{name:"Lines count",desc:t.sourceLocation.linesCount.toString()}),t.panels.length>0&&a(W,{children:[a(z,{name:"Panels",heading:!0}),t.panels.map((n,i)=>a(z,{name:n.name,desc:n.enabled?"\u2713 Enabled":"\u2717 Disabled"},`${i}-${n.name}`))]})]});let Rr=class extends R.Component{constructor(e){super(),this.contextMenu=e}showInfo(){const e=this.info;this.modalDiv??=document.createElement("div"),document.body.appendChild(this.modalDiv),this.reactRoot||(this.reactRoot=Jt(this.modalDiv),this.reactRoot.render(a(zr,{info:e,onClose:this.closeModal})))}closeModal=()=>{this.reactRoot?.unmount(),this.reactRoot=void 0,this.modalDiv?.remove(),this.modalDiv=void 0};get info(){const e=this.contextMenu.events.unit,n=e.context.element,i=e.context.size,o=e.context.sourceData,s=e.context.options;return{name:s.name,selector:s.selector,enabled:s.on,dimensions:{width:i.width,height:i.height},sourceLocation:{lineStart:o.lineStart,lineEnd:o.lineEnd,linesCount:o.lineEnd-o.lineStart+1},panels:Object.entries(s.panels).map(([r,l])=>({name:r,enabled:l.on})),elementType:n.tagName.toLowerCase()}}onunload(){super.onunload(),this.closeModal()}},Fr=class extends R.Component{constructor(e){super(),this.contextMenu=e}async openPopupForImage(e){await this.contextMenu.events.unit.plugin.popupMode.showPopupForImage(e)}};class Ur extends R.Component{constructor(e){super(),this.events=e,this.export=new sr(this),this.copy=new or(this),this.info=new Rr(this),this.openInPopup=new Fr(this),this.addChild(this.export),this.addChild(this.copy),this.addChild(this.info),this.addChild(this.openInPopup)}initialize(){this.load();const{container:e}=this.events.unit.context;this.registerDomEvent(e,"contextmenu",n=>{const i=this.events.unit.plugin.settings.$,o=this.events.unit.context.origin;!i.units.contextMenu.showForDiagrams&&o==="generated"||!i.units.contextMenu.showForOtherImages&&o!=="generated"||(n.preventDefault(),n.stopPropagation(),this.onContextMenu(n))},{capture:!0,passive:!1})}onContextMenu=e=>{const{element:n}=this.events.unit.context;this.events.unit.context.content.focus(),this.showMenu(e,n)};showMenu(e,n){this.createMenu(n).showAtMouseEvent(e)}createMenu(e){const n=new R.Menu;return n.addItem(i=>{i.setIcon("download"),i.setTitle("Export as...");const o=i.setSubmenu();o.addItem(s=>{s.setIcon("file-export"),s.setTitle("PNG"),s.onClick(async()=>{await this.export.exportAsPNG(e)})}),o.addItem(s=>{s.setIcon("image"),s.setTitle("JPG"),s.onClick(async()=>{await this.export.exportAsJPG(e)})}),e instanceof SVGElement&&o.addItem(s=>{s.setIcon("file-code"),s.setTitle("SVG"),s.onClick(async()=>{await this.export.exportAsSVG(e)})})}),n.addItem(i=>{i.setIcon("copy"),i.setTitle("Copy as...");const o=i.setSubmenu();o.addItem(s=>{s.setIcon("image"),s.setTitle("PNG"),s.onClick(async()=>{await this.copy.copyAsPNG(e)})}),e instanceof SVGElement&&o.addItem(s=>{s.setIcon("code-2"),s.setTitle("Plain code"),s.onClick(async()=>{await this.copy.copyAsPlain(e)})}),o.addItem(s=>{s.setIcon("file-code"),s.setTitle("Source"),s.onClick(async()=>{await this.copy.copyAsSource()})})}),n.addSeparator(),!(e instanceof SVGElement)&&n.addItem(i=>{i.setIcon("maximize-2"),i.setTitle("Open this image in popup window"),i.onClick(async()=>{await this.openInPopup.openPopupForImage(e)})}),n.addItem(i=>{i.setIcon("info"),i.setTitle("Info"),i.onClick(async()=>{this.info.showInfo()})}),n}}class jr extends R.Component{constructor(e){super(),this.events=e}initialize(){this.load();const{container:e}=this.events.unit.context;this.registerDomEvent(e,"focusin",this.focusIn),this.registerDomEvent(e,"focusout",this.focusOut)}focusIn=()=>{this.events.unit.plugin.settings.$.units.folding.autoFoldOnFocusChange&&this.events.unit.controlPanel.fold.unfold(),this.events.unit.controlPanel.show(Z.FOCUS)};focusOut=()=>{this.events.unit.plugin.settings.$.units.folding.autoFoldOnFocusChange&&this.events.unit.controlPanel.fold.fold(),this.events.unit.controlPanel.hide(Z.FOCUS)}}class Br extends R.Component{constructor(e){super(),this.events=e}initialize(){this.load();const{container:e}=this.events.unit.context;this.registerDomEvent(e,"keydown",this.keyDown)}keyDown=async e=>{const{code:n,ctrlKey:i,shiftKey:o,altKey:s}=e,r=this.events.unit.actions,l={ArrowUp:()=>r.moveElement(0,50,{animated:!0}),ArrowDown:()=>r.moveElement(0,-50,{animated:!0}),ArrowLeft:()=>r.moveElement(50,0,{animated:!0}),ArrowRight:()=>r.moveElement(-50,0,{animated:!0})},d={Equal:()=>r.zoomElement(1.1,{animated:!0}),Minus:()=>r.zoomElement(.9,{animated:!0}),Digit0:()=>r.resetZoomAndMove({animated:!0}),Backquote:()=>{const{container:c}=this.events.unit.context,v=c.dataset.folded==="true";c.setAttribute("data-folded",v?"false":"true"),this.events.unit.applyLayout(),v?this.events.unit.controlPanel.show(Z.FOLD):this.events.unit.controlPanel.hide(Z.FOLD)}},u={KeyF:async()=>await r.toggleFullscreen()};let p=null;i&&s&&n in u?p=u[n]:i&&n in d?p=d[n]:!i&&!o&&n in l&&(p=l[n]),p&&(e.preventDefault(),e.stopPropagation(),p())}}class Hr extends R.Component{constructor(e){super(),this.events=e}isDragging=!1;initialize(){this.load();const{container:e}=this.events.unit.context;this.registerDomEvent(e,"wheel",this.wheel),this.registerDomEvent(e,"wheel",this.wheelScroll),this.registerDomEvent(e,"mousedown",this.mouseDown),this.registerDomEvent(e,"mousemove",this.mouseMove),this.registerDomEvent(e,"mouseup",this.mouseUp),this.registerDomEvent(e,"mouseleave",this.mouseLeave),this.registerDomEvent(e,"mouseenter",this.mouseEnter),this.registerDomEvent(e,"dblclick",this.dblclick)}get elements(){const e=this.events.unit.context.container,n=this.events.unit.context.content;return{container:e,content:n}}wheel=e=>{if(!e.ctrlKey&&document.fullscreenElement!==this.events.unit.context.content||e.shiftKey||e.altKey)return;const{content:n,container:i}=this.elements,o=e.clientX,s=e.clientY,r=n.getBoundingClientRect(),l=r.left+r.width/2,d=r.top+r.height/2,u=(o-l)/this.events.unit.scale,p=(s-d)/this.events.unit.scale;e.deltaY<0;const c=this.events.unit.scale;this.events.unit.scale+=e.deltaY*-.001,this.events.unit.scale=Math.max(.125,this.events.unit.scale);const v=this.events.unit.scale-c;this.events.unit.dx-=u*v,this.events.unit.dy-=p*v,n.setCssStyles({transform:`translate(${this.events.unit.dx}px, ${this.events.unit.dy}px) scale(${this.events.unit.scale})`}),e.preventDefault(),e.stopPropagation()};wheelScroll=e=>{if(!(e.shiftKey||e.altKey))return;const n=e.shiftKey&&!e.altKey,i=e.shiftKey&&e.altKey;let o=0,s=0;n&&(o=e.deltaY>0?20:-20),i&&(s=e.deltaY>0?20:-20),this.events.unit.actions.moveElement(o,s,{animated:!0}),e.preventDefault(),e.stopPropagation()};mouseDown=e=>{if(e.button!==0)return;const{container:n,content:i}=this.elements;n.focus({preventScroll:!0}),this.isDragging=!0,this.startX=e.clientX,this.startY=e.clientY,this.initialX=this.events.unit.dx,this.initialY=this.events.unit.dy,i.setCssStyles({cursor:"grabbing"}),e.preventDefault(),e.stopPropagation()};mouseMove=e=>{if(!this.isDragging)return;const{content:n}=this.elements,i=e.clientX-this.startX,o=e.clientY-this.startY;this.events.unit.dx=this.initialX+i,this.events.unit.dy=this.initialY+o,n.setCssStyles({transform:`translate(${this.events.unit.dx}px, ${this.events.unit.dy}px) scale(${this.events.unit.scale})`}),e.preventDefault(),e.stopPropagation()};mouseUp=e=>{const{content:n}=this.elements;this.isDragging=!1,n.setCssStyles({cursor:"grab"}),e.preventDefault(),e.stopPropagation()};mouseLeave=e=>{this.mouseUp(e),this.events.unit.controlPanel.hide(Z.MOUSE),e.preventDefault(),e.stopPropagation()};mouseEnter=e=>{this.events.unit.controlPanel.show(Z.MOUSE),e.preventDefault(),e.stopPropagation()};dblclick=e=>{e.target.closest(".izd-control-panel")||(this.events.unit.actions.resetZoomAndMove({animated:!0}),e.stopPropagation(),e.preventDefault())}}class Vr extends R.Component{constructor(e){super(),this.events=e}isDragging=!1;isPinching=!1;tapTimeout=null;initialize(){this.load();const{container:e}=this.events.unit.context;this.registerDomEvent(e,"touchstart",this.touchStart,{passive:!1}),this.registerDomEvent(e,"touchmove",this.touchMove,{passive:!1}),this.registerDomEvent(e,"touchend",this.touchEnd,{passive:!1})}touchStart=e=>{this.events.unit.plugin.integratedMode.context.nativeTouchEventsEnabled||e.target.closest(".izd-panel")||(e.preventDefault(),e.stopPropagation(),e.touches.length===1?(this.isDragging=!0,this.startX=e.touches[0].clientX,this.startY=e.touches[0].clientY,this.tapTimeout?(clearTimeout(this.tapTimeout),this.tapTimeout=null,this.events.unit.actions.resetZoomAndMove({animated:!0})):this.tapTimeout=setTimeout(()=>{this.tapTimeout=null},300)):e.touches.length===2&&(this.isDragging=!1,this.isPinching=!0,this.initialDistance=this.calculateDistance(e.touches),this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=null)))};touchMove=e=>{if(!(this.events.unit.plugin.integratedMode.context.nativeTouchEventsEnabled||(e.preventDefault(),e.stopPropagation(),!this.events.unit.context.content))){if(this.isDragging&&e.touches.length===1){const n=e.touches[0].clientX-this.startX,i=e.touches[0].clientY-this.startY;this.events.unit.actions.moveElement(n,i),this.startX=e.touches[0].clientX,this.startY=e.touches[0].clientY}else if(this.isPinching&&e.touches.length===2){const n=this.calculateDistance(e.touches),i=n/this.initialDistance;this.events.unit.actions.zoomElement(i),this.initialDistance=n}}};touchEnd=e=>{this.events.unit.plugin.integratedMode.context.nativeTouchEventsEnabled||(this.events.unit.context.container,e.target.closest(".izd-panel")||(e.preventDefault(),e.stopPropagation(),this.isDragging=!1,this.isPinching=!1,this.initialDistance=0))};calculateDistance(e){const[n,i]=[e[0],e[1]],o=i.clientX-n.clientX,s=i.clientY-n.clientY;return Math.sqrt(o*o+s*s)}}let Gr=class extends R.Component{constructor(e){super(),this.unit=e,this.mouse=new Hr(this),this.touch=new Vr(this),this.keyboard=new Br(this),this.focus=new jr(this),this.contextMenu=new Ur(this),this.addChild(this.mouse),this.addChild(this.touch),this.addChild(this.keyboard),this.addChild(this.focus),this.addChild(this.contextMenu)}initialize(){this.load(),this.mouse.initialize(),this.touch.initialize(),this.keyboard.initialize(),this.focus.initialize(),this.contextMenu.initialize()}};var Se=(t=>(t.LivePreview="live-preview",t.Preview="preview",t.PickerMode="picker-mode",t))(Se||{});let Wr=class extends R.Component{constructor(e){super(),this.unit=e,this.load()}async initialize(){this.unit.plugin.emitter.on("toggle-integrated-element",this.onToggleElement),await this.scheduleActivationIfNeeded()}async scheduleActivationIfNeeded(){if(this.unit.context.adapter===Se.PickerMode){await this.activate();return}this.unit.plugin.settings.$.units.interactivity.markdown.autoDetect&&await this.activate(!0)}onToggleElement=async e=>{e.element===this.unit.context.element&&(this.unit.active?await this.deactivate():await this.activate())};activate=async e=>{this.unit.active||(this.unit.context.element.setAttribute("data-interactive-mode",jt.Interactive),e?(await this.switchToInteractive(),this.unit.initialize()):await this.smoothTransition(this.unit.context.originalParent,async()=>{await this.switchToInteractive(),this.unit.initialize()}),this.unit.context.originalParent.style.removeProperty("transition"),this.unit.context.originalParent.style.removeProperty("transform"))};deactivate=async()=>{this.unit.active&&(this.unit.context.element.setAttribute("data-interactive-mode",jt.NonInteractive),await this.smoothTransition(this.unit.context.originalParent,async()=>{this.unit.unload(),this.unit.controlPanel.controlPanel?.remove(),await this.switchToNonInteractive()}),this.unit.context.originalParent.style.removeProperty("transition"),this.unit.context.originalParent.style.removeProperty("transform"))};async smoothTransition(e,n){return await e.animate([{opacity:"1",transform:"scale(1)",filter:"blur(0)"},{opacity:"0",transform:"scale(0.96)",filter:"blur(1px)"}],{duration:150,fill:"forwards"}).finished,await n(),e.animate([{opacity:"0",transform:"scale(0.96)",filter:"blur(1px)"},{opacity:"1",transform:"scale(1)",filter:"blur(0)"}],{duration:200,easing:"ease-out",fill:"forwards"}).finished}async switchToInteractive(){this.unit.active=!0,this.unit.plugin.logger.debug(`Switch unit with id ${this.unit.id} to interactive state`,{functionName:"switchToInteractive",lineNumber:116,columnNumber:3592,fileName:"src\\modes\\integrated-mode\\integrated-unit\\integrated-unit-state-manager.ts"});const{content:e,container:n,element:i,originalParent:o}=this.unit.context;if(this.unit.context.content.setCssStyles({transform:`translate(${this.unit.dx}px, ${this.unit.dy}px) scale(${this.unit.scale})`}),this.unit.context.element instanceof SVGElement){const s=o.className.trim();s&&e.addClasses(s.split(/\s+/)),e.removeClass("live-preview-parent"),o.className=""}this.unit.context.adapter===Se.LivePreview&&this.unit.context.livePreviewWidget?.addClass("live-preview-parent"),this.unit.context.livePreviewWidget&&this.unit.registerDomEvent(this.unit.context.livePreviewWidget,"click",s=>{s.target instanceof Element&&(s.target.closest(".izd-control-panel")||!this.unit.context.container.contains(s.target)||(s.preventDefault(),s.stopPropagation()))},!0),o.contains(i)?o.replaceChild(n,i):this.unit.plugin.logger.warn("Error with replace child. It seems that active leaf was changed?",{functionName:"switchToInteractive",lineNumber:161,columnNumber:5556,fileName:"src\\modes\\integrated-mode\\integrated-unit\\integrated-unit-state-manager.ts"}),n.appendChild(e),e.appendChild(i),await this.waitForElementsLayout([i,e,n])}async switchToNonInteractive(){this.unit.active=!1,this.unit.plugin.logger.debug(`Switch unit with id ${this.unit.id} to non-interactive state`,{functionName:"switchToNonInteractive",lineNumber:175,columnNumber:6214,fileName:"src\\modes\\integrated-mode\\integrated-unit\\integrated-unit-state-manager.ts"});const{content:e,container:n,element:i,originalParent:o}=this.unit.context;if(this.unit.context.element instanceof SVGElement&&(o.className=e.className,o.removeClass("izd-content")),this.unit.context.adapter===Se.LivePreview){const s=this.unit.context.livePreviewWidget;s?.removeClass("live-preview-parent"),s?.style?.removeProperty("height"),s?.style?.removeProperty("width")}o.contains(n)?o.replaceChild(i,n):this.unit.plugin.logger.warn("Error with replace child. It seems that active leaf was changed?",{functionName:"switchToNonInteractive",lineNumber:194,columnNumber:7197,fileName:"src\\modes\\integrated-mode\\integrated-unit\\integrated-unit-state-manager.ts"}),n.remove(),e.remove(),await new Promise(s=>requestAnimationFrame(s))}waitForElementsLayout(e){return new Promise(n=>{const i=()=>{if(!this._loaded){n();return}if(!e.every(s=>{const r=s.getBoundingClientRect();return r.width>0&&r.height>0})){requestAnimationFrame(i);return}const o=e[0].getBoundingClientRect();this.unit.context.size.width===0&&(this.unit.context.size.width=o.width),this.unit.context.size.height===0&&(this.unit.context.size.height=o.height),n()};requestAnimationFrame(i)})}onunload(){super.onunload(),this.unit.plugin.emitter.off("toggle-integrated-element",this.onToggleElement),this.unit.context.element.removeAttribute("data-interactive-initialization-status"),this.unit.context.element.removeAttribute("data-interactive-mode")}},Yr=class extends R.Component{dx=0;dy=0;scale=1;active=!1;constructor(e,n,i){super(),this.id=crypto.randomUUID(),this.plugin=e,this.context=n,this.fileStats=i,this.interactiveStateManager=new Wr(this),this.actions=new Js(this),this.controlPanel=new Qe(this),this.events=new Gr(this),this.addChild(this.events),this.addChild(this.controlPanel)}async setup(){await this.interactiveStateManager.initialize()}initialize(){this.plugin.logger.debug(`Initialize unit with id ${this.id}`,{functionName:"initialize",lineNumber:46,columnNumber:1401,fileName:"src\\modes\\integrated-mode\\integrated-unit\\integrated-unit.ts"}),this.load(),this.setupEvents(),this.events.initialize(),this.controlPanel.initialize(),this.applyLayout(),this.plugin.logger.debug("Unit initialized successfully",{id:this.id,functionName:"initialize",lineNumber:56,columnNumber:1781,fileName:"src\\modes\\integrated-mode\\integrated-unit\\integrated-unit.ts"})}get realSize(){const e=()=>{const l=this.context.size,d=this.plugin.integratedMode.context.getAvailableSize(),u=d.width===0||d.height===0,p=u?l.width:Math.min(l.width,d.width),c=u?l.height:Math.min(l.height,d.height);return{width:p,height:c}},n=this.plugin.settings.$.units.size,i=this.context.container.dataset.folded==="true"?n.folded:n.expanded,o=e(),s=i.width.type==="%"?i.width.value/100*o.width:i.width.value,r=i.height.type==="%"?i.height.value/100*o.height:i.height.value;return{width:s,height:r}}applyLayout(){this.applyRealSize(),this.actions.fitToContainer({animated:!1})}applyRealSize(){const e=this.realSize;if(this.context.container.style.height=`${e.height}px`,this.context.container.style.width=`${e.width}px`,this.plugin.integratedMode.context.inLivePreviewMode){const n=this.context.livePreviewWidget;if(!n){this.plugin.logger.error("No parent found in live-preview mode",{functionName:"applyRealSize",lineNumber:117,columnNumber:3999,fileName:"src\\modes\\integrated-mode\\integrated-unit\\integrated-unit.ts"});return}n.style.setProperty("height",`${e.height}px`,"important"),n.style.setProperty("width",`${e.width}px`,"important")}}async onDelete(){await this.interactiveStateManager.deactivate(),this.interactiveStateManager.unload()}onunload(){super.onunload(),this.plugin.logger.debug(`Called unload for interactive element with id ${this.id}`,{functionName:"onunload",lineNumber:143,columnNumber:4822,fileName:"src\\modes\\integrated-mode\\integrated-unit\\integrated-unit.ts"})}setupEvents(){const e=R.debounce(this.applyLayout.bind(this),300,!0);this.plugin.emitter.on(this.plugin.settings.$$.units.size.$all,e),this.register(()=>this.plugin.emitter.off(this.plugin.settings.$$.units.size.$all,e)),this.plugin.emitter.on("leaf-layout-changed",e),this.register(()=>this.plugin.emitter.off("leaf-layout-changed",e))}},Kr=class{static async createUnit(e,n,i){e.logger.debug("Creating unit...",{functionName:"createUnit",lineNumber:11,columnNumber:353,fileName:"src\\modes\\integrated-mode\\integrated-unit\\integrated-unit-factory.ts"});const o=new Yr(e,n,i);return await o.setup(),e.logger.debug("Unit was created and initialized successfully.",{functionName:"createUnit",lineNumber:16,columnNumber:661,fileName:"src\\modes\\integrated-mode\\integrated-unit\\integrated-unit-factory.ts"}),o}},qr=class{constructor(e,n){this.integratedMode=e,this.fileStat=n}matchInteractiveElement(e){const n=e,i=this.integratedMode.plugin.settings.$.units.configs,o=i.filter(r=>![Me.IMG_SVG,Me.Default].includes(r.selector)),s=i.filter(r=>[Me.IMG_SVG,Me.Default].includes(r.selector));for(const r of[...o,...s])if(r.on&&(e.matches(r.selector)||e.closest(r.selector)))return{element:n,options:JSON.parse(JSON.stringify(r))}}initializationGuard(e){if(e.element.dataset.interactiveInitializationStatus!==void 0)return!1;let n=!0;return e.adapter===Se.LivePreview&&e.element.cmView?n=!1:[Se.Preview,Se.PickerMode].includes(e.adapter)&&(n=!0),e.element.setAttribute("data-interactive-initialization-status",n?vt.Initialized:vt.NotInitialized),n}detectDiagramLayout(e,n){const i=e/n;return i>1.5?"wide":i<.67?"tall":"proportional"}getElSize(e){const n=e.element.getBoundingClientRect();return{width:n.width,height:n.height}}async createUnit(e){const n=await Kr.createUnit(this.integratedMode.plugin,e,this.fileStat);this.emitCreated(n)}emitCreated(e){this.integratedMode.plugin.emitter.emit("unit.created",e)}finalizeContext(e){if(!e.element||!e.sourceData||!e.size||!e.container||!e.content||!e.options)throw new Error("Incomplete context");return e}async createInteractiveElementWrapper(e){const n=document.createElement("div"),i=document.createElement("div");n.addClass("izd-container"),i.addClass("izd-content");const o=e.element.parentElement,s=this.integratedMode.plugin.integratedMode.context.inPreviewMode?"preview":"live-preview";return n.setAttribute("data-izd-rendering-mode",`${s}`),n.setAttribute("data-folded",this.integratedMode.plugin.settings.$.units.folding.foldByDefault.toString()),n.setAttribute("tabindex","0"),{container:n,content:i,originalParent:o}}findElementWithLivePreviewWidget(e){if(e===void 0)return;let n=e;for(;n&&n!==document.body;){if(n?.cmView)return n;n=n?.parentElement}}async unitProcessing(e,n){if(n.adapter=e,this.integratedMode.plugin.logger.debug(`Processing unit for adapter: ${e}`,{unitType:n.options.name,functionName:"unitProcessing",lineNumber:194,columnNumber:5879,fileName:"src\\modes\\integrated-mode\\adapters\\base-adapter.ts"}),!this.initializationGuard(n)){this.integratedMode.plugin.logger.debug(`Initialization guard failed for adapter: ${e}`,{functionName:"unitProcessing",lineNumber:205,columnNumber:6357,fileName:"src\\modes\\integrated-mode\\adapters\\base-adapter.ts"});return}if(n.mode==="live-preview"){const u=this.findElementWithLivePreviewWidget(n.element);u&&(n.livePreviewWidget=u)}const i=this.getElSize(n),o=this.detectDiagramLayout(i.width,i.height),{container:s,content:r,originalParent:l}=await this.createInteractiveElementWrapper(n);n.container=s,n.content=r,n.originalParent=l,n.size=i,n.layout=o;const d=this.finalizeContext(n);await this.createUnit(d),this.integratedMode.plugin.logger.debug(`Adapter ${e} was processed successfully.`,{functionName:"unitProcessing",lineNumber:234,columnNumber:7498,fileName:"src\\modes\\integrated-mode\\adapters\\base-adapter.ts"})}};class It extends qr{constructor(e,n){super(e,n),this.integratedMode=e,this.fileStat=n}initialize=async e=>{const n=this.matchInteractiveElement(e.element);if(!n)return;const i={...n,...e},o=e.mode==="live-preview"?Se.LivePreview:Se.Preview;await this.unitProcessing(o,i)}}let Zr=class{constructor(e){this.integratedMode=e}data=new Map;orphans={units:[]};initializeLeaf(e){this.data.get(e)||(this.data.set(e,{resizeObserver:void 0,units:[],nativeTouchEventsEnabled:!0}),this.integratedMode.plugin.logger.debug(`Initialized data for leaf width id: ${e}...`,{functionName:"initializeLeaf",lineNumber:31,columnNumber:997,fileName:"src\\modes\\integrated-mode\\state.ts"}))}async cleanupLeaf(e){const n=this.data.get(e);if(!n){this.integratedMode.plugin.logger.error("No data for leaf",{leafID:e,functionName:"cleanupLeaf",lineNumber:39,columnNumber:1397,fileName:"src\\modes\\integrated-mode\\state.ts"});return}for(const i of n.units)await i.onDelete(),this.integratedMode.plugin.logger.debug("Unloaded unit",{unitName:i.context.options.name,functionName:"cleanupLeaf",lineNumber:47,columnNumber:1766,fileName:"src\\modes\\integrated-mode\\state.ts"});this.data.delete(e),this.integratedMode.plugin.logger.debug(`Data for leaf with id ${e} was cleaned successfully.`,{functionName:"cleanupLeaf",lineNumber:53,columnNumber:2099,fileName:"src\\modes\\integrated-mode\\state.ts"})}async clear(){this.integratedMode.plugin.logger.debug("Started to clear state...",{functionName:"clear",lineNumber:58,columnNumber:2399,fileName:"src\\modes\\integrated-mode\\state.ts"});for(const e of this.data.keys())await this.cleanupLeaf(e);await this.cleanOrphan(),this.integratedMode.plugin.logger.debug("State was cleared successfully.",{functionName:"clear",lineNumber:65,columnNumber:2737,fileName:"src\\modes\\integrated-mode\\state.ts"})}getResizeObserver(e){return this.data.get(e)?.resizeObserver}setResizeObserver(e,n){const i=this.data.get(e);i&&(i.resizeObserver=n)}hasResizeObserver(e){return!!this.getResizeObserver(e)}getUnits(e){return this.data.get(e)?.units??[]}pushUnit(e,n){const i=this.data.get(e);if(!i){this.integratedMode.plugin.logger.error(`No data for leafID: ${e}`,{functionName:"pushUnit",lineNumber:90,columnNumber:3631,fileName:"src\\modes\\integrated-mode\\state.ts"});return}i.units.push(n)}pushOrphanUnit(e){this.orphans.units.push(e)}async cleanOrphan(){for(const e of this.orphans.units)await e.onDelete()}async cleanupUnitsOnFileChange(e,n){const i=this.data.get(e);if(!i){this.integratedMode.plugin.logger.error(`No data for leafID: ${e}`,{functionName:"cleanupUnitsOnFileChange",lineNumber:113,columnNumber:4359,fileName:"src\\modes\\integrated-mode\\state.ts"});return}const o=n.ctime,s=[];for(const r of i.units)r.context.adapter===Se.PickerMode||o!==r.fileStats.ctime?(await r.onDelete(),this.integratedMode.plugin.logger.debug(`Cleaned up unit with id ${r.id} due to file change`,{functionName:"cleanupUnitsOnFileChange",lineNumber:127,columnNumber:4981,fileName:"src\\modes\\integrated-mode\\state.ts"})):s.push(r);i.units=s}},Xr=class extends R.Component{constructor(e){super(),this.plugin=e,this.context=new Xs(this),this.state=new Zr(this)}initialize(){this.load(),this.setupCommands(),this.setupFileMenu(),this.setupInternalEventHandlers(),this.setupObsidianEventHandlers(),this.setupDomSubscriptions()}async onunload(){await this.state.clear()}setupCommands(){this.plugin.addCommand({id:"toggle-panels-state",name:"Toggle control panels visibility for all the active interactive images in current note",checkCallback:e=>{const n=this.state.getUnits(this.context.leafID);if(e)return(this.context.inLivePreviewMode||this.context.inPreviewMode)&&this.context.active&&n.some(r=>r.active);if(!this.context.active){this.plugin.showNotice(f("d"));return}if(!n.some(r=>r.active)){this.plugin.showNotice(f("c"));return}const i=n.filter(r=>r.active),o=i.some(r=>r.controlPanel.hasVisiblePanels);i.forEach(r=>o?r.controlPanel.hide(Z.FORCE):r.controlPanel.show(Z.FORCE));const s=f(o?"b":"e");return this.plugin.showNotice(s),this.plugin.logger.debug("Called command `toggle-panels-management-state`",{functionName:"anonymous",lineNumber:80,columnNumber:2800,fileName:"src\\modes\\integrated-mode\\integrated-mode.ts"}),!0}})}setupFileMenu(){this.registerEvent(this.plugin.app.workspace.on("file-menu",e=>{if(!(this.context.inPreviewMode||this.context.inLivePreviewMode))return;const n=this.state.data.get(this.context.leafID)?.nativeTouchEventsEnabled;n!==void 0&&e.addItem(i=>{i.setIcon(n?"hand":"circle-slash-2"),i.setTitle(`Native touch: ${n?"ON":"OFF"}`),i.onClick(()=>{const o=this.state.data.get(this.context.leafID);o.nativeTouchEventsEnabled=!o.nativeTouchEventsEnabled})})}))}setupInternalEventHandlers(){this.plugin.emitter.on("unit.created",e=>{const n=this.context.leafID;if(!n){this.plugin.logger.warn("No active leaf found.",{functionName:"anonymous",lineNumber:125,columnNumber:4524,fileName:"src\\modes\\integrated-mode\\integrated-mode.ts"}),this.state.pushOrphanUnit(e),this.plugin.logger.debug(`'orphan unit with id ${e.id} was added to state'`,{functionName:"anonymous",lineNumber:127,columnNumber:4775,fileName:"src\\modes\\integrated-mode\\integrated-mode.ts"});return}this.state.pushUnit(n,e),this.plugin.logger.debug("Unit added to state",{leafID:n,unitName:e.context.options.name,functionName:"anonymous",lineNumber:132,columnNumber:5130,fileName:"src\\modes\\integrated-mode\\integrated-mode.ts"})}),this.plugin.emitter.on("create-integrated-element",async e=>{const n=this.plugin.app.workspace.getActiveViewOfType(R.MarkdownView),i=this.plugin.leafIndex.data.get(n?.leaf.id)?.imageIndex.get(e);i&&await new It(this,n.file.stat).initialize(i)}),this.plugin.emitter.on("create-integrated-element-outside-view",async e=>{await new It(this,{ctime:0,size:0,mtime:0}).initialize(e)}),this.plugin.emitter.on("leaf-index.image.added",async e=>{if(this.plugin.help.isHelpOpen)return;const n=this.plugin.app.workspace.getActiveViewOfType(R.MarkdownView);if(!n){this.plugin.logger.warn("No active Markdown view found for image data",{...e,functionName:"anonymous",lineNumber:175,columnNumber:6673,fileName:"src\\modes\\integrated-mode\\integrated-mode.ts"});return}const i=new It(this,n.file.stat);this.plugin.settings.$.units.interactivity.markdown.autoDetect&&await i.initialize(e)})}setupObsidianEventHandlers(){const e=async n=>{this.context.cleanup(i=>this.state.cleanupLeaf(i)),this.context.initialize(i=>{this.state.initializeLeaf(i),this.setupResizeObserver(i)}),this.context.active&&n==="layout-change"&&(await this.state.cleanupUnitsOnFileChange(this.context.leafID,this.context.view.file.stat),await this.state.cleanOrphan())};this.plugin.registerEvent(this.plugin.app.workspace.on("layout-change",async()=>{this.plugin.logger.debug("Calling withing the layout-change-event...",{functionName:"anonymous",lineNumber:216,columnNumber:8207,fileName:"src\\modes\\integrated-mode\\integrated-mode.ts"}),await e("layout-change");const n=this.context.leafID;if(!n)return;const i=this.plugin.leafIndex.data.get(n);if(!i)return;const o=this.context.inPreviewMode?"preview":this.context.inLivePreviewMode?"live-preview":void 0;if(!o)return;const s=new It(this,this.context.view?.file?.stat),r=i.imageIndex.values().filter(l=>l.mode===o);for(const l of r)await s.initialize(l)})),this.plugin.registerEvent(this.plugin.app.workspace.on("active-leaf-change",async()=>{this.plugin.logger.debug("Called withing the active-leaf-change event...",{functionName:"anonymous",lineNumber:254,columnNumber:9648,fileName:"src\\modes\\integrated-mode\\integrated-mode.ts"}),await e("active-leaf-change")}))}setupResizeObserver(e){if(this.state.hasResizeObserver(e))return;const n=R.debounce(()=>{this.state.getUnits(e).forEach(o=>o.applyLayout())},50,!0),i=new ResizeObserver((o,s)=>{n()});i.observe(this.context.view?.contentEl),this.state.setResizeObserver(e,i)}setupDomSubscriptions(){this.plugin.domWatcher.subscribe(e=>e.type==="attributes"&&e.target instanceof Element&&(e.target.hasClass("markdown-source-view")||e.target.hasClass("markdown-preview-view"))&&e.attributeName==="class"&&(!!e.oldValue?.contains("is-readable-line-width")||e.target.hasClass("is-readable-line-width"))&&this.context.active&&this.context.leaf.containerEl.contains(e.target),e=>{this.plugin.emitter.emit("leaf-layout-changed")})}},Jr=class extends R.Component{constructor(e){super(),this.plugin=e}isActive=!1;tooltip=null;currentElement=null;initialize(){this.load(),this.setupEvents(),this.setupCommands(),this.plugin.settings.$.units.interactivity.picker.enabled&&this.createRibbon()}pickerModeToggleHandler=e=>{e.newValue?this.createRibbon():(this.ribbonButton.removeEventListener("click",this.toggle),this.ribbonButton.remove())};setupEvents(){const e=this.plugin.settings.$$;this.plugin.emitter.on(e.units.interactivity.picker.enabled.$path,this.pickerModeToggleHandler)}setupCommands(){this.plugin.addCommand({id:"toggle-picker-mode",name:"Toggle picker mode",checkCallback:e=>{if(e)return this.plugin.settings.$.units.interactivity.picker.enabled;if(!this.plugin.settings.$.units.interactivity.picker.enabled){this.plugin.showNotice(f("a"));return}return this.toggle(),!0}})}createRibbon(){this.ribbonButton=this.plugin.addRibbonIcon("mouse-pointer-click","Picker mode",this.toggle)}toggle=e=>{this.isActive?this.deactivate():this.activate()};createTooltip(){this.tooltip=document.createElement("div"),this.tooltip.addClass("picker-mode-tooltip"),document.body.appendChild(this.tooltip)}showTooltip(e){if(!this.tooltip)return;const n=e.matches("svg,img")?e:e.querySelector("svg,img");if(!n)return;if(!hi(n)){this.tooltip.textContent="Alt+Click to open popup",this.tooltip.style.opacity="1";return}const i=n.getAttribute("data-interactive-initialization-status"),o=n.getAttribute("data-interactive-mode");let s="Make interactive";i===vt.NotInitialized?s=f("C"):s=(o===jt.Interactive?"on":"off")=="on"?f("E"):f("D"),this.tooltip.textContent=s,this.tooltip.style.opacity="1"}hideTooltip(){this.tooltip&&(this.tooltip.style.opacity="0"),this.currentElement=null}activate(){this.isActive=!0,document.body.addClass("picker-mode"),this.createTooltip(),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseover",this.onMouseOver),document.addEventListener("mouseout",this.onMouseOut),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("mousedown",this.onMouseDown,!0),document.querySelectorAll("svg, img").forEach(e=>{if(Ut(e))return;const n=e.getBoundingClientRect();n.width>=64&&n.height>=64&&e.addClass("interactive-candidate")}),this.plugin.showNotice(f("G"),1e4)}deactivate(){this.isActive&&(this.isActive=!1,document.body.removeClass("picker-mode"),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseover",this.onMouseOver),document.removeEventListener("mouseout",this.onMouseOut),document.removeEventListener("mousedown",this.onMouseDown,!0),document.removeEventListener("keydown",this.onKeyDown),document.querySelectorAll("svg, img").forEach(e=>{e.removeClass("interactive-candidate")}),this.tooltip?.remove(),this.tooltip=null,this.currentElement=null,this.plugin.showNotice(f("F"),1e4))}onMouseMove=e=>{this.tooltip&&(this.tooltip.style.left=`${e.clientX+12}px`,this.tooltip.style.top=`${e.clientY-32}px`)};onMouseOver=e=>{const n=e.target,i=n.closest(".cm-preview-code-block")||n.closest("svg,img,.izd-container");if(!i)return;const o=i.getBoundingClientRect();if(!(o.width>=64&&o.height>=64)){this.hideTooltip();return}this.currentElement=i,this.showTooltip(i)};onMouseOut=e=>{const n=e.target;(n.closest(".cm-preview-code-block")||n.closest("svg,img,.izd-container"))===this.currentElement&&this.hideTooltip()};onKeyDown=e=>{e.key==="Escape"&&this.isActive&&this.deactivate()};onMouseDown=async e=>{if(!(e.target instanceof Element))return;e.stopPropagation(),e.preventDefault();let n=e.target.closest(".cm-preview-code-block")||e.target.closest("svg,img,.izd-container");if(!n){this.deactivate();return}n=n?.matches("svg,img")?n:n?.querySelector("svg,img");const i=n;if(e.altKey){if(n instanceof SVGElement){this.plugin.showNotice("SVG support coming soon! Stay tuned!");return}await this.plugin.popupMode.showPopup(i),this.deactivate();return}if(hi(i)){if(i.dataset.interactiveInitializationStatus===vt.Initialized){this.plugin.emitter.emit("toggle-integrated-element",{element:n}),this.showTooltip(i);return}this.plugin.emitter.emit("create-integrated-element",i),this.showTooltip(i)}};onunload(){this.deactivate(),super.onunload(),this.plugin.emitter.off(this.plugin.settings.$$.units.interactivity.picker.enabled.$path,this.pickerModeToggleHandler)}};const Wo=Fe(void 0),Qr=({popupMode:t,initialImages:e,onClose:n,children:i})=>{const[o,s]=O(e),[r,l]=O(0),d=ce(()=>({popupMode:t,onClose:n,images:o,setImages:s,activeImageIndex:r,setActiveImageIndex:l}),[t,n,o,s,r,l]);return a(Wo.Provider,{value:d,children:i})},kt=()=>{const t=ke(Wo);if(t===void 0)throw new Error("usePopupContext must be used within a PopupProvider");return t};var ve=function(){return ve=Object.assign||function(e){for(var n,i=1,o=arguments.length;i<o;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ve.apply(this,arguments)};function wt(t,e,n){if(n||arguments.length===2)for(var i=0,o=e.length,s;i<o;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}function ea(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ta(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function i(){var o=!1;try{o=this instanceof i}catch{}return o?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var o=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:function(){return t[i]}})}),n}var te="-ms-",ft="-moz-",J="-webkit-",Yo="comm",Qt="rule",ii="decl",na="@import",Ko="@keyframes",ia="@layer",qo=Math.abs,oi=String.fromCharCode,In=Object.assign;function oa(t,e){return he(t,0)^45?(((e<<2^he(t,0))<<2^he(t,1))<<2^he(t,2))<<2^he(t,3):0}function Zo(t){return t.trim()}function Ie(t,e){return(t=e.exec(t))?t[0]:t}function V(t,e,n){return t.replace(e,n)}function Tt(t,e,n){return t.indexOf(e,n)}function he(t,e){return t.charCodeAt(e)|0}function ot(t,e,n){return t.slice(e,n)}function xe(t){return t.length}function Xo(t){return t.length}function pt(t,e){return e.push(t),t}function sa(t,e){return t.map(e).join("")}function Di(t,e){return t.filter(function(n){return!Ie(n,e)})}var en=1,st=1,Jo=0,be=0,ae=0,ut="";function tn(t,e,n,i,o,s,r,l){return{value:t,root:e,parent:n,type:i,props:o,children:s,line:en,column:st,length:r,return:"",siblings:l}}function ze(t,e){return In(tn("",null,null,"",null,null,0,t.siblings),t,{length:-t.length},e)}function Xe(t){for(;t.root;)t=ze(t.root,{children:[t]});pt(t,t.siblings)}function ra(){return ae}function aa(){return ae=be>0?he(ut,--be):0,st--,ae===10&&(st=1,en--),ae}function _e(){return ae=be<Jo?he(ut,be++):0,st++,ae===10&&(st=1,en++),ae}function We(){return he(ut,be)}function Ot(){return be}function nn(t,e){return ot(ut,t,e)}function Mn(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function la(t){return en=st=1,Jo=xe(ut=t),be=0,[]}function ca(t){return ut="",t}function pn(t){return Zo(nn(be-1,Ln(t===91?t+2:t===40?t+1:t)))}function ua(t){for(;(ae=We())&&ae<33;)_e();return Mn(t)>2||Mn(ae)>3?"":" "}function da(t,e){for(;--e&&_e()&&!(ae<48||ae>102||ae>57&&ae<65||ae>70&&ae<97););return nn(t,Ot()+(e<6&&We()==32&&_e()==32))}function Ln(t){for(;_e();)switch(ae){case t:return be;case 34:case 39:t!==34&&t!==39&&Ln(ae);break;case 40:t===41&&Ln(t);break;case 92:_e();break}return be}function ha(t,e){for(;_e()&&t+ae!==57&&!(t+ae===84&&We()===47););return"/*"+nn(e,be-1)+"*"+oi(t===47?t:_e())}function pa(t){for(;!Mn(We());)_e();return nn(t,be)}function ga(t){return ca(zt("",null,null,null,[""],t=la(t),0,[0],t))}function zt(t,e,n,i,o,s,r,l,d){for(var u=0,p=0,c=r,v=0,m=0,x=0,C=1,E=1,N=1,I=0,L="",D=o,M=s,A=i,T=L;E;)switch(x=I,I=_e()){case 40:if(x!=108&&he(T,c-1)==58){Tt(T+=V(pn(I),"&","&\f"),"&\f",qo(u?l[u-1]:0))!=-1&&(N=-1);break}case 34:case 39:case 91:T+=pn(I);break;case 9:case 10:case 13:case 32:T+=ua(x);break;case 92:T+=da(Ot()-1,7);continue;case 47:switch(We()){case 42:case 47:pt(ma(ha(_e(),Ot()),e,n,d),d);break;default:T+="/"}break;case 123*C:l[u++]=xe(T)*N;case 125*C:case 59:case 0:switch(I){case 0:case 125:E=0;case 59+p:N==-1&&(T=V(T,/\f/g,"")),m>0&&xe(T)-c&&pt(m>32?Ti(T+";",i,n,c-1,d):Ti(V(T," ","")+";",i,n,c-2,d),d);break;case 59:T+=";";default:if(pt(A=Ai(T,e,n,u,p,o,l,L,D=[],M=[],c,s),s),I===123)if(p===0)zt(T,e,A,A,D,s,c,l,M);else switch(v===99&&he(T,3)===110?100:v){case 100:case 108:case 109:case 115:zt(t,A,A,i&&pt(Ai(t,A,A,0,0,o,l,L,o,D=[],c,M),M),o,M,c,l,i?D:M);break;default:zt(T,A,A,A,[""],M,0,l,M)}}u=p=m=0,C=N=1,L=T="",c=r;break;case 58:c=1+xe(T),m=x;default:if(C<1){if(I==123)--C;else if(I==125&&C++==0&&aa()==125)continue}switch(T+=oi(I),I*C){case 38:N=p>0?1:(T+="\f",-1);break;case 44:l[u++]=(xe(T)-1)*N,N=1;break;case 64:We()===45&&(T+=pn(_e())),v=We(),p=c=xe(L=T+=pa(Ot())),I++;break;case 45:x===45&&xe(T)==2&&(C=0)}}return s}function Ai(t,e,n,i,o,s,r,l,d,u,p,c){for(var v=o-1,m=o===0?s:[""],x=Xo(m),C=0,E=0,N=0;C<i;++C)for(var I=0,L=ot(t,v+1,v=qo(E=r[C])),D=t;I<x;++I)(D=Zo(E>0?m[I]+" "+L:V(L,/&\f/g,m[I])))&&(d[N++]=D);return tn(t,e,n,o===0?Qt:l,d,u,p,c)}function ma(t,e,n,i){return tn(t,e,n,Yo,oi(ra()),ot(t,2,-2),0,i)}function Ti(t,e,n,i,o){return tn(t,e,n,ii,ot(t,0,i),ot(t,i+1,-1),i,o)}function Qo(t,e,n){switch(oa(t,e)){case 5103:return J+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return J+t+t;case 4789:return ft+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return J+t+ft+t+te+t+t;case 5936:switch(he(t,e+11)){case 114:return J+t+te+V(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return J+t+te+V(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return J+t+te+V(t,/[svh]\w+-[tblr]{2}/,"lr")+t}case 6828:case 4268:case 2903:return J+t+te+t+t;case 6165:return J+t+te+"flex-"+t+t;case 5187:return J+t+V(t,/(\w+).+(:[^]+)/,J+"box-$1$2"+te+"flex-$1$2")+t;case 5443:return J+t+te+"flex-item-"+V(t,/flex-|-self/g,"")+(Ie(t,/flex-|baseline/)?"":te+"grid-row-"+V(t,/flex-|-self/g,""))+t;case 4675:return J+t+te+"flex-line-pack"+V(t,/align-content|flex-|-self/g,"")+t;case 5548:return J+t+te+V(t,"shrink","negative")+t;case 5292:return J+t+te+V(t,"basis","preferred-size")+t;case 6060:return J+"box-"+V(t,"-grow","")+J+t+te+V(t,"grow","positive")+t;case 4554:return J+V(t,/([^-])(transform)/g,"$1"+J+"$2")+t;case 6187:return V(V(V(t,/(zoom-|grab)/,J+"$1"),/(image-set)/,J+"$1"),t,"")+t;case 5495:case 3959:return V(t,/(image-set\([^]*)/,J+"$1$`$1");case 4968:return V(V(t,/(.+:)(flex-)?(.*)/,J+"box-pack:$3"+te+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+J+t+t;case 4200:if(!Ie(t,/flex-|baseline/))return te+"grid-column-align"+ot(t,e)+t;break;case 2592:case 3360:return te+V(t,"template-","")+t;case 4384:case 3616:return n&&n.some(function(i,o){return e=o,Ie(i.props,/grid-\w+-end/)})?~Tt(t+(n=n[e].value),"span",0)?t:te+V(t,"-start","")+t+te+"grid-row-span:"+(~Tt(n,"span",0)?Ie(n,/\d+/):+Ie(n,/\d+/)-+Ie(t,/\d+/))+";":te+V(t,"-start","")+t;case 4896:case 4128:return n&&n.some(function(i){return Ie(i.props,/grid-\w+-start/)})?t:te+V(V(t,"-end","-span"),"span ","")+t;case 4095:case 3583:case 4068:case 2532:return V(t,/(.+)-inline(.+)/,J+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(xe(t)-1-e>6)switch(he(t,e+1)){case 109:if(he(t,e+4)!==45)break;case 102:return V(t,/(.+:)(.+)-([^]+)/,"$1"+J+"$2-$3$1"+ft+(he(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~Tt(t,"stretch",0)?Qo(V(t,"stretch","fill-available"),e,n)+t:t}break;case 5152:case 5920:return V(t,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(i,o,s,r,l,d,u){return te+o+":"+s+u+(r?te+o+"-span:"+(l?d:+d-+s)+u:"")+t});case 4949:if(he(t,e+6)===121)return V(t,":",":"+J)+t;break;case 6444:switch(he(t,he(t,14)===45?18:11)){case 120:return V(t,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+J+(he(t,14)===45?"inline-":"")+"box$3$1"+J+"$2$3$1"+te+"$2box$3")+t;case 100:return V(t,":",":"+te)+t}break;case 5719:case 2647:case 2135:case 3927:case 2391:return V(t,"scroll-","scroll-snap-")+t}return t}function Vt(t,e){for(var n="",i=0;i<t.length;i++)n+=e(t[i],i,t,e)||"";return n}function fa(t,e,n,i){switch(t.type){case ia:if(t.children.length)break;case na:case ii:return t.return=t.return||t.value;case Yo:return"";case Ko:return t.return=t.value+"{"+Vt(t.children,i)+"}";case Qt:if(!xe(t.value=t.props.join(",")))return""}return xe(n=Vt(t.children,i))?t.return=t.value+"{"+n+"}":""}function va(t){var e=Xo(t);return function(n,i,o,s){for(var r="",l=0;l<e;l++)r+=t[l](n,i,o,s)||"";return r}}function ya(t){return function(e){e.root||(e=e.return)&&t(e)}}function ba(t,e,n,i){if(t.length>-1&&!t.return)switch(t.type){case ii:t.return=Qo(t.value,t.length,n);return;case Ko:return Vt([ze(t,{value:V(t.value,"@","@"+J)})],i);case Qt:if(t.length)return sa(n=t.props,function(o){switch(Ie(o,i=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Xe(ze(t,{props:[V(o,/:(read-\w+)/,":"+ft+"$1")]})),Xe(ze(t,{props:[o]})),In(t,{props:Di(n,i)});break;case"::placeholder":Xe(ze(t,{props:[V(o,/:(plac\w+)/,":"+J+"input-$1")]})),Xe(ze(t,{props:[V(o,/:(plac\w+)/,":"+ft+"$1")]})),Xe(ze(t,{props:[V(o,/:(plac\w+)/,te+"input-$1")]})),Xe(ze(t,{props:[o]})),In(t,{props:Di(n,i)});break}return""})}}var wa={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},rt=typeof process<"u"&&process.env!==void 0&&(process.env.REACT_APP_SC_ATTR||process.env.SC_ATTR)||"data-styled",es="active",ts="data-styled-version",on="6.1.19",si=`/*!sc*/
`,Gt=typeof window<"u"&&typeof document<"u",_a=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&process.env!==void 0&&process.env.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&process.env.REACT_APP_SC_DISABLE_SPEEDY!==""?process.env.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&process.env.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&process.env!==void 0&&process.env.SC_DISABLE_SPEEDY!==void 0&&process.env.SC_DISABLE_SPEEDY!==""&&process.env.SC_DISABLE_SPEEDY!=="false"&&process.env.SC_DISABLE_SPEEDY),sn=Object.freeze([]),at=Object.freeze({});function xa(t,e,n){return n===void 0&&(n=at),t.theme!==n.theme&&t.theme||e||n.theme}var ns=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),Ca=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,Sa=/(^-|-$)/g;function Oi(t){return t.replace(Ca,"-").replace(Sa,"")}var $a=/(a)(d)/gi,Mt=52,zi=function(t){return String.fromCharCode(t+(t>25?39:97))};function Dn(t){var e,n="";for(e=Math.abs(t);e>Mt;e=e/Mt|0)n=zi(e%Mt)+n;return(zi(e%Mt)+n).replace($a,"$1-$2")}var gn,is=5381,tt=function(t,e){for(var n=e.length;n;)t=33*t^e.charCodeAt(--n);return t},os=function(t){return tt(is,t)};function ss(t){return Dn(os(t)>>>0)}function ka(t){return t.displayName||t.name||"Component"}function mn(t){return typeof t=="string"&&!0}var rs=typeof Symbol=="function"&&Symbol.for,as=rs?Symbol.for("react.memo"):60115,Ea=rs?Symbol.for("react.forward_ref"):60112,Na={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},Pa={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},ls={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Ia=((gn={})[Ea]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},gn[as]=ls,gn);function Ri(t){return("type"in(e=t)&&e.type.$$typeof)===as?ls:"$$typeof"in t?Ia[t.$$typeof]:Na;var e}var Ma=Object.defineProperty,La=Object.getOwnPropertyNames,Fi=Object.getOwnPropertySymbols,Da=Object.getOwnPropertyDescriptor,Aa=Object.getPrototypeOf,Ui=Object.prototype;function cs(t,e,n){if(typeof e!="string"){if(Ui){var i=Aa(e);i&&i!==Ui&&cs(t,i,n)}var o=La(e);Fi&&(o=o.concat(Fi(e)));for(var s=Ri(t),r=Ri(e),l=0;l<o.length;++l){var d=o[l];if(!(d in Pa||n&&n[d]||r&&d in r||s&&d in s)){var u=Da(e,d);try{Ma(t,d,u)}catch{}}}}return t}function lt(t){return typeof t=="function"}function ri(t){return typeof t=="object"&&"styledComponentId"in t}function Ve(t,e){return t&&e?"".concat(t," ").concat(e):t||e||""}function An(t,e){if(t.length===0)return"";for(var n=t[0],i=1;i<t.length;i++)n+=t[i];return n}function _t(t){return t!==null&&typeof t=="object"&&t.constructor.name===Object.name&&!("props"in t&&t.$$typeof)}function Tn(t,e,n){if(n===void 0&&(n=!1),!n&&!_t(t)&&!Array.isArray(t))return e;if(Array.isArray(e))for(var i=0;i<e.length;i++)t[i]=Tn(t[i],e[i]);else if(_t(e))for(var i in e)t[i]=Tn(t[i],e[i]);return t}function ai(t,e){Object.defineProperty(t,"toString",{value:e})}function Et(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(t," for more information.").concat(e.length>0?" Args: ".concat(e.join(", ")):""))}var Ta=function(){function t(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return t.prototype.indexOfGroup=function(e){for(var n=0,i=0;i<e;i++)n+=this.groupSizes[i];return n},t.prototype.insertRules=function(e,n){if(e>=this.groupSizes.length){for(var i=this.groupSizes,o=i.length,s=o;e>=s;)if((s<<=1)<0)throw Et(16,"".concat(e));this.groupSizes=new Uint32Array(s),this.groupSizes.set(i),this.length=s;for(var r=o;r<s;r++)this.groupSizes[r]=0}for(var l=this.indexOfGroup(e+1),d=(r=0,n.length);r<d;r++)this.tag.insertRule(l,n[r])&&(this.groupSizes[e]++,l++)},t.prototype.clearGroup=function(e){if(e<this.length){var n=this.groupSizes[e],i=this.indexOfGroup(e),o=i+n;this.groupSizes[e]=0;for(var s=i;s<o;s++)this.tag.deleteRule(i)}},t.prototype.getGroup=function(e){var n="";if(e>=this.length||this.groupSizes[e]===0)return n;for(var i=this.groupSizes[e],o=this.indexOfGroup(e),s=o+i,r=o;r<s;r++)n+="".concat(this.tag.getRule(r)).concat(si);return n},t}(),Rt=new Map,Wt=new Map,Ft=1,Lt=function(t){if(Rt.has(t))return Rt.get(t);for(;Wt.has(Ft);)Ft++;var e=Ft++;return Rt.set(t,e),Wt.set(e,t),e},Oa=function(t,e){Ft=e+1,Rt.set(t,e),Wt.set(e,t)},za="style[".concat(rt,"][").concat(ts,'="').concat(on,'"]'),Ra=new RegExp("^".concat(rt,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),Fa=function(t,e,n){for(var i,o=n.split(","),s=0,r=o.length;s<r;s++)(i=o[s])&&t.registerName(e,i)},Ua=function(t,e){for(var n,i=((n=e.textContent)!==null&&n!==void 0?n:"").split(si),o=[],s=0,r=i.length;s<r;s++){var l=i[s].trim();if(l){var d=l.match(Ra);if(d){var u=0|parseInt(d[1],10),p=d[2];u!==0&&(Oa(p,u),Fa(t,p,d[3]),t.getTag().insertRules(u,o)),o.length=0}else o.push(l)}}},ji=function(t){for(var e=document.querySelectorAll(za),n=0,i=e.length;n<i;n++){var o=e[n];o&&o.getAttribute(rt)!==es&&(Ua(t,o),o.parentNode&&o.parentNode.removeChild(o))}};function ja(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var us=function(t){var e=document.head,n=t||e,i=document.createElement("style"),o=function(l){var d=Array.from(l.querySelectorAll("style[".concat(rt,"]")));return d[d.length-1]}(n),s=o!==void 0?o.nextSibling:null;i.setAttribute(rt,es),i.setAttribute(ts,on);var r=ja();return r&&i.setAttribute("nonce",r),n.insertBefore(i,s),i},Ba=function(){function t(e){this.element=us(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var i=document.styleSheets,o=0,s=i.length;o<s;o++){var r=i[o];if(r.ownerNode===n)return r}throw Et(17)}(this.element),this.length=0}return t.prototype.insertRule=function(e,n){try{return this.sheet.insertRule(n,e),this.length++,!0}catch{return!1}},t.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},t.prototype.getRule=function(e){var n=this.sheet.cssRules[e];return n&&n.cssText?n.cssText:""},t}(),Ha=function(){function t(e){this.element=us(e),this.nodes=this.element.childNodes,this.length=0}return t.prototype.insertRule=function(e,n){if(e<=this.length&&e>=0){var i=document.createTextNode(n);return this.element.insertBefore(i,this.nodes[e]||null),this.length++,!0}return!1},t.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},t.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},t}(),Va=function(){function t(e){this.rules=[],this.length=0}return t.prototype.insertRule=function(e,n){return e<=this.length&&(this.rules.splice(e,0,n),this.length++,!0)},t.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},t.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},t}(),Bi=Gt,Ga={isServer:!Gt,useCSSOMInjection:!_a},ds=function(){function t(e,n,i){e===void 0&&(e=at),n===void 0&&(n={});var o=this;this.options=ve(ve({},Ga),e),this.gs=n,this.names=new Map(i),this.server=!!e.isServer,!this.server&&Gt&&Bi&&(Bi=!1,ji(this)),ai(this,function(){return function(s){for(var r=s.getTag(),l=r.length,d="",u=function(c){var v=function(N){return Wt.get(N)}(c);if(v===void 0)return"continue";var m=s.names.get(v),x=r.getGroup(c);if(m===void 0||!m.size||x.length===0)return"continue";var C="".concat(rt,".g").concat(c,'[id="').concat(v,'"]'),E="";m!==void 0&&m.forEach(function(N){N.length>0&&(E+="".concat(N,","))}),d+="".concat(x).concat(C,'{content:"').concat(E,'"}').concat(si)},p=0;p<l;p++)u(p);return d}(o)})}return t.registerId=function(e){return Lt(e)},t.prototype.rehydrate=function(){!this.server&&Gt&&ji(this)},t.prototype.reconstructWithOptions=function(e,n){return n===void 0&&(n=!0),new t(ve(ve({},this.options),e),this.gs,n&&this.names||void 0)},t.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},t.prototype.getTag=function(){return this.tag||(this.tag=(e=function(n){var i=n.useCSSOMInjection,o=n.target;return n.isServer?new Va(o):i?new Ba(o):new Ha(o)}(this.options),new Ta(e)));var e},t.prototype.hasNameForId=function(e,n){return this.names.has(e)&&this.names.get(e).has(n)},t.prototype.registerName=function(e,n){if(Lt(e),this.names.has(e))this.names.get(e).add(n);else{var i=new Set;i.add(n),this.names.set(e,i)}},t.prototype.insertRules=function(e,n,i){this.registerName(e,n),this.getTag().insertRules(Lt(e),i)},t.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},t.prototype.clearRules=function(e){this.getTag().clearGroup(Lt(e)),this.clearNames(e)},t.prototype.clearTag=function(){this.tag=void 0},t}(),Wa=/&/g,Ya=/^\s*\/\/.*$/gm;function hs(t,e){return t.map(function(n){return n.type==="rule"&&(n.value="".concat(e," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(e," ")),n.props=n.props.map(function(i){return"".concat(e," ").concat(i)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=hs(n.children,e)),n})}function Ka(t){var e,n,i,o=at,s=o.options,r=s===void 0?at:s,l=o.plugins,d=l===void 0?sn:l,u=function(v,m,x){return x.startsWith(n)&&x.endsWith(n)&&x.replaceAll(n,"").length>0?".".concat(e):v},p=d.slice();p.push(function(v){v.type===Qt&&v.value.includes("&")&&(v.props[0]=v.props[0].replace(Wa,n).replace(i,u))}),r.prefix&&p.push(ba),p.push(fa);var c=function(v,m,x,C){m===void 0&&(m=""),x===void 0&&(x=""),C===void 0&&(C="&"),e=C,n=m,i=new RegExp("\\".concat(n,"\\b"),"g");var E=v.replace(Ya,""),N=ga(x||m?"".concat(x," ").concat(m," { ").concat(E," }"):E);r.namespace&&(N=hs(N,r.namespace));var I=[];return Vt(N,va(p.concat(ya(function(L){return I.push(L)})))),I};return c.hash=d.length?d.reduce(function(v,m){return m.name||Et(15),tt(v,m.name)},is).toString():"",c}var qa=new ds,On=Ka(),ps=oe.createContext({shouldForwardProp:void 0,styleSheet:qa,stylis:On});ps.Consumer;oe.createContext(void 0);function Hi(){return ke(ps)}var gs=function(){function t(e,n){var i=this;this.inject=function(o,s){s===void 0&&(s=On);var r=i.name+s.hash;o.hasNameForId(i.id,r)||o.insertRules(i.id,r,s(i.rules,r,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=n,ai(this,function(){throw Et(12,String(i.name))})}return t.prototype.getName=function(e){return e===void 0&&(e=On),this.name+e.hash},t}(),Za=function(t){return t>="A"&&t<="Z"};function Vi(t){for(var e="",n=0;n<t.length;n++){var i=t[n];if(n===1&&i==="-"&&t[0]==="-")return t;Za(i)?e+="-"+i.toLowerCase():e+=i}return e.startsWith("ms-")?"-"+e:e}var ms=function(t){return t==null||t===!1||t===""},fs=function(t){var e,n,i=[];for(var o in t){var s=t[o];t.hasOwnProperty(o)&&!ms(s)&&(Array.isArray(s)&&s.isCss||lt(s)?i.push("".concat(Vi(o),":"),s,";"):_t(s)?i.push.apply(i,wt(wt(["".concat(o," {")],fs(s),!1),["}"],!1)):i.push("".concat(Vi(o),": ").concat((e=o,(n=s)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||e in wa||e.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return i};function Ye(t,e,n,i){if(ms(t))return[];if(ri(t))return[".".concat(t.styledComponentId)];if(lt(t)){if(!lt(s=t)||s.prototype&&s.prototype.isReactComponent||!e)return[t];var o=t(e);return Ye(o,e,n,i)}var s;return t instanceof gs?n?(t.inject(n,i),[t.getName(i)]):[t]:_t(t)?fs(t):Array.isArray(t)?Array.prototype.concat.apply(sn,t.map(function(r){return Ye(r,e,n,i)})):[t.toString()]}function Xa(t){for(var e=0;e<t.length;e+=1){var n=t[e];if(lt(n)&&!ri(n))return!1}return!0}var Ja=os(on),Qa=function(){function t(e,n,i){this.rules=e,this.staticRulesId="",this.isStatic=(i===void 0||i.isStatic)&&Xa(e),this.componentId=n,this.baseHash=tt(Ja,n),this.baseStyle=i,ds.registerId(n)}return t.prototype.generateAndInjectStyles=function(e,n,i){var o=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,n,i):"";if(this.isStatic&&!i.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))o=Ve(o,this.staticRulesId);else{var s=An(Ye(this.rules,e,n,i)),r=Dn(tt(this.baseHash,s)>>>0);if(!n.hasNameForId(this.componentId,r)){var l=i(s,".".concat(r),void 0,this.componentId);n.insertRules(this.componentId,r,l)}o=Ve(o,r),this.staticRulesId=r}else{for(var d=tt(this.baseHash,i.hash),u="",p=0;p<this.rules.length;p++){var c=this.rules[p];if(typeof c=="string")u+=c;else if(c){var v=An(Ye(c,e,n,i));d=tt(d,v+p),u+=v}}if(u){var m=Dn(d>>>0);n.hasNameForId(this.componentId,m)||n.insertRules(this.componentId,m,i(u,".".concat(m),void 0,this.componentId)),o=Ve(o,m)}}return o},t}(),vs=oe.createContext(void 0);vs.Consumer;var fn={};function el(t,e,n){var i=ri(t),o=t,s=!mn(t),r=e.attrs,l=r===void 0?sn:r,d=e.componentId,u=d===void 0?function(D,M){var A=typeof D!="string"?"sc":Oi(D);fn[A]=(fn[A]||0)+1;var T="".concat(A,"-").concat(ss(on+A+fn[A]));return M?"".concat(M,"-").concat(T):T}(e.displayName,e.parentComponentId):d,p=e.displayName,c=p===void 0?function(D){return mn(D)?"styled.".concat(D):"Styled(".concat(ka(D),")")}(t):p,v=e.displayName&&e.componentId?"".concat(Oi(e.displayName),"-").concat(e.componentId):e.componentId||u,m=i&&o.attrs?o.attrs.concat(l).filter(Boolean):l,x=e.shouldForwardProp;if(i&&o.shouldForwardProp){var C=o.shouldForwardProp;if(e.shouldForwardProp){var E=e.shouldForwardProp;x=function(D,M){return C(D,M)&&E(D,M)}}else x=C}var N=new Qa(n,v,i?o.componentStyle:void 0);function I(D,M){return function(A,T,G){var U=A.attrs,de=A.componentStyle,re=A.defaultProps,ge=A.foldedComponentIds,Ae=A.styledComponentId,Te=A.target,j=oe.useContext(vs),Oe=Hi(),ye=A.shouldForwardProp||Oe.shouldForwardProp,h=xa(T,j,re)||at,g=function(P,$,k){for(var F,ee=ve(ve({},$),{className:void 0,theme:k}),K=0;K<P.length;K+=1){var Y=lt(F=P[K])?F(ee):F;for(var X in Y)ee[X]=X==="className"?Ve(ee[X],Y[X]):X==="style"?ve(ve({},ee[X]),Y[X]):Y[X]}return $.className&&(ee.className=Ve(ee.className,$.className)),ee}(U,T,h),y=g.as||Te,b={};for(var w in g)g[w]===void 0||w[0]==="$"||w==="as"||w==="theme"&&g.theme===h||(w==="forwardedAs"?b.as=g.forwardedAs:ye&&!ye(w,y)||(b[w]=g[w]));var _=function(P,$){var k=Hi(),F=P.generateAndInjectStyles($,k.styleSheet,k.stylis);return F}(de,g),S=Ve(ge,Ae);return _&&(S+=" "+_),g.className&&(S+=" "+g.className),b[mn(y)&&!ns.has(y)?"class":"className"]=S,G&&(b.ref=G),ue(y,b)}(L,D,M)}I.displayName=c;var L=oe.forwardRef(I);return L.attrs=m,L.componentStyle=N,L.displayName=c,L.shouldForwardProp=x,L.foldedComponentIds=i?Ve(o.foldedComponentIds,o.styledComponentId):"",L.styledComponentId=v,L.target=i?o.target:t,Object.defineProperty(L,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(D){this._foldedDefaultProps=i?function(M){for(var A=[],T=1;T<arguments.length;T++)A[T-1]=arguments[T];for(var G=0,U=A;G<U.length;G++)Tn(M,U[G],!0);return M}({},o.defaultProps,D):D}}),ai(L,function(){return".".concat(L.styledComponentId)}),s&&cs(L,t,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),L}function Gi(t,e){for(var n=[t[0]],i=0,o=e.length;i<o;i+=1)n.push(e[i],t[i+1]);return n}var Wi=function(t){return Object.assign(t,{isCss:!0})};function ys(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(lt(t)||_t(t))return Wi(Ye(Gi(sn,wt([t],e,!0))));var i=t;return e.length===0&&i.length===1&&typeof i[0]=="string"?Ye(i):Wi(Ye(Gi(i,e)))}function zn(t,e,n){if(n===void 0&&(n=at),!e)throw Et(1,e);var i=function(o){for(var s=[],r=1;r<arguments.length;r++)s[r-1]=arguments[r];return t(e,n,ys.apply(void 0,wt([o],s,!1)))};return i.attrs=function(o){return zn(t,e,ve(ve({},n),{attrs:Array.prototype.concat(n.attrs,o).filter(Boolean)}))},i.withConfig=function(o){return zn(t,e,ve(ve({},n),o))},i}var bs=function(t){return zn(el,t)},B=bs;ns.forEach(function(t){B[t]=bs(t)});function ws(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=An(ys.apply(void 0,wt([t],e,!1))),o=ss(i);return new gs(o,i)}const Yt=B.button.withConfig({displayName:"Popupstyled__BaseButton",componentId:"sc-ghwxu6-0"})(["position:relative;&::after{content:attr(data-tooltip);position:absolute;bottom:-30px;left:50%;transform:translateX(-50%);background:black;color:white;padding:4px 8px;border-radius:4px;font-size:12px;opacity:0;visibility:hidden;transition:opacity 0.2s;}&:hover::after{opacity:1;visibility:visible;}"]),tl=B.div.withConfig({displayName:"Popupstyled__Overlay",componentId:"sc-ghwxu6-1"})(["position:fixed;cursor:pointer;font-size:0;line-height:0;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.6);z-index:9999;height:100vh;width:100vw;display:flex;flex-direction:column;"]),nl=({img:t})=>a(W,{children:t instanceof HTMLImageElement&&a("img",{src:t.src,alt:t.src})});ws(["from{opacity:0;transform:scale(0.95);}to{opacity:1;transform:scale(1);}"]);const il=B.div.withConfig({displayName:"Content__X",componentId:"sc-41m4v6-0"})(["transform:translate(","px,","px) scale(",");cursor:",";pointer-events:auto;transition:",";transform-origin:center;"],t=>t.x,t=>t.y,t=>t.scale,t=>t.isDragging?"grabbing":"grab",t=>t.isDragging?"none":"transform 0.2s ease"),Yi=B.button.withConfig({displayName:"Content__L",componentId:"sc-41m4v6-1"})(["position:absolute;top:50%;",":20px;transform:translateY(-50%);width:50px;height:50px;background:rgba(0,0,0,0.3);border:none;border-radius:50%;color:white;font-size:24px;opacity:0.7;transition:opacity 0.2s ease,background 0.2s ease;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:10;pointer-events:auto;&:hover{opacity:1 !important;background:rgba(0,0,0,0.6);}"],t=>t.$side),ol=B.div.withConfig({displayName:"Content__j",componentId:"sc-41m4v6-2"})(["display:flex;flex:1;align-items:center;justify-content:center;overflow:hidden;pointer-events:none;position:relative;"]),sl=()=>{const{images:t,activeImageIndex:e,setActiveImageIndex:n}=kt(),i=pe(null),o=pe(null),[s,r]=O(!1),[l,d]=O({x:0,y:0}),[u,p]=O({x:0,y:0}),[c,v]=O(1),m=D=>{D.stopPropagation(),e>0&&n(e-1)},x=D=>{D.stopPropagation(),e<t.length-1&&n(e+1)},C=()=>{if(!i.current||!o.current)return 1;const D=i.current,M=t[e];if(!M)return 1;const A=D.clientWidth,T=D.clientHeight;let G,U;if(M instanceof HTMLImageElement)G=M.naturalWidth,U=M.naturalHeight;else{const j=M.getBoundingClientRect();G=j.width,U=j.height}const de=40,re=A-de,ge=T-de,Ae=re/G,Te=ge/U;return Math.min(Ae,Te,1)};q(()=>{d({x:0,y:0}),p({x:0,y:0}),setTimeout(()=>{const D=C();v(D)},50)},[e]);const E=D=>{r(!0),p({x:D.clientX-l.x,y:D.clientY-l.y}),D.preventDefault()},N=D=>{s&&d({x:D.clientX-u.x,y:D.clientY-u.y})},I=()=>{r(!1)},L=D=>{D.preventDefault();const M=.1,A=D.deltaY>0?-M:M;v(T=>{const G=T+A;return Math.max(.1,Math.min(5,G))})};return q(()=>(document.addEventListener("wheel",L),()=>{document.removeEventListener("wheel",L)}),[]),q(()=>s?(document.addEventListener("mousemove",N),document.addEventListener("mouseup",I),()=>{document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",I)}):()=>{},[s,u]),a(ol,{ref:i,children:[a(il,{isDragging:s,x:l.x,y:l.y,scale:c,onMouseDown:E,children:a("div",{ref:o,children:a(nl,{img:t[e]})})}),e>0&&a(Yi,{$side:"left",onClick:m,children:"\u2039"}),e<t.length-1&&a(Yi,{$side:"right",onClick:x,children:"\u203A"})]})},rl=B.div.withConfig({displayName:"Footer__w",componentId:"sc-15ektlo-0"})(["display:flex;flex-direction:column;align-items:center;gap:10px;padding:10px;"]),al=B.div.withConfig({displayName:"Footer__M",componentId:"sc-15ektlo-1"})(["color:#fff;font-size:14px;font-weight:500;"]),ll=B.div.withConfig({displayName:"Footer__",componentId:"sc-15ektlo-2"})(["display:flex;flex-direction:row;justify-content:center;align-items:center;gap:5px;"]),cl=(t,e=150,n=150)=>new Promise(i=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const s=document.createElement("canvas"),r=s.getContext("2d");if(!r){i(t.src);return}const l=Math.min(e/o.naturalWidth,n/o.naturalHeight),d=o.naturalWidth*l,u=o.naturalHeight*l;s.width=d,s.height=u,r.drawImage(o,0,0,d,u);try{i(s.toDataURL("image/png",.7))}catch{i(t.src)}},o.onerror=()=>{i(t.src)},o.src=t.src}),ul=B(Yt).withConfig({displayName:"Footer__L",componentId:"sc-15ektlo-3"})(["width:60px;height:60px;margin:0;border:",";transform:",";box-shadow:",";opacity:",";transition:transform 0.15s ease,box-shadow 0.15s ease,opacity 0.2s ease;img{width:100%;height:100%;object-fit:cover;}"],t=>t.$isActive?"2px solid #007acc":"1px solid #ccc",t=>t.$isActive?"scale(1.02)":"scale(1)",t=>t.$isActive?"0 6px 12px rgba(0,0,0,0.25)":"0 2px 4px rgba(0,0,0,0.1)",t=>t.$opacity),dl=()=>{const{images:t,activeImageIndex:e,setActiveImageIndex:n}=kt(),[i,o]=O([]),[s,r]=O([]);return q(()=>{(async()=>{const l=await Promise.all(t.map(async d=>d instanceof HTMLImageElement?await cl(d):""));o(l)})()},[t]),q(()=>{const l=Math.floor(5.5);let d=Math.max(0,e-l),u=Math.min(i.length,d+11);u-d<11&&(d=Math.max(0,u-11));const p=i.slice(d,u);r(p)},[i,e]),a(rl,{children:[a(al,{children:[e+1," / ",t.length]}),a(ll,{children:[s.map((l,d)=>{const u=Math.floor(5.5);let p=Math.max(0,e-u),c=Math.min(i.length,p+11);c-p<11&&(p=Math.max(0,c-11));const v=p+d,m=v===e,x=Math.abs(d-5),C=m?1:Math.max(.3,1-x*.15);return a(ul,{$isActive:m,$opacity:C,onClick:()=>n(v),children:a("img",{src:l,alt:`Thumbnail ${v}`})},v)})," "]})]})},hl=B.div.withConfig({displayName:"Headerstyled__SHeader",componentId:"sc-17cmp36-0"})(["display:flex;flex-direction:row;justify-content:flex-end;align-items:flex-end;"]);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pl=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),gl=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,i)=>i?i.toUpperCase():n.toLowerCase()),Ki=t=>{const e=gl(t);return e.charAt(0).toUpperCase()+e.slice(1)},_s=(...t)=>t.filter((e,n,i)=>!!e&&e.trim()!==""&&i.indexOf(e)===n).join(" ").trim(),ml=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var fl={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const vl=$t(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:o="",children:s,iconNode:r,...l},d)=>ue("svg",{ref:d,...fl,width:e,height:e,stroke:t,strokeWidth:i?Number(n)*24/Number(e):n,className:_s("lucide",o),...!s&&!ml(l)&&{"aria-hidden":"true"},...l},[...r.map(([u,p])=>ue(u,p)),...Array.isArray(s)?s:[s]])),Ee=(t,e)=>{const n=$t(({className:i,...o},s)=>ue(vl,{ref:s,iconNode:e,className:_s(`lucide-${pl(Ki(t))}`,`lucide-${t}`,i),...o}));return n.displayName=Ki(t),n},yl=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],bl=Ee("arrow-left",yl),wl=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],_l=Ee("arrow-right",wl),xl=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Cl=Ee("chevron-down",xl),Sl=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],$l=Ee("chevron-right",Sl),kl=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],El=Ee("maximize",kl),Nl=[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]],Pl=Ee("menu",Nl),Il=[["path",{d:"M5 12h14",key:"1ays0h"}]],Ml=Ee("minus",Il),Ll=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],xs=Ee("rotate-ccw",Ll),Dl=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Al=Ee("rotate-cw",Dl),Tl=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ol=Ee("x",Tl),zl=({setMode:t})=>{const{onClose:e}=kt(),n=le(()=>{t("minimized")},[]);return a(hl,{children:[a(Yt,{onClick:n,"data-tooltip":"Minimize",children:a(Ml,{})}),a(Yt,{onClick:e,"data-tooltip":"Close",children:a(Ol,{})})]})},Rl=({initialPosition:t,onDragEnd:e})=>{const[n,i]=O({x:0,y:0}),[o,s]=O(!1),[r,l]=O(t),[d,u]=O(!1),p=le(m=>{s(!0),u(!1);const x=m.currentTarget.getBoundingClientRect();i({x:m.clientX-x.left,y:m.clientY-x.top})},[]),c=le(m=>{o&&(u(!0),l({x:window.innerWidth-(m.clientX-n.x)-50,y:window.innerHeight-(m.clientY-n.y)-50}))},[o,n]),v=le(()=>{s(!1),e?.(d)},[d,e]);return{position:r,isDragging:o,dragHandlers:{onMouseDown:p,onMouseMove:c,onMouseUp:v}}},Fl=B(Yt).withConfig({displayName:"MinimizedModestyled__MinimizedButton",componentId:"sc-cmlnj7-0"})(["position:fixed;bottom:","px;right:","px;border-radius:50%;width:50px;height:50px;z-index:9999;display:flex;align-items:center;justify-content:center;padding:0;margin:0;user-select:none;"],t=>t.$y,t=>t.$x),Ul=B.div.withConfig({displayName:"MinimizedModestyled__Badge",componentId:"sc-cmlnj7-1"})(["position:absolute;top:-5px;right:-5px;background:red;color:white;border-radius:50%;width:20px;height:20px;font-size:12px;display:flex;align-items:center;justify-content:center;"]),jl=({setMode:t})=>{const{images:e}=kt(),[n,i]=O(e.length);q(()=>{i(e.length)},[e]);const{position:o,isDragging:s,dragHandlers:r}=Rl({initialPosition:{x:20,y:80},onDragEnd:l=>{l||t("maximized")}});return q(()=>{if(s)return document.addEventListener("mousemove",r.onMouseMove),document.addEventListener("mouseup",r.onMouseUp),()=>{document.removeEventListener("mousemove",r.onMouseMove),document.removeEventListener("mouseup",r.onMouseUp)}},[s,r.onMouseMove,r.onMouseUp]),a(Fl,{"data-tooltip":`Show popup (${n} images)`,$x:o.x,$y:o.y,onMouseDown:r.onMouseDown,children:[a(El,{}),n>0&&a(Ul,{children:n})]})},Bl=B.div.withConfig({displayName:"Popup__E",componentId:"sc-1m5dz9n-0"})(["position:relative;width:100%;height:100%;display:flex;flex-direction:column;"]),Hl=()=>{const{popupMode:t,onClose:e,setActiveImageIndex:n,setImages:i,images:o}=kt(),[s,r]=O("maximized");q(()=>{const d=u=>{const p=o.length;i(c=>[...c,u]),n(p),r("maximized")};return t.plugin.emitter.on("image.popup.show",d),()=>{t.plugin.emitter.off("image.popup.show",d)}},[]),q(()=>{const d=u=>{u.key==="Escape"&&e()};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[e]);const l=le(d=>{d.target===d.currentTarget&&e()},[e]);return s==="maximized"?a(tl,{onClick:l,children:a(Bl,{children:[a(zl,{setMode:r}),a(sl,{}),a(dl,{})]})}):a(jl,{setMode:r})},Vl=({popupMode:t,initialImages:e,onClose:n})=>a(Qr,{popupMode:t,initialImages:e,onClose:n,children:a(Hl,{})});let Gl=class extends R.Component{constructor(e){super(),this.plugin=e}popupDiv=null;popupRoot=null;initialize(){this.load(),this.plugin.app.workspace.on("layout-change",()=>{const e=this.plugin.app.workspace.getActiveViewOfType(R.MarkdownView);e&&this.addPopupButton(e)})}addPopupButton(e){if(e.actionsEl.querySelector(".izd-popup-button"))return;const n=e.addAction("layout-grid","Open view image gallery in popup window",this.showPopupForViewImages.bind(this));n.addClass("izd-popup-button"),this.register(()=>{n.remove()})}async getAllImagesForPopup(e){const n=new R.Component;n.load();const i=document.createElement("div");i.style.visibility="hidden",document.body.appendChild(i);const o=await this.plugin.app.vault.cachedRead(e.file);await R.MarkdownRenderer.render(this.plugin.app,o,i,e.file.path,n),await new Promise(r=>requestAnimationFrame(r));const s=Array.from(i.querySelectorAll("img")).filter(r=>!Ut(r));return i.remove(),n.unload(),s}async showPopupForViewImages(){const e=this.plugin.app.workspace.getActiveViewOfType(R.MarkdownView),n=await this.getAllImagesForPopup(e);if(n.length===0){this.plugin.showNotice("No images found in the current view.");return}await this.showPopup(n)}async showPopupForImage(e){await this.showPopup(e)}async showPopup(e){const n=Array.isArray(e)?e:[e];this.popupDiv??=document.body.createDiv(),this.popupRoot?this.plugin.emitter.emit("image.popup.show",e):(this.popupRoot=Jt(this.popupDiv),this.popupRoot.render(a(Vl,{popupMode:this,initialImages:n,onClose:()=>this.closePopup()})))}closePopup(){this.popupRoot?.unmount(),this.popupRoot=null,this.popupDiv?.remove(),this.popupDiv=null}onunload(){super.onunload(),this.closePopup()}};function Wl(){return{units:{contextMenu:{showForDiagrams:!0,showForOtherImages:!1},interactivity:{markdown:{autoDetect:!0},picker:{enabled:!1}},folding:{foldByDefault:!1,autoFoldOnFocusChange:!1},settingsPagination:{perPage:5},size:{expanded:{width:{value:100,type:"%"},height:{value:100,type:"%"}},folded:{width:{value:50,type:"%"},height:{value:50,type:"%"}}},configs:Object.entries(Me).map(([t,e])=>({name:t,selector:e,on:e!==Me.IMG_SVG,panels:{move:{on:!0},zoom:{on:!0},service:{on:!0}}}))},panels:{global:{triggering:{mode:Ke.ALWAYS,ignoreService:!0}},local:{preset:"none",panels:{service:{on:!1,buttons:{hide:!0,fullscreen:!0},position:{top:"0px",right:"0px"}},move:{on:!1,buttons:{up:!0,down:!0,left:!0,right:!0,upLeft:!0,upRight:!0,downLeft:!0,downRight:!0},position:{bottom:"0px",right:"0px"}},zoom:{on:!1,buttons:{in:!0,out:!0,reset:!0},position:{top:"50%",right:"0px"}}}}},debug:{enabled:!1,level:co.None}}}function Cs(t,e){if(!e||typeof e!="object")return t;const n={...t};for(const i in e)e[i]&&typeof e[i]=="object"&&!Array.isArray(e[i])?n[i]=Cs(n[i]??{},e[i]):e[i]!==void 0&&(n[i]=e[i]);return n}var vn={exports:{}},qi;function Yl(){return qi||(qi=1,function(t,e){(function(n){var i=Object.hasOwnProperty,o=Array.isArray?Array.isArray:function(h){return Object.prototype.toString.call(h)==="[object Array]"},s=10,r=typeof process=="object"&&typeof process.nextTick=="function",l=typeof Symbol=="function",d=typeof Reflect=="object",u=typeof setImmediate=="function",p=u?setImmediate:setTimeout,c=l?d&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(h){var g=Object.getOwnPropertyNames(h);return g.push.apply(g,Object.getOwnPropertySymbols(h)),g}:Object.keys;function v(){this._events={},this._conf&&m.call(this,this._conf)}function m(h){h&&(this._conf=h,h.delimiter&&(this.delimiter=h.delimiter),h.maxListeners!==n&&(this._maxListeners=h.maxListeners),h.wildcard&&(this.wildcard=h.wildcard),h.newListener&&(this._newListener=h.newListener),h.removeListener&&(this._removeListener=h.removeListener),h.verboseMemoryLeak&&(this.verboseMemoryLeak=h.verboseMemoryLeak),h.ignoreErrors&&(this.ignoreErrors=h.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function x(h,g){var y="(node) warning: possible EventEmitter memory leak detected. "+h+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(y+=" Event name: "+g+"."),typeof process<"u"&&process.emitWarning){var b=new Error(y);b.name="MaxListenersExceededWarning",b.emitter=this,b.count=h,process.emitWarning(b)}else console.error(y),console.trace&&console.trace()}var C=function(h,g,y){var b=arguments.length;switch(b){case 0:return[];case 1:return[h];case 2:return[h,g];case 3:return[h,g,y];default:for(var w=new Array(b);b--;)w[b]=arguments[b];return w}};function E(h,g){for(var y={},b,w=h.length,_=0,S=0;S<w;S++)b=h[S],y[b]=S<_?g[S]:n;return y}function N(h,g,y){this._emitter=h,this._target=g,this._listeners={},this._listenersCount=0;var b,w;if((y.on||y.off)&&(b=y.on,w=y.off),g.addEventListener?(b=g.addEventListener,w=g.removeEventListener):g.addListener?(b=g.addListener,w=g.removeListener):g.on&&(b=g.on,w=g.off),!b&&!w)throw Error("target does not implement any known event API");if(typeof b!="function")throw TypeError("on method must be a function");if(typeof w!="function")throw TypeError("off method must be a function");this._on=b,this._off=w;var _=h._observers;_?_.push(this):h._observers=[this]}Object.assign(N.prototype,{subscribe:function(h,g,y){var b=this,w=this._target,_=this._emitter,S=this._listeners,P=function(){var $=C.apply(null,arguments),k={data:$,name:g,original:h};if(y){var F=y.call(w,k);F!==!1&&_.emit.apply(_,[k.name].concat($));return}_.emit.apply(_,[g].concat($))};if(S[h])throw Error("Event '"+h+"' is already listening");this._listenersCount++,_._newListener&&_._removeListener&&!b._onNewListener?(this._onNewListener=function($){$===g&&S[h]===null&&(S[h]=P,b._on.call(w,h,P))},_.on("newListener",this._onNewListener),this._onRemoveListener=function($){$===g&&!_.hasListeners($)&&S[h]&&(S[h]=null,b._off.call(w,h,P))},S[h]=null,_.on("removeListener",this._onRemoveListener)):(S[h]=P,b._on.call(w,h,P))},unsubscribe:function(h){var g=this,y=this._listeners,b=this._emitter,w,_,S=this._off,P=this._target,$;if(h&&typeof h!="string")throw TypeError("event must be a string");function k(){g._onNewListener&&(b.off("newListener",g._onNewListener),b.off("removeListener",g._onRemoveListener),g._onNewListener=null,g._onRemoveListener=null);var F=G.call(b,g);b._observers.splice(F,1)}if(h){if(w=y[h],!w)return;S.call(P,h,w),delete y[h],--this._listenersCount||k()}else{for(_=c(y),$=_.length;$-- >0;)h=_[$],S.call(P,h,y[h]);this._listeners={},this._listenersCount=0,k()}}});function I(h,g,y,b){var w=Object.assign({},g);if(!h)return w;if(typeof h!="object")throw TypeError("options must be an object");var _=Object.keys(h),S=_.length,P,$,k;function F(K){throw Error('Invalid "'+P+'" option value'+(K?". Reason: "+K:""))}for(var ee=0;ee<S;ee++){if(P=_[ee],!i.call(g,P))throw Error('Unknown "'+P+'" option');$=h[P],$!==n&&(k=y[P],w[P]=k?k($,F):$)}return w}function L(h,g){return(typeof h!="function"||!h.hasOwnProperty("prototype"))&&g("value must be a constructor"),h}function D(h){var g="value must be type of "+h.join("|"),y=h.length,b=h[0],w=h[1];return y===1?function(_,S){if(typeof _===b)return _;S(g)}:y===2?function(_,S){var P=typeof _;if(P===b||P===w)return _;S(g)}:function(_,S){for(var P=typeof _,$=y;$-- >0;)if(P===h[$])return _;S(g)}}var M=D(["function"]),A=D(["object","function"]);function T(h,g,y){var b,w,_=0,S,P=new h(function($,k,F){y=I(y,{timeout:0,overload:!1},{timeout:function(X,me){return X*=1,(typeof X!="number"||X<0||!Number.isFinite(X))&&me("timeout must be a positive number"),X}}),b=!y.overload&&typeof h.prototype.cancel=="function"&&typeof F=="function";function ee(){w&&(w=null),_&&(clearTimeout(_),_=0)}var K=function(X){ee(),$(X)},Y=function(X){ee(),k(X)};b?g(K,Y,F):(w=[function(X){Y(X||Error("canceled"))}],g(K,Y,function(X){if(S)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof X!="function")throw TypeError("onCancel callback must be a function");w.push(X)}),S=!0),y.timeout>0&&(_=setTimeout(function(){var X=Error("timeout");X.code="ETIMEDOUT",_=0,P.cancel(X),k(X)},y.timeout))});return b||(P.cancel=function($){if(w){for(var k=w.length,F=1;F<k;F++)w[F]($);w[0]($),w=null}}),P}function G(h){var g=this._observers;if(!g)return-1;for(var y=g.length,b=0;b<y;b++)if(g[b]._target===h)return b;return-1}function U(h,g,y,b,w){if(!y)return null;if(b===0){var _=typeof g;if(_==="string"){var S,P,$=0,k=0,F=this.delimiter,ee=F.length;if((P=g.indexOf(F))!==-1){S=new Array(5);do S[$++]=g.slice(k,P),k=P+ee;while((P=g.indexOf(F,k))!==-1);S[$++]=g.slice(k),g=S,w=$}else g=[g],w=1}else _==="object"?w=g.length:(g=[g],w=1)}var K=null,Y,X,me,ln,cn,ht=g[b],un=g[b+1],Ne,fe;if(b===w)y._listeners&&(typeof y._listeners=="function"?(h&&h.push(y._listeners),K=[y]):(h&&h.push.apply(h,y._listeners),K=[y]));else if(ht==="*"){for(Ne=c(y),P=Ne.length;P-- >0;)Y=Ne[P],Y!=="_listeners"&&(fe=U(h,g,y[Y],b+1,w),fe&&(K?K.push.apply(K,fe):K=fe));return K}else if(ht==="**"){for(cn=b+1===w||b+2===w&&un==="*",cn&&y._listeners&&(K=U(h,g,y,w,w)),Ne=c(y),P=Ne.length;P-- >0;)Y=Ne[P],Y!=="_listeners"&&(Y==="*"||Y==="**"?(y[Y]._listeners&&!cn&&(fe=U(h,g,y[Y],w,w),fe&&(K?K.push.apply(K,fe):K=fe)),fe=U(h,g,y[Y],b,w)):Y===un?fe=U(h,g,y[Y],b+2,w):fe=U(h,g,y[Y],b,w),fe&&(K?K.push.apply(K,fe):K=fe));return K}else y[ht]&&(K=U(h,g,y[ht],b+1,w));if(X=y["*"],X&&U(h,g,X,b+1,w),me=y["**"],me)if(b<w)for(me._listeners&&U(h,g,me,w,w),Ne=c(me),P=Ne.length;P-- >0;)Y=Ne[P],Y!=="_listeners"&&(Y===un?U(h,g,me[Y],b+2,w):Y===ht?U(h,g,me[Y],b+1,w):(ln={},ln[Y]=me[Y],U(h,g,{"**":ln},b+1,w)));else me._listeners?U(h,g,me,w,w):me["*"]&&me["*"]._listeners&&U(h,g,me["*"],w,w);return K}function de(h,g,y){var b=0,w=0,_,S=this.delimiter,P=S.length,$;if(typeof h=="string")if((_=h.indexOf(S))!==-1){$=new Array(5);do $[b++]=h.slice(w,_),w=_+P;while((_=h.indexOf(S,w))!==-1);$[b++]=h.slice(w)}else $=[h],b=1;else $=h,b=h.length;if(b>1){for(_=0;_+1<b;_++)if($[_]==="**"&&$[_+1]==="**")return}var k=this.listenerTree,F;for(_=0;_<b;_++)if(F=$[_],k=k[F]||(k[F]={}),_===b-1)return k._listeners?(typeof k._listeners=="function"&&(k._listeners=[k._listeners]),y?k._listeners.unshift(g):k._listeners.push(g),!k._listeners.warned&&this._maxListeners>0&&k._listeners.length>this._maxListeners&&(k._listeners.warned=!0,x.call(this,k._listeners.length,F))):k._listeners=g,!0;return!0}function re(h,g,y,b){for(var w=c(h),_=w.length,S,P,$,k=h._listeners,F;_-- >0;)P=w[_],S=h[P],P==="_listeners"?$=y:$=y?y.concat(P):[P],F=b||typeof P=="symbol",k&&g.push(F?$:$.join(this.delimiter)),typeof S=="object"&&re.call(this,S,g,$,F);return g}function ge(h){for(var g=c(h),y=g.length,b,w,_;y-- >0;)w=g[y],b=h[w],b&&(_=!0,w!=="_listeners"&&!ge(b)&&delete h[w]);return _}function Ae(h,g,y){this.emitter=h,this.event=g,this.listener=y}Ae.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function Te(h,g,y){if(y===!0)w=!0;else if(y===!1)b=!0;else{if(!y||typeof y!="object")throw TypeError("options should be an object or true");var b=y.async,w=y.promisify,_=y.nextTick,S=y.objectify}if(b||_||w){var P=g,$=g._origin||g;if(_&&!r)throw Error("process.nextTick is not supported");w===n&&(w=g.constructor.name==="AsyncFunction"),g=function(){var k=arguments,F=this,ee=this.event;return w?_?Promise.resolve():new Promise(function(K){p(K)}).then(function(){return F.event=ee,P.apply(F,k)}):(_?process.nextTick:p)(function(){F.event=ee,P.apply(F,k)})},g._async=!0,g._origin=$}return[g,S?new Ae(this,h,g):this]}function j(h){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,m.call(this,h)}j.EventEmitter2=j,j.prototype.listenTo=function(h,g,y){if(typeof h!="object")throw TypeError("target musts be an object");var b=this;y=I(y,{on:n,off:n,reducers:n},{on:M,off:M,reducers:A});function w(_){if(typeof _!="object")throw TypeError("events must be an object");var S=y.reducers,P=G.call(b,h),$;P===-1?$=new N(b,h,y):$=b._observers[P];for(var k=c(_),F=k.length,ee,K=typeof S=="function",Y=0;Y<F;Y++)ee=k[Y],$.subscribe(ee,_[ee]||ee,K?S:S&&S[ee])}return o(g)?w(E(g)):w(typeof g=="string"?E(g.split(/\s+/)):g),this},j.prototype.stopListeningTo=function(h,g){var y=this._observers;if(!y)return!1;var b=y.length,w,_=!1;if(h&&typeof h!="object")throw TypeError("target should be an object");for(;b-- >0;)w=y[b],(!h||w._target===h)&&(w.unsubscribe(g),_=!0);return _},j.prototype.delimiter=".",j.prototype.setMaxListeners=function(h){h!==n&&(this._maxListeners=h,this._conf||(this._conf={}),this._conf.maxListeners=h)},j.prototype.getMaxListeners=function(){return this._maxListeners},j.prototype.event="",j.prototype.once=function(h,g,y){return this._once(h,g,!1,y)},j.prototype.prependOnceListener=function(h,g,y){return this._once(h,g,!0,y)},j.prototype._once=function(h,g,y,b){return this._many(h,1,g,y,b)},j.prototype.many=function(h,g,y,b){return this._many(h,g,y,!1,b)},j.prototype.prependMany=function(h,g,y,b){return this._many(h,g,y,!0,b)},j.prototype._many=function(h,g,y,b,w){var _=this;if(typeof y!="function")throw new Error("many only accepts instances of Function");function S(){return--g===0&&_.off(h,S),y.apply(this,arguments)}return S._origin=y,this._on(h,S,b,w)},j.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||v.call(this);var h=arguments[0],g,y=this.wildcard,b,w,_,S,P;if(h==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if(y&&(g=h,h!=="newListener"&&h!=="removeListener"&&typeof h=="object")){if(w=h.length,l){for(_=0;_<w;_++)if(typeof h[_]=="symbol"){P=!0;break}}P||(h=h.join(this.delimiter))}var $=arguments.length,k;if(this._all&&this._all.length)for(k=this._all.slice(),_=0,w=k.length;_<w;_++)switch(this.event=h,$){case 1:k[_].call(this,h);break;case 2:k[_].call(this,h,arguments[1]);break;case 3:k[_].call(this,h,arguments[1],arguments[2]);break;default:k[_].apply(this,arguments)}if(y)k=[],U.call(this,k,g,this.listenerTree,0,w);else if(k=this._events[h],typeof k=="function"){switch(this.event=h,$){case 1:k.call(this);break;case 2:k.call(this,arguments[1]);break;case 3:k.call(this,arguments[1],arguments[2]);break;default:for(b=new Array($-1),S=1;S<$;S++)b[S-1]=arguments[S];k.apply(this,b)}return!0}else k&&(k=k.slice());if(k&&k.length){if($>3)for(b=new Array($-1),S=1;S<$;S++)b[S-1]=arguments[S];for(_=0,w=k.length;_<w;_++)switch(this.event=h,$){case 1:k[_].call(this);break;case 2:k[_].call(this,arguments[1]);break;case 3:k[_].call(this,arguments[1],arguments[2]);break;default:k[_].apply(this,b)}return!0}else if(!this.ignoreErrors&&!this._all&&h==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},j.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||v.call(this);var h=arguments[0],g=this.wildcard,y,b,w,_,S,P;if(h==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(g&&(y=h,h!=="newListener"&&h!=="removeListener"&&typeof h=="object")){if(_=h.length,l){for(S=0;S<_;S++)if(typeof h[S]=="symbol"){b=!0;break}}b||(h=h.join(this.delimiter))}var $=[],k=arguments.length,F;if(this._all)for(S=0,_=this._all.length;S<_;S++)switch(this.event=h,k){case 1:$.push(this._all[S].call(this,h));break;case 2:$.push(this._all[S].call(this,h,arguments[1]));break;case 3:$.push(this._all[S].call(this,h,arguments[1],arguments[2]));break;default:$.push(this._all[S].apply(this,arguments))}if(g?(F=[],U.call(this,F,y,this.listenerTree,0)):F=this._events[h],typeof F=="function")switch(this.event=h,k){case 1:$.push(F.call(this));break;case 2:$.push(F.call(this,arguments[1]));break;case 3:$.push(F.call(this,arguments[1],arguments[2]));break;default:for(w=new Array(k-1),P=1;P<k;P++)w[P-1]=arguments[P];$.push(F.apply(this,w))}else if(F&&F.length){if(F=F.slice(),k>3)for(w=new Array(k-1),P=1;P<k;P++)w[P-1]=arguments[P];for(S=0,_=F.length;S<_;S++)switch(this.event=h,k){case 1:$.push(F[S].call(this));break;case 2:$.push(F[S].call(this,arguments[1]));break;case 3:$.push(F[S].call(this,arguments[1],arguments[2]));break;default:$.push(F[S].apply(this,w))}}else if(!this.ignoreErrors&&!this._all&&h==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all($)},j.prototype.on=function(h,g,y){return this._on(h,g,!1,y)},j.prototype.prependListener=function(h,g,y){return this._on(h,g,!0,y)},j.prototype.onAny=function(h){return this._onAny(h,!1)},j.prototype.prependAny=function(h){return this._onAny(h,!0)},j.prototype.addListener=j.prototype.on,j.prototype._onAny=function(h,g){if(typeof h!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),g?this._all.unshift(h):this._all.push(h),this},j.prototype._on=function(h,g,y,b){if(typeof h=="function")return this._onAny(h,g),this;if(typeof g!="function")throw new Error("on only accepts instances of Function");this._events||v.call(this);var w=this,_;return b!==n&&(_=Te.call(this,h,g,b),g=_[0],w=_[1]),this._newListener&&this.emit("newListener",h,g),this.wildcard?(de.call(this,h,g,y),w):(this._events[h]?(typeof this._events[h]=="function"&&(this._events[h]=[this._events[h]]),y?this._events[h].unshift(g):this._events[h].push(g),!this._events[h].warned&&this._maxListeners>0&&this._events[h].length>this._maxListeners&&(this._events[h].warned=!0,x.call(this,this._events[h].length,h))):this._events[h]=g,w)},j.prototype.off=function(h,g){if(typeof g!="function")throw new Error("removeListener only takes instances of Function");var y,b=[];if(this.wildcard){var w=typeof h=="string"?h.split(this.delimiter):h.slice();if(b=U.call(this,null,w,this.listenerTree,0),!b)return this}else{if(!this._events[h])return this;y=this._events[h],b.push({_listeners:y})}for(var _=0;_<b.length;_++){var S=b[_];if(y=S._listeners,o(y)){for(var P=-1,$=0,k=y.length;$<k;$++)if(y[$]===g||y[$].listener&&y[$].listener===g||y[$]._origin&&y[$]._origin===g){P=$;break}if(P<0)continue;return this.wildcard?S._listeners.splice(P,1):this._events[h].splice(P,1),y.length===0&&(this.wildcard?delete S._listeners:delete this._events[h]),this._removeListener&&this.emit("removeListener",h,g),this}else(y===g||y.listener&&y.listener===g||y._origin&&y._origin===g)&&(this.wildcard?delete S._listeners:delete this._events[h],this._removeListener&&this.emit("removeListener",h,g))}return this.listenerTree&&ge(this.listenerTree),this},j.prototype.offAny=function(h){var g=0,y=0,b;if(h&&this._all&&this._all.length>0){for(b=this._all,g=0,y=b.length;g<y;g++)if(h===b[g])return b.splice(g,1),this._removeListener&&this.emit("removeListenerAny",h),this}else{if(b=this._all,this._removeListener)for(g=0,y=b.length;g<y;g++)this.emit("removeListenerAny",b[g]);this._all=[]}return this},j.prototype.removeListener=j.prototype.off,j.prototype.removeAllListeners=function(h){if(h===n)return!this._events||v.call(this),this;if(this.wildcard){var g=U.call(this,null,h,this.listenerTree,0),y,b;if(!g)return this;for(b=0;b<g.length;b++)y=g[b],y._listeners=null;this.listenerTree&&ge(this.listenerTree)}else this._events&&(this._events[h]=null);return this},j.prototype.listeners=function(h){var g=this._events,y,b,w,_,S;if(h===n){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!g)return[];for(y=c(g),_=y.length,w=[];_-- >0;)b=g[y[_]],typeof b=="function"?w.push(b):w.push.apply(w,b);return w}else{if(this.wildcard){if(S=this.listenerTree,!S)return[];var P=[],$=typeof h=="string"?h.split(this.delimiter):h.slice();return U.call(this,P,$,S,0),P}return g?(b=g[h],b?typeof b=="function"?[b]:b:[]):[]}},j.prototype.eventNames=function(h){var g=this._events;return this.wildcard?re.call(this,this.listenerTree,[],null,h):g?c(g):[]},j.prototype.listenerCount=function(h){return this.listeners(h).length},j.prototype.hasListeners=function(h){if(this.wildcard){var g=[],y=typeof h=="string"?h.split(this.delimiter):h.slice();return U.call(this,g,y,this.listenerTree,0),g.length>0}var b=this._events,w=this._all;return!!(w&&w.length||b&&(h===n?c(b).length:b[h]))},j.prototype.listenersAny=function(){return this._all?this._all:[]},j.prototype.waitFor=function(h,g){var y=this,b=typeof g;return b==="number"?g={timeout:g}:b==="function"&&(g={filter:g}),g=I(g,{timeout:0,filter:n,handleError:!1,Promise,overload:!1},{filter:M,Promise:L}),T(g.Promise,function(w,_,S){function P(){var $=g.filter;if(!($&&!$.apply(y,arguments)))if(y.off(h,P),g.handleError){var k=arguments[0];k?_(k):w(C.apply(null,arguments).slice(1))}else w(C.apply(null,arguments))}S(function(){y.off(h,P)}),y._on(h,P,!1)},{timeout:g.timeout,overload:g.overload})};function Oe(h,g,y){y=I(y,{Promise,timeout:0,overload:!1},{Promise:L});var b=y.Promise;return T(b,function(w,_,S){var P;if(typeof h.addEventListener=="function"){P=function(){w(C.apply(null,arguments))},S(function(){h.removeEventListener(g,P)}),h.addEventListener(g,P,{once:!0});return}var $=function(){k&&h.removeListener("error",k),w(C.apply(null,arguments))},k;g!=="error"&&(k=function(F){h.removeListener(g,$),_(F)},h.once("error",k)),S(function(){k&&h.removeListener("error",k),h.removeListener(g,$)}),h.once(g,$)},{timeout:y.timeout,overload:y.overload})}var ye=j.prototype;Object.defineProperties(j,{defaultMaxListeners:{get:function(){return ye._maxListeners},set:function(h){if(typeof h!="number"||h<0||Number.isNaN(h))throw TypeError("n must be a non-negative number");ye._maxListeners=h},enumerable:!0},once:{value:Oe,writable:!0,configurable:!0}}),Object.defineProperties(ye,{_maxListeners:{value:s,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),typeof n=="function"||(t.exports=j)})()}(vn)),vn.exports}var Kl=Yl(),Ss=ea(Kl);function $s(t,e=[]){return new Proxy(t,{get(n,i){if(i==="$path")return`settings.${e.join(".")}`;const o=e.length>0?`settings.${e.join(".")}`:"settings";if(i==="$all"||i==="$deep")return`${o}.**`;if(i==="$children")return`${o}.*`;const s=n[i];if(typeof s!="object"||s===null){const r=`settings.${[...e,i].join(".")}`;return{$path:r,$all:`${r}.**`,$deep:`${r}.**`,$children:`${r}.*`,toString:()=>r,valueOf:()=>r}}return $s(s,[...e,i])}})}function ks(t,e,n=[]){return new Proxy(e,{get(i,o){if(o==="toJSON")return()=>i;const s=i[o];return typeof s=="object"&&s!==null?ks(t,s,[...n,o]):s},set(i,o,s){const r=i[o];i[o]=s;const l=[...n,o].join(".");return t.emitter?.emit(`settings.${l}`,{eventName:`settings.${l}`,oldValue:r,newValue:s}),!0},deleteProperty(i,o){const s=i[o],r=o in i;if(delete i[o],r){const l=[...n,o].join(".");t.emitter?.emit(`settings.${l}`,{eventName:`settings.${l}`,operation:"delete",oldValue:s,newValue:void 0})}return!0}})}let ql=class extends R.Component{constructor(e){super(),this.plugin=e,this.emitter=new Ss({wildcard:!0,delimiter:"."}),this.setupEvents()}dirty=!1;get $(){return this.data}async load(){const e=await this.plugin.loadData()??{},n=Cs(Wl(),e);this.data=ks(this,{...n},[]),this.$$=$s(n)}async save(){return this.saveTimeout&&clearTimeout(this.saveTimeout),this.savePromise??=new Promise(e=>{this.saveResolve=e}),this.saveTimeout=setTimeout(async()=>{try{await this.plugin.saveData(this.$),this.dirty=!1}catch(e){this.plugin.logger.error(`Settings save failed: ${e.message}`,{functionName:"anonymous",lineNumber:62,columnNumber:1994,fileName:"src\\settings\\settings.ts"})}finally{this.savePromise=void 0,this.saveResolve?.(),this.saveResolve=void 0,this.saveTimeout=void 0}},50),this.savePromise}async reset(){const e=this.plugin.manifest.dir;if(!e)throw new Error("Image Zoom & Drag: `No plugin dir found`");const n=R.normalizePath(`${e}/data.json`);await this.plugin.app.vault.adapter.exists(n)&&await this.plugin.app.vault.adapter.remove(n),await this.load()}setupEvents(){this.emitter.on("**",()=>this.dirty=!0)}async onunload(){super.onunload(),this.emitter.removeAllListeners(),this.saveTimeout&&(clearTimeout(this.saveTimeout),this.saveTimeout=void 0),this.dirty&&this.savePromise?await this.savePromise:this.dirty&&(await this.plugin.saveData(this.$),this.dirty=!1),this.savePromise=void 0}};const Es=Fe(void 0),Zl=({app:t,plugin:e,children:n})=>{const[i,o]=O(0),[s,r]=O("/images"),l=le(()=>{o(u=>u+1)},[]),d=ce(()=>({app:t,plugin:e,forceReload:l,reloadCount:i,currentPath:s,setCurrentPath:r}),[t,e,l,i,s,r]);return a(Es.Provider,{value:d,children:n})},se=()=>{const t=ke(Es);if(t===void 0)throw new Error("useSettingsContext must be used within a SettingProvider");return t};function Xl(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var n,i,o,s,r=[],l="",d=t.split("/");for(d[0]||d.shift();o=d.shift();)n=o[0],n==="*"?(r.push(n),l+=o[1]==="?"?"(?:/(.*))?":"/(.*)"):n===":"?(i=o.indexOf("?",1),s=o.indexOf(".",1),r.push(o.substring(1,~i?i:~s?s:o.length)),l+=~i&&!~s?"(?:/([^/]+?))?":"/([^/]+?)",~s&&(l+=(~i?"?":"")+"\\"+o.substring(s))):l+="/"+o;return{keys:r,pattern:new RegExp("^"+l+(e?"(?=$|/)":"/?$"),"i")}}var yn={exports:{}},bn={},Jl=ta(Ir),Zi;function Ql(){if(Zi)return bn;Zi=1;var t=Jl;function e(c,v){return c===v&&(c!==0||1/c===1/v)||c!==c&&v!==v}var n=typeof Object.is=="function"?Object.is:e,i=t.useState,o=t.useEffect,s=t.useLayoutEffect,r=t.useDebugValue;function l(c,v){var m=v(),x=i({inst:{value:m,getSnapshot:v}}),C=x[0].inst,E=x[1];return s(function(){C.value=m,C.getSnapshot=v,d(C)&&E({inst:C})},[c,m,v]),o(function(){return d(C)&&E({inst:C}),c(function(){d(C)&&E({inst:C})})},[c]),r(m),m}function d(c){var v=c.getSnapshot;c=c.value;try{var m=v();return!n(c,m)}catch{return!0}}function u(c,v){return v()}var p=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:l;return bn.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:p,bn}var Xi;function ec(){return Xi||(Xi=1,yn.exports=Ql()),yn.exports}var Rn=ec();const tc=qt,nc=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ic=nc?$e:q,oc=tc||ic,Ns=t=>{const e=pe([t,(...n)=>e[0](...n)]).current;return oc(()=>{e[0]=t}),e[1]},sc="popstate",li="pushState",ci="replaceState",rc="hashchange",Ji=[sc,li,ci,rc],ac=t=>{for(const e of Ji)addEventListener(e,t);return()=>{for(const e of Ji)removeEventListener(e,t)}},Ps=(t,e)=>Rn.useSyncExternalStore(ac,t,e),lc=()=>location.search,cc=({ssrSearch:t=""}={})=>Ps(lc,()=>t),Qi=()=>location.pathname,uc=({ssrPath:t}={})=>Ps(Qi,t?()=>t:Qi),dc=(t,{replace:e=!1,state:n=null}={})=>history[e?ci:li](n,"",t),hc=(t={})=>[uc(t),dc],eo=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[eo]>"u"){for(const t of[li,ci]){const e=history[t];history[t]=function(){const n=e.apply(this,arguments),i=new Event(t);return i.arguments=arguments,dispatchEvent(i),n}}Object.defineProperty(window,eo,{value:!0})}const pc=(t,e)=>e.toLowerCase().indexOf(t.toLowerCase())?"~"+e:e.slice(t.length)||"/",Is=(t="")=>t==="/"?"":t,gc=(t,e)=>t[0]==="~"?t.slice(1):Is(e)+t,mc=(t="",e)=>pc(to(Is(t)),to(e)),to=t=>{try{return decodeURI(t)}catch{return t}},Ms={hook:hc,searchHook:cc,parser:Xl,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:t=>t},Ls=Fe(Ms),Nt=()=>ke(Ls),Ds={},As=Fe(Ds),fc=()=>ke(As),rn=t=>{const[e,n]=t.hook(t);return[mc(t.base,e),Ns((i,o)=>n(gc(i,t.base),o))]},an=()=>rn(Nt()),Ts=(t,e,n,i)=>{const{pattern:o,keys:s}=e instanceof RegExp?{keys:!1,pattern:e}:t(e||"*",i),r=o.exec(n)||[],[l,...d]=r;return l!==void 0?[!0,(()=>{const u=s!==!1?Object.fromEntries(s.map((c,v)=>[c,d[v]])):r.groups;let p={...d};return u&&Object.assign(p,u),p})(),...i?[l]:[]]:[!1,null]},Os=({children:t,...e})=>{const n=Nt(),i=e.hook?Ms:n;let o=i;const[s,r]=e.ssrPath?.split("?")??[];r&&(e.ssrSearch=r,e.ssrPath=s),e.hrefs=e.hrefs??e.hook?.hrefs;let l=pe({}),d=l.current,u=d;for(let p in i){const c=p==="base"?i[p]+(e[p]||""):e[p]||i[p];d===u&&c!==u[p]&&(l.current=u={...u}),u[p]=c,(c!==i[p]||c!==o[p])&&(o=u)}return ue(Ls.Provider,{value:o,children:t})},no=({children:t,component:e},n)=>e?ue(e,{params:n}):typeof t=="function"?t(n):t,vc=t=>{let e=pe(Ds);const n=e.current;return e.current=Object.keys(t).length!==Object.keys(n).length||Object.entries(t).some(([i,o])=>o!==n[i])?t:n},Ge=({path:t,nest:e,match:n,...i})=>{const o=Nt(),[s]=rn(o),[r,l,d]=n??Ts(o.parser,t,s,e),u=vc({...fc(),...l});if(!r)return null;const p=d?ue(Os,{base:d},no(i,u)):no(i,u);return ue(As.Provider,{value:u,children:p})};$t((t,e)=>{const n=Nt(),[i,o]=rn(n),{to:s="",href:r=s,onClick:l,asChild:d,children:u,className:p,replace:c,state:v,...m}=t,x=Ns(E=>{E.ctrlKey||E.metaKey||E.altKey||E.shiftKey||E.button!==0||(l?.(E),E.defaultPrevented||(E.preventDefault(),o(r,t)))}),C=n.hrefs(r[0]==="~"?r.slice(1):n.base+r,n);return d&&Ze(u)?Xt(u,{onClick:x,href:C}):ue("a",{...m,onClick:x,href:C,className:p?.call?p(i===r):p,children:u,ref:e})});const zs=t=>Array.isArray(t)?t.flatMap(e=>zs(e&&e.type===W?e.props.children:e)):[t],Rs=({children:t,location:e})=>{const n=Nt(),[i]=rn(n);for(const o of zs(t)){let s=0;if(Ze(o)&&(s=Ts(n.parser,o.props.path,e||i,o.props.nest))[0])return Xt(o,{match:s})}return null};function yc(t){return{all:t=t||new Map,on:function(e,n){var i=t.get(e);i?i.push(n):t.set(e,[n])},off:function(e,n){var i=t.get(e);i&&(n?i.splice(i.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var i=t.get(e);i&&i.slice().map(function(o){o(n)}),(i=t.get("*"))&&i.slice().map(function(o){o(e,n)})}}}const bc=({path:t="/",searchPath:e="",static:n,record:i}={})=>{let o=t;e&&(o+=t.split("?")[1]?"&":"?",o+=e);let[s,r=""]=o.split("?");const l=[o],d=yc(),u=(C,{replace:E=!1}={})=>{i&&(E?l.splice(l.length-1,1,C):l.push(C)),[s,r=""]=C.split("?"),d.emit("navigate",C)},p=n?()=>null:u,c=C=>(d.on("navigate",C),()=>d.off("navigate",C)),v=()=>[Rn.useSyncExternalStore(c,()=>s),p],m=()=>Rn.useSyncExternalStore(c,()=>r);function x(){l.splice(0,l.length),u(o)}return{hook:v,searchHook:m,navigate:p,history:i?l:void 0,reset:i?x:void 0}},wc=B.div.withConfig({displayName:"Aboutstyled__FooterContent",componentId:"sc-wll54m-0"})(["font-size:small;color:gray;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;margin-top:40px;padding:20px 0;"]),_c=B.div.withConfig({displayName:"Aboutstyled__Info",componentId:"sc-wll54m-1"})(["margin-bottom:12px;span{margin:0 4px;}"]),xc=B.div.withConfig({displayName:"Aboutstyled__Slogan",componentId:"sc-wll54m-2"})(["margin-bottom:12px;"]),Cc=()=>{const{plugin:t}=se();return a(W,{children:[a(z,{name:f("I"),children:a("button",{"aria-label":f("H"),onClick:()=>{window.open("https://github.com/Ssentiago/image-zoom-drag/","_blank")},"data-icon":"github"})}),a(z,{name:"Help",children:a("button",{"data-icon":"message-circle-question","aria-label":"Open the help modal window",onClick:()=>t.help.showModal("full")})}),a(wc,{children:[a(xc,{children:"Make Obsidian images and diagrams interactive!"}),a(_c,{children:[t.manifest.version,a("span",{children:"\u2022"}),a("a",{href:"https://github.com/Ssentiago/image-zoom-drag/blob/main/LICENSE",target:"_blank",children:"Apache-2.0"}),a("span",{children:"\u2022"}),"by"," ",a("a",{href:"https://github.com/gitcpy",target:"_blank",children:"gitcpy"})," ","and"," ",a("a",{href:"https://github.com/Ssentiago",target:"_blank",children:"Ssentiago"})]})]})]})},Sc=()=>{const{plugin:t}=se(),[e,n]=O({storage:t.logger.getStorageUsage(),entries:t.logger.getAllLogs().length});q(()=>{const l=d=>{n(d)};return t.emitter.on("logs-changed",l),()=>{t.emitter.off("logs-changed",l)}},[t]);const i=le(()=>{const l=t.logger.exportLogs(),d=new Blob([l],{type:"text/plain"}),u=URL.createObjectURL(d),p=document.createElement("a");p.href=u,p.download="izd-logs.txt",p.click(),URL.revokeObjectURL(u)},[t.logger]),o=le(async()=>{const l=t.logger.exportLogs();if(l.trim()===""){t.showNotice(f("R"));return}await navigator.clipboard.writeText(l),t.showNotice(f("S"))},[]),s=le(async()=>{const l=JSON.stringify(t.logger.getShortSystemInfo(),null,2),d=encodeURIComponent(`## Issue Description
[Describe your issue here]

## Steps to Reproduce
1. [First step]
2. [Second step]

## System info
${l}

`),u=`https://github.com/Ssentiago/image-zoom-drag/issues/new?title=${encodeURIComponent("[Bug Report] ")}&labels=bug&body=${d}`;window.open(u,"_blank")},[]),r=le(async()=>{t.logger.clearAllLogs(),t.showNotice(f("O"))},[]);return a(W,{children:[a(z,{name:f("$"),desc:f("Z"),children:a("button",{"aria-label":f("_"),onClick:s,"data-icon":"bug"})}),a(z,{name:f("U"),desc:f("T"),children:a("input",{type:"checkbox",defaultChecked:t.settings.$.debug.enabled,onChange:async l=>{t.settings.$.debug.enabled=l.currentTarget.checked,await t.settings.save()}})}),a(z,{name:f("Y"),desc:f("X"),children:a("select",{value:t.settings.$.debug.level,onChange:async l=>{t.settings.$.debug.level=l.target.value,await t.settings.save()},children:[a("option",{value:"none",children:"None"}),a("option",{value:"error",children:"Error"}),a("option",{value:"warn",children:"Warning"}),a("option",{value:"info",children:"Info"}),a("option",{value:"debug",children:"Debug"})]})}),a(z,{name:f("K"),desc:f("J")}),a(z,{name:f("W"),children:a("button",{"aria-label":f("V"),onClick:i,"data-icon":"download"})}),a(z,{name:f("Q"),children:a("button",{"aria-label":f("P"),onClick:o,"data-icon":"clipboard"})}),a(z,{name:f("N"),desc:ie(f("M"),{storage:e.storage,entries:e.entries.toString()}),children:a("button",{"aria-label":f("L"),onClick:r,"data-icon":"trash"})})]})},$c=B.div.withConfig({displayName:"RoutesContentstyled__SRoutesContent",componentId:"sc-1720ji1-0"})(["position:relative;height:100%;width:100%;"]),kc=ws(["from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);}"]),Ec=B.div.withConfig({displayName:"RoutesContentstyled__SRoutesContainer",componentId:"sc-1720ji1-1"})(["> *{animation:"," 0.3s ease;}"],kc),Nc=({onClose:t,title:e})=>{const{plugin:n}=se(),[i,o]=O(!1),s=oe.useMemo(()=>{const{zoom:p,move:c,service:v}=n.settings.$.panels.local.panels;return{zoom:[{tooltip:f("y"),icon:"zoom-in",getValue:()=>p.buttons.in,setValue:m=>p.buttons.in=m},{tooltip:f("A"),icon:"zoom-out",getValue:()=>p.buttons.out,setValue:m=>p.buttons.out=m},{tooltip:f("B"),icon:"refresh-cw",getValue:()=>p.buttons.reset,setValue:m=>p.buttons.reset=m}],move:[{tooltip:f("o"),icon:"arrow-up",getValue:()=>c.buttons.up,setValue:m=>c.buttons.up=m},{tooltip:f("i"),icon:"arrow-down",getValue:()=>c.buttons.down,setValue:m=>c.buttons.down=m},{tooltip:f("l"),icon:"arrow-left",getValue:()=>c.buttons.left,setValue:m=>c.buttons.left=m},{tooltip:f("n"),icon:"arrow-right",getValue:()=>c.buttons.right,setValue:m=>c.buttons.right=m},{tooltip:f("q"),icon:"arrow-up-right",getValue:()=>c.buttons.upRight,setValue:m=>c.buttons.upRight=m},{tooltip:f("k"),icon:"arrow-down-right",getValue:()=>c.buttons.downRight,setValue:m=>c.buttons.downRight=m},{tooltip:f("p"),icon:"arrow-up-left",getValue:()=>c.buttons.upLeft,setValue:m=>c.buttons.upLeft=m},{tooltip:f("j"),icon:"arrow-down-left",getValue:()=>c.buttons.downLeft,setValue:m=>c.buttons.downLeft=m}],service:[{tooltip:f("v"),icon:"eye",getValue:()=>v.buttons.hide,setValue:m=>v.buttons.hide=m},{tooltip:f("r"),icon:"fullscreen",getValue:()=>v.buttons.fullscreen,setValue:m=>v.buttons.fullscreen=m}]}},[n]),r={zoom:f("z"),move:f("m"),service:f("x")},l=pe(!1),d={minimal:{zoom:{in:!0,out:!0,reset:!1},move:{up:!1,down:!1,left:!1,right:!1,upRight:!1,downRight:!1,upLeft:!1,downLeft:!1},service:{hide:!0,fullscreen:!1}},full:{zoom:{in:!0,out:!0,reset:!0},move:{up:!0,down:!0,left:!0,right:!0,upRight:!0,downRight:!0,upLeft:!0,downLeft:!0},service:{hide:!0,fullscreen:!0}},presentation:{zoom:{in:!0,out:!0,reset:!0},move:{up:!1,down:!1,left:!1,right:!1,upRight:!1,downRight:!1,upLeft:!1,downLeft:!1},service:{hide:!0,fullscreen:!0}}};q(()=>{const p=async c=>{l.current||(n.settings.$.panels.local.preset="none",await n.settings.save(),o(v=>!v))};return n.settings.emitter.on(`${n.settings.$$.panels.local.panels.$all}`,p),()=>{n.settings.emitter.off(`${n.settings.$$.panels.local.panels.$all}`,p)}},[n,l]);const u=async p=>{l.current=!0;const{zoom:c,move:v,service:m}=n.settings.$.panels.local.panels,x=d[p];Object.assign(c.buttons,x.zoom),Object.assign(v.buttons,x.move),Object.assign(m.buttons,x.service),n.settings.$.panels.local.preset=p,await n.settings.save(),l.current=!1,o(C=>!C)};return a(ct,{title:e,onClose:t,children:[a(z,{name:f("aJ"),children:[a("button",{className:n.settings.$.panels.local.preset==="minimal"?"button-active":"",onClick:()=>u("minimal"),children:f("aH")}),a("button",{className:n.settings.$.panels.local.preset==="full"?"button-active":"",onClick:()=>u("full"),children:f("aG")}),a("button",{className:n.settings.$.panels.local.preset==="presentation"?"button-active":"",onClick:()=>u("presentation"),children:f("aI")})]}),Object.entries(s).map(([p,c])=>a(oe.Fragment,{children:[a(z,{name:r[p],heading:!0}),c.map(({tooltip:v,icon:m,getValue:x,setValue:C},E)=>a(z,{name:v,noBorder:E!==c.length-1,children:[a("button",{"aria-label":v,"data-icon":m}),a("input",{type:"checkbox",checked:x(),onChange:async N=>{C(N.target.checked)}})]},v))]},p))]})},Pc=B.div.withConfig({displayName:"PanelLayoutstyled__UnitSetup",componentId:"sc-1fhufom-0"})(["display:flex;flex-direction:column;gap:20px;"]),Ic=B.div.withConfig({displayName:"PanelLayoutstyled__UnitPreview",componentId:"sc-1fhufom-1"})(["position:relative;width:400px;height:300px;border:2px solid var(--color-base-30);margin:0 auto;"]),Fs=B.div.withConfig({displayName:"PanelLayoutstyled__PanelPreview",componentId:"sc-1fhufom-2"})(["position:absolute;width:60px;height:40px;padding:8px;background:var(--color-base-20);border-radius:4px;font-size:0.9em;display:flex;align-items:center;justify-content:center;user-select:none;cursor:move;opacity:",";transition:","}"],({dragging:t})=>t?.5:1,({dragging:t})=>t?"all 0.3s ease":"none"),Mc=B(Fs).withConfig({displayName:"PanelLayoutstyled__FoldPanel",componentId:"sc-1fhufom-3"})(["position:absolute;bottom:0;left:50%;transform:translateX(-50%);pointer-events:none;text-align:justify;"]),Lc=B.div.withConfig({displayName:"PanelLayoutstyled__PanelControl",componentId:"sc-1fhufom-4"})(["display:flex;justify-content:center;gap:20px;"]),Dc=B.div.withConfig({displayName:"PanelLayoutstyled__PanelToggle",componentId:"sc-1fhufom-5"})(["display:flex;flex-direction:column;align-items:center;font-size:0.9em;"]),wn=(t,e,n)=>{const i=(C,E,N)=>C<=30?{top:"0px"}:N-E<=30?{bottom:"0px"}:{top:`${(C/N*100).toFixed(1)}%`},o=(C,E,N)=>C<=30?{left:"0px"}:N-E<=30?{right:"0px"}:{left:`${(C/N*100).toFixed(1)}%`},s={},r=t,l=t+60,d=e,u=e+40,p=r,c=n.width-l,v=d,m=n.height-u,x=[{edge:"left",value:p},{edge:"right",value:c},{edge:"top",value:v},{edge:"bottom",value:m}].reduce((C,E)=>Math.abs(C.value)<Math.abs(E.value)?C:E);if(Math.abs(x.value)<=30)switch(x.edge){case"left":s.left="0px",Object.assign(s,i(d,u,n.height));break;case"right":s.right="0px",Object.assign(s,i(d,u,n.height));break;case"top":s.top="0px",Object.assign(s,o(r,l,n.width));break;case"bottom":s.bottom="0px",Object.assign(s,o(r,l,n.width));break}else s.left=`${(r/n.width*100).toFixed(1)}%`,s.top=`${(d/n.height*100).toFixed(1)}%`;return s},Ac=({unitPreviewRef:t,panels:e})=>{const{plugin:n}=se(),[i,o]=O(null),s=(c,v)=>{const m=c.currentTarget.getBoundingClientRect(),x=c.clientX-m.left,C=c.clientY-m.top;c.dataTransfer.setData("application/json",JSON.stringify({panelName:v,offsetX:x,offsetY:C})),o(v)},r=async c=>{if(c.preventDefault(),!t.current)return;const v=t.current.getBoundingClientRect(),m=JSON.parse(c.dataTransfer.getData("application/json")),x=c.clientX-v.left-m.offsetX,C=c.clientY-v.top-m.offsetY,E=wn(x,C,v),N=m.panelName;e[N].position=E,o(null),await n.settings.save()},l=(c,v)=>{const m=c.touches[0],x=c.target,C=x.getBoundingClientRect(),E=m.clientX-C.left,N=m.clientY-C.top;o(v),x.dataset.dragData=JSON.stringify({panelName:v,offsetX:E,offsetY:N})},d=c=>{const v=t.current;if(!v||i)return;c.preventDefault();const m=c.touches[0],x=c.currentTarget,C=JSON.parse(x.dataset.dragData??"{}"),E=v.getBoundingClientRect(),N=m.clientX-E.left-C.offsetX,I=m.clientY-E.top-C.offsetY,L=wn(N,I,E);x.style.left=L.left,x.style.top=L.top},u=async c=>{const v=t.current;if(!v||!i)return;const m=c.currentTarget,x=JSON.parse(m.dataset.dragData??"{}"),C=c.changedTouches[0],E=v.getBoundingClientRect(),N=C.clientX-E.left-x.offsetX,I=C.clientY-E.top-x.offsetY,L=wn(N,I,E),D=x.panelName;e[D].position=L,o(null),await n.settings.save()},p=R.Platform.isDesktopApp?{panel:c=>({draggable:!0,onDragStart:v=>s(v,c)}),container:{onDrop:r,onDragOver:c=>c.preventDefault()}}:{panel:c=>({onTouchStart:v=>l(v,c),onTouchMove:v=>d(v),onTouchEnd:v=>u(v)}),container:{}};return{draggedPanel:i,props:p}},Tc=()=>{const{plugin:t}=se(),[e,n]=O(t.settings.$.panels.local.panels),i=ce(()=>({zoom:f("z"),move:f("m"),service:f("x"),fold:f("h")}),[]),[,o]=O(!1),s=oe.useRef(null),{draggedPanel:r,props:l}=Ac({unitPreviewRef:s,panels:e});q(()=>{const u=p=>{o(c=>!c)};return t.settings.emitter.on(t.settings.$$.panels.local.panels.$all,u),()=>{t.settings.emitter.off(t.settings.$$.panels.local.panels.$all,u)}},[]);const d=async u=>{e[u].on=!e[u].on,await t.settings.save()};return a(Pc,{children:[a(Ic,{ref:s,onDragOver:u=>u.preventDefault(),...l.container,children:[Object.entries(e).map(([u,p])=>p.on&&a(Fs,{dragging:r===u,...l.panel(u),style:{...p.position},children:i[u]},u)),a(Mc,{children:i.fold})]}),a(Lc,{className:"control",children:Object.entries(e).map(([u,p])=>a(Dc,{children:a(z,{name:i[u],children:a("input",{type:"checkbox",checked:p.on,onChange:()=>d(u)})})},u))})]})},Oc=({onClose:t,title:e})=>a(ct,{onClose:t,title:e,children:[a(z,{name:f("aT"),desc:f("aS"),heading:!0,noBorder:!0}),a(z,{name:f("aP"),desc:f("aO"),noBorder:!0}),a(z,{name:f("aR"),desc:f("aQ")}),a(Tc,{})]}),zc=()=>{const[t,e]=oe.useState(!1),[n,i]=oe.useState(!1);return a(W,{children:[a(z,{name:f("aV"),desc:f("aN"),children:a("button",{"aria-label":f("aW"),onClick:()=>{e(!0)},"data-icon":"layout"})}),a(z,{name:f("aL"),desc:f("aF"),children:a("button",{"aria-label":f("aM"),onClick:()=>{i(!0)},"data-icon":"panels-top-left"})}),t&&a(Oc,{onClose:()=>e(!1),title:f("aU")}),n&&a(Nc,{onClose:()=>i(!1),title:f("aK")})]})},Rc=()=>{const{plugin:t}=se(),[e,n]=O(t.settings.$.panels.global.triggering.mode!==Ke.ALWAYS),i=ce(()=>({always:f("ah"),hover:f("aj"),focus:f("ai")}),[t]),[o,s]=O(i[t.settings.$.panels.global.triggering.mode]),r=le(l=>{const d=l.value,u=i[d];s(u)},[t]);return a(W,{children:[a(z,{name:f("ag"),desc:f("ac"),children:[a("select",{value:t.settings.$.panels.global.triggering.mode,onChange:async l=>{const d=l.target.value;t.settings.$.panels.global.triggering.mode=d,n(d!==Ke.ALWAYS),r(l.target),await t.settings.save()},children:[a("option",{value:"always",children:f("ad")}),a("option",{value:"hover",children:f("af")}),a("option",{value:"focus",children:f("ae")})]}),a("button",{"aria-label":o,"data-icon":"message-circle-question"})]}),e&&a(z,{name:f("ab"),desc:f("aa"),children:a("input",{type:"checkbox",defaultChecked:t.settings.$.panels.global.triggering.ignoreService,onChange:async l=>{t.settings.$.panels.global.triggering.ignoreService=l.target.checked,await t.settings.save()}})})]})},Fc=()=>a(W,{children:[a(Rc,{}),a(zc,{})]}),Uc=()=>{const{plugin:t}=se();return a(W,{children:[a(z,{name:"Context menu",heading:!0}),a(z,{name:"Show context menu for diagrams",desc:"Toggle whether to show context menu for diagrams (svg and img generated from the codeblock)",children:a("input",{type:"checkbox",defaultChecked:t.settings.$.units.contextMenu.showForDiagrams,onChange:async e=>{t.settings.$.units.contextMenu.showForDiagrams=e.target.checked,await t.settings.save()}})}),a(z,{name:"Show context menu for other images",desc:"Toggle whether to show context menu for other images elements (i.e. local or external)",children:a("input",{type:"checkbox",defaultChecked:t.settings.$.units.contextMenu.showForOtherImages,onChange:async e=>{t.settings.$.units.contextMenu.showForOtherImages=e.target.checked,await t.settings.save()}})})]})},jc=()=>{const{plugin:t}=se();return a(W,{children:[a(z,{name:f("am"),heading:!0}),a(z,{name:f("al"),children:a("input",{type:"checkbox",defaultChecked:t.settings.$.units.folding.foldByDefault,onChange:async e=>{t.settings.$.units.folding.foldByDefault=e.target.checked,await t.settings.save()}})}),a(z,{name:f("ak"),children:a("input",{type:"checkbox",defaultChecked:t.settings.$.units.folding.autoFoldOnFocusChange,onChange:async e=>{t.settings.$.units.folding.autoFoldOnFocusChange=e.target.checked,await t.settings.save()}})})]})},Bc=()=>{const{plugin:t}=se();return a(W,{children:[a(z,{name:f("ap"),heading:!0}),a(z,{name:f("ar"),desc:f("aq"),children:a("input",{type:"checkbox",defaultChecked:t.settings.$.units.interactivity.picker.enabled,onChange:async e=>{t.settings.$.units.interactivity.picker.enabled=e.target.checked,await t.settings.save()}})}),a(z,{name:f("ao"),desc:f("an"),children:a("input",{type:"checkbox",defaultChecked:t.settings.$.units.interactivity.markdown.autoDetect,onChange:async e=>{const n=e.target.checked;t.settings.$.units.interactivity.markdown.autoDetect=n,await t.settings.save()}})})]})};var Re=(t=>(t.Folded="folded",t.Expanded="expanded",t))(Re||{});const Fn={px:{min:100,max:1e3,label:"px",rangeMessage:"100-1000px"},"%":{min:10,max:100,label:"%",rangeMessage:"10-100%"}},io=(t,e)=>{const n=parseInt(t,10),{min:i,max:o}=Fn[e];return n>=i&&n<=o},oo=(t,e)=>{const n=e==="px"?Fn.px.rangeMessage:Fn["%"].rangeMessage;switch(t){case"width":return ie(f("aC"),{range:n});case"height":return ie(f("aB"),{range:n})}},so=({type:t,initialOptions:e,border:n})=>{const{plugin:i}=se(),[o,s]=O(e.height.type),[r,l]=O(e.width.type),[d,u]=O(e.height.value.toString()),[p,c]=O(e.width.value.toString()),[v,m]=O(""),[x,C]=O("");pe(null);const E=le(()=>{switch(t){case Re.Expanded:return f("at");case Re.Folded:return f("av")}},[t]);le(()=>{switch(t){case Re.Expanded:return f("as");case Re.Folded:return f("au")}},[t]);const N=(T,G)=>io(T,G)?(m(""),!0):(m(oo("height",G)),!1),I=(T,G)=>io(T,G)?(C(""),!0):(C(oo("width",G)),!1),L=le((T,G,U)=>{G==="height"?N(T,U):I(T,U)},[]);q(()=>{L(p,"width",r),L(d,"height",o)},[r,o]);const D=async()=>{const T=N(d,o),G=I(p,r);if(!T||!G){i.showNotice(f("aA"));return}const U=parseInt(p,10),de=parseInt(d,10);if(U===e.width.value&&de===e.height.value&&r===e.width.type&&o===e.height.type){i.showNotice(f("aD"));return}e.width.value=U,e.height.value=de,e.width.type=r,e.height.type=o,t===Re.Folded?i.settings.$.units.size.folded=e:i.settings.$.units.size.expanded=e,await i.settings.save(),i.showNotice(f("aE"))},M=async T=>{T.code==="Enter"&&(T.preventDefault(),await D())},A=(T,G,U,de,re,ge,Ae,Te)=>{const j=a(W,{children:[a("label",{htmlFor:G,children:T}),a("input",{id:G,type:"text",value:U,className:de.trim()?"invalid":"","aria-label":de||re==="px"?"100-1000px":"10-100%",onChange:Oe=>{const ye=Oe.target.value.replace(/\D/,"");Oe.target.value=ye,ge(ye),Te(ye,re)},onKeyDown:M}),a("select",{value:re,onChange:Oe=>{const ye=Oe.target.value;Ae(ye),Te(U,ye)},children:[a("option",{value:"px",children:"px"}),a("option",{value:"%",children:"%"})]})]});return R.Platform.isMobile?a(z,{noBorder:!0,children:j}):j};return a(W,{children:[a(z,{name:E(),noBorder:!0}),R.Platform.isMobile?a(W,{children:[A(f("ax"),"height-input",d,v,o,u,s,N),A(f("ay"),"width-input",p,x,r,c,l,I),a(z,{children:a("button",{"aria-label":f("az"),onClick:D,"data-icon":"save"})})]}):a(z,{children:[A(f("ax"),"height-input",d,v,o,u,s,N),A(f("ay"),"width-input",p,x,r,c,l,I),a("button",{"aria-label":f("az"),onClick:D,"data-icon":"save"})]})]})},Hc=()=>{const{plugin:t}=se();return a(W,{children:[a(z,{name:f("aw"),heading:!0}),a(so,{type:Re.Expanded,initialOptions:t.settings.$.units.size.expanded}),a(so,{type:Re.Folded,initialOptions:t.settings.$.units.size.folded,border:!0})]})},ro=()=>a(W,{children:[a(Bc,{}),a(Hc,{}),a(jc,{}),a(Uc,{})]}),Vc=(t,e)=>{const{plugin:n}=se(),[i,o]=O(!1),[s,r]=O(!1),[l,d]=O([]),[u,p]=O([]),[c,v]=O(""),[m,x]=O("");q(()=>{if(l.length>0){const M=l[l.length-1];v(M.description)}else v("");if(u.length>0){const M=u[u.length-1];x(M.description)}else x("")},[l,u]);const C=()=>{if(!c)return f("bU");const M=l.length>1?` (${l.length-1} more)`:"";return ie(f("bT"),{description:c,count:M})},E=()=>{if(!m)return f("bS");const M=u.length>1?` (${u.length-1} more)`:"";return ie(f("bR"),{description:m,count:M})};q(()=>{const M=async()=>{d([]),p([]),o(!1),r(!1)};return n.settings.emitter.on("settings-reset",M),n.settings.emitter.on("settings-clear-history",M),()=>{n.settings.emitter.off("settings-reset",M),n.settings.emitter.off("settings-clear-history",M)}},[]);const N=(M,A)=>{let T=[...l];T.push({description:A,state:M}),o(!0),T.length>50&&(T=[...T.slice(-49)]),d(T),p([]),r(!1)},I=M=>{const A=[...u,M];p(A),r(!0)},L=async()=>{if(l.length>0){const M=l[l.length-1];I({state:[...t],description:M.description}),await e([...M.state]);const A=l.slice(0,-1);d(A),o(A.length>0)}},D=async()=>{if(u.length>0){const M=u[u.length-1],A=[...l,{state:[...t],description:M.description}];d(A);const T=u.slice(0,-1);p(T),await e([...M.state]),o(!0),r(T.length>0)}};return q(()=>{const M=async A=>{A.code!=="KeyZ"&&A.code!=="KeyY"||((A.ctrlKey||A.metaKey)&&A.shiftKey?(A.preventDefault(),s?await D():n.showNotice(f("bP"))):(A.ctrlKey||A.metaKey)&&(A.preventDefault(),i?await L():n.showNotice(f("bQ"))),A.code==="KeyY"&&(A.ctrlKey||A.metaKey)&&!A.shiftKey&&(A.preventDefault(),await D()))};return window.addEventListener("keydown",M,!0),()=>{window.removeEventListener("keydown",M,!0)}},[L,D]),{updateUndoStack:N,undo:L,redo:D,canUndo:i,canRedo:s,getRedoLabel:E,getUndoLabel:C}},Gc=()=>{const t=Fe(void 0);return{HistoryProvider:({state:e,updateState:n,children:i})=>{const{undo:o,canUndo:s,redo:r,canRedo:l,getRedoLabel:d,getUndoLabel:u,updateUndoStack:p}=Vc(e,n),{plugin:c}=se(),v=ce(()=>({undo:o,canUndo:s,redo:r,canRedo:l,getRedoLabel:d,getUndoLabel:u,updateUndoStack:p}),[o,s,r,l,d,u,p]);return q(()=>()=>{c.settings.emitter.emit("settings-clear-history",{eventName:"settings-clear-history",oldValue:void 0,newValue:void 0})},[c]),a(t.Provider,{value:v,children:i})},useHistoryContext:()=>{const e=ke(t);if(e===void 0)throw new Error("useUndoRedoContext must be used within a UndoRedoProvider");return e}}},Us=Gc(),ui=Us.useHistoryContext,Wc=Us.HistoryProvider,Yc=()=>{const{plugin:t}=se(),[e,n]=O(t.settings.$.units.configs);q(()=>{const o=()=>{n(t.settings.$.units.configs)};return t.settings.emitter.on(t.settings.$$.units.configs.$path,o),()=>{t.settings.emitter.off(t.settings.$$.units.configs.$path,o)}},[t]);const i=le(async o=>{n(o),t.settings.$.units.configs=o,await t.settings.save()},[t]);return{units:e,saveUnits:i}},js=Fe(void 0),Kc=({children:t})=>{const{units:e,saveUnits:n}=Yc(),i=ce(()=>({units:e,saveUnits:n}),[e,n]);return a(js.Provider,{value:i,children:t})},dt=()=>{const t=ke(js);if(t===void 0)throw new Error("useUnitsManagerContext must be used within a UnitsManagerProvider");return t},di=()=>{const{plugin:t}=se(),{units:e}=dt(),[n,i]=O(new Set),[o,s]=O(new Set),r=p=>{const c={names:[],selectors:[]};p.forEach(v=>{c.names.push(v.name),c.selectors.push(v.selector)}),i(new Set(c.names)),s(new Set(c.selectors))};q(()=>{r(t.settings.$.units.configs);const p=c=>{r(e)};return t.settings.emitter.on(t.settings.$$.units.configs.$path,p),()=>{t.settings.emitter.off(t.settings.$$.units.configs.$path,p)}},[e]);const l=p=>{try{return document.querySelector(p),{valid:!0,err:void 0}}catch(c){return{valid:!1,err:c.message.split(":").slice(1).join(":").trim()}}},d=(p,c)=>p.trim()?n.has(p)&&(!c||c.name!==p)?{valid:!1,tooltip:f("bY"),empty:!1}:{valid:!0,tooltip:"",empty:!1}:{empty:!0,tooltip:"",valid:!1},u=(p,c)=>{if(!p.trim())return{empty:!0,tooltip:"",valid:!1};const{valid:v,err:m}=l(p);return v?o.has(p)&&(!c||c.selector!==p)?{valid:!1,tooltip:f("b$"),empty:!1}:{valid:!0,tooltip:"",empty:!1}:{valid:!1,tooltip:ie(f("bX"),{err:m??""}),empty:!1}};return{validateBoth:(p,c,v)=>{const m=d(p,v),x=u(c,v),C=m.empty&&x.empty,E=(m.empty||x.empty)&&!C;return{nameResult:m,selectorResult:x,bothEmpty:C,oneEmpty:E}},validateName:d,validateSelector:u,processValidationOnSave:p=>{if(p.bothEmpty)return t.showNotice(f("bZ")),!1;if(p.oneEmpty){const m=p.nameResult.empty?"name":"selector";return t.showNotice(ie(f("bW"),{field:m})),!1}const c=!p.nameResult.valid&&!p.selectorResult.valid,v=!p.nameResult.valid||!p.selectorResult.valid;if(c)return t.showNotice(f("bV")),!1;if(v){const m=p.nameResult.valid?"selector":"name";return t.showNotice(ie(f("b_"),{field:m})),!1}return!0}}},qc=()=>{const{plugin:t}=se(),e=ce(()=>t.manifest.dir,[t]),[n,i]=O(!0),[o,s]=O(""),r=async u=>{try{const p=await R.requestUrl("https://raw.githubusercontent.com/Ssentiago/image-zoom-drag/main/assets/videos/find-class.mp4");return p.status!==200?(t.logger.error(`Error downloading video: ${p.status}`,{functionName:"downloadVideo",lineNumber:21,columnNumber:779,fileName:"src\\settings\\ui\\pages\\images\\presets\\add-new-image-preset\\modals\\hooks\\useUserGuideVideo.ts"}),!1):(await t.app.vault.adapter.writeBinary(u,p.arrayBuffer),!0)}catch(p){return t.logger.error(`Error downloading video: ${p.message}`,{functionName:"downloadVideo",lineNumber:33,columnNumber:1326,fileName:"src\\settings\\ui\\pages\\images\\presets\\add-new-image-preset\\modals\\hooks\\useUserGuideVideo.ts"}),!1}},l=async()=>{const u=t.manifest.dir;if(!u)return!1;const p=R.normalizePath(`${u}/assets`),c=R.normalizePath(`${p}/user-guide-video.mp4`),v=await t.app.vault.adapter.exists(p),m=await t.app.vault.adapter.exists(c);return!v&&await t.app.vault.adapter.mkdir(p),m||await r(c),t.app.vault.adapter.exists(c)},d=pe(R.normalizePath(`${e}/assets/user-guide-video.mp4`));return q(()=>{(async()=>{i(!0);try{if(await l()){const u=await t.app.vault.adapter.readBinary(d.current),p=Buffer.from(u).toString("base64");s(`data:video/mp4;base64,${p}`)}else t.showNotice("The user guide video is not available.")}catch(u){console.error(u),t.showNotice("Something went wrong. The video is missing.")}finally{i(!1)}})()},[d]),{isLoading:n,videoUrl:o}},Zc=({onClose:t})=>{const{isLoading:e,videoUrl:n}=qc();return a(ct,{title:f("bh"),onClose:()=>t(),children:a(W,{children:[a(z,{name:f("bj"),desc:f("bi")}),a(z,{name:f("bn"),desc:f("bm")}),a(z,{name:f("bj"),desc:f("bi")}),a(z,{name:f("be"),heading:!0,desc:f("bd")}),a(z,{name:f("bg"),desc:f("bf")}),e&&a("p",{children:f("bl")}),!e&&n&&a("video",{src:n,controls:!0,autoPlay:!1,style:{width:"100%",maxHeight:"400px"}}),!e&&!n&&a("p",{children:f("bk")})]})})},Xc=()=>{const{plugin:t}=se(),[e,n]=O(!1),{validateSelector:i,validateBoth:o,validateName:s,processValidationOnSave:r}=di(),[l,d]=O(""),[u,p]=O(""),[c,v]=O(""),[m,x]=O(""),{units:C,saveUnits:E}=dt(),{updateUndoStack:N}=ui(),I=async()=>{debugger;const M=o(l,u);if(!r(M))return;const A=[...C],T={name:l,selector:u,on:!0,panels:{move:{on:!0},zoom:{on:!0},service:{on:!0}}},G=[...C,T];await E(G),N(A,ie(f("bc"),{name:T.name,selector:T.selector})),t.showNotice(f("aZ")),d(""),p("")},L=async M=>{M.code==="Enter"&&(M.preventDefault(),await I())},D=()=>{const M=()=>a("input",{id:"unit-name",type:"text",className:c.trim()?"invalid":"",placeholder:f("a_"),value:l,"aria-label":c,onChange:G=>{const U=G.target.value;d(U),s(U),v(s(l).tooltip)},onKeyDown:L}),A=()=>a("input",{id:"unit-selector",type:"text",value:u,className:m.trim()?"invalid":"","aria-label":m,placeholder:f("a$"),onChange:G=>{const U=G.target.value;p(U);const de=i(U);x(de.tooltip)},onKeyDown:L}),T=()=>a("button",{"aria-label":f("bb"),onClick:I,"data-icon":"save"});return R.Platform.isMobile?a(W,{children:[a(z,{noBorder:!0,children:M()}),a(z,{noBorder:!0,children:A()}),a(z,{noBorder:!0,children:T()})]}):a(z,{children:[M(),A(),T(),a("button",{"aria-label":f("ba"),onClick:()=>{n(!0)},"data-icon":"info"})]})};return a(W,{children:[a(z,{name:f("aY"),heading:!0,noBorder:!0,desc:f("aX")}),D(),e&&a(Zc,{onClose:()=>n(!1)})]})},Jc=B.div.withConfig({displayName:"AvailableImageConfigsstyled__ButtonContainer",componentId:"sc-13jkgi2-0"})(["position:relative;display:flex;justify-content:center;align-items:center;gap:20px;margin-top:20px;margin-bottom:20px;padding-bottom:20px;&::after{content:'';position:absolute;left:0;right:0;bottom:0;height:1px;background-color:var(--color-base-30);margin-top:20px;}"]),ao=B.button.withConfig({displayName:"AvailableImageConfigsstyled__PaginationButton",componentId:"sc-13jkgi2-1"})(["&:disabled{background-color:var(--color-base-50);cursor:not-allowed;}"]),Qc=B.button.withConfig({displayName:"AvailableImageConfigsstyled__UndoButton",componentId:"sc-13jkgi2-2"})(["margin-right:auto;&:disabled{background-color:var(--color-base-50);cursor:not-allowed;}"]),eu=B.button.withConfig({displayName:"AvailableImageConfigsstyled__RedoButton",componentId:"sc-13jkgi2-3"})(["margin-left:auto;&:disabled{background-color:var(--color-base-50);cursor:not-allowed;}"]),tu=B.div.withConfig({displayName:"AvailableImageConfigsstyled__PaginationControls",componentId:"sc-13jkgi2-4"})(["display:flex;align-items:center;gap:20px;"]),nu=()=>{const{plugin:t}=se(),{validateBoth:e,processValidationOnSave:n}=di(),{units:i,saveUnits:o}=dt(),{updateUndoStack:s}=ui();return{handleDelete:async r=>{const l=[...i],d=[...i],u=d[r];d.splice(r,1),await o(d),s(l,ie(f("br"),{name:u.name,selector:u.selector}))},handleToggle:async(r,l)=>{const d=JSON.parse(JSON.stringify(i));i[r].on=l,await o([...i]);const u=f(l?"bu":"bs"),p=ie(u,{name:i[r].name});s(d,p)},handleSaveEditing:async r=>{const l=JSON.parse(JSON.stringify(i)),d=i[r],u=document.querySelector("#editing-name-input"),p=document.querySelector("#editing-selector-input");if(!u||!p)return;const c=e(u.value,p.value,d),v=n(c);if(v){const m=d.name,x=d.selector,C=m!==u.value,E=x!==p.value;i[r].name=u.value,i[r].selector=p.value,await o([...i]),u.removeAttribute("id"),p.removeAttribute("id");const N=[];C&&N.push(ie(f("bp"),{old:m,new:i[r].name})),E&&N.push(ie(f("bq"),{old:x,new:i[r].selector})),s(l,ie(f("bt"),{name:i[r].name,changes:N.join(`
`)}))}return{validationResult:c,validated:v}}}},iu=({unit:t,index:e,modeState:n,setModeState:i})=>{const[o,s]=O(t.name),[r,l]=O(t.selector),[d,u]=O(""),[p,c]=O(""),{validateName:v,validateSelector:m}=di(),{handleSaveEditing:x,handleDelete:C,handleToggle:E}=nu(),N=async I=>{if(I.code==="Enter"){I.preventDefault();const L=await x(e);if(L){const{validationResult:D,validated:M}=L;u(D.nameResult.tooltip),c(D.selectorResult.tooltip),M&&i({index:-1,mode:"none"})}}};return n.index===e&&n.mode==="edit"?a(z,{children:[a("input",{id:"editing-name-input",type:"text",value:o,className:d.trim()?"invalid":"","aria-label":d,onChange:I=>{const L=I.target.value,D=v(L,t);u(D.tooltip)},onKeyDown:N}),a("input",{id:"editing-selector-input",type:"text",value:r,className:(p.trim(),""),"aria-label":p,onChange:I=>{const L=I.target.value,D=m(L,t);c(D.tooltip)},onKeyDown:N}),a("button",{"aria-label":f("bv"),onClick:()=>{i({index:-1,mode:"none"})},"data-icon":"circle-x"}),a("button",{"aria-label":ie(f("bz"),{name:t.name}),onClick:async()=>{const I=await x(e);if(I){const{validationResult:L,validated:D}=I;u(L.nameResult.tooltip),c(L.selectorResult.tooltip),D&&i({index:-1,mode:"none"})}else i({index:-1,mode:"none"})},"data-icon":"save"})]}):a(z,{name:t.name,desc:t.selector,children:[a("input",{type:"checkbox",checked:t.on,"aria-label":t.on?ie(f("bA"),{name:t.name}):ie(f("bB"),{name:t.name}),onChange:async I=>{await E(e,I.target.checked)}}),![Me.IMG_SVG,Me.Default].contains(t.selector)&&a(W,{children:[a("button",{"aria-label":ie(f("bx"),{name:t.name}),onClick:async()=>{i({index:e,mode:"edit"})},"data-icon":"edit"}),a("button",{"aria-label":ie(f("bw"),{name:t.name}),onClick:async()=>{await C(e)},"data-icon":"trash"})]}),a("button",{"aria-label":ie(f("by"),{name:t.name}),onClick:()=>{i({index:e,mode:"options"})},"data-icon":"settings"})]})},ou=({itemsPerPage:t,totalItems:e})=>{const[n,i]=O(1),[o,s]=O(0),r=ce(()=>Math.max(1,Math.ceil(e/t)),[e,t]),l=ce(()=>(n-1)*t,[n,t]),d=ce(()=>l+t,[l,t]);return q(()=>{const u=Math.max(1,Math.ceil(e/t));i(p=>Math.min(p,u))},[t,e]),{page:n,pageStartIndex:l,pageEndIndex:d,delta:o,setDelta:s,totalPages:r,navigateToPage:u=>{i(p=>Math.min(r,Math.max(p+u,1)))}}},su=({unitIndex:t,onClose:e,onChanges:n})=>{const{plugin:i}=se(),{units:o}=dt(),s=ce(()=>o[t],[t]);return a(ct,{onClose:e,title:ie(f("bD"),{name:s.name}),children:[a(z,{desc:f("bC")}),a(z,{name:f("bF"),heading:!0}),Object.entries(s.panels).map(([r,{on:l}])=>a(z,{name:r.charAt(0).toUpperCase().concat(r.slice(1).toLowerCase()),children:a("input",{type:"checkbox",defaultChecked:l,onChange:async d=>{const u=d.target.checked,p=JSON.parse(JSON.stringify(o));i.settings.$.units.configs[t].panels[r].on=u,await i.settings.save();const c=f(u?"bH":"bG");n(p,ie(f("bE"),{state:c,panel:r,name:s.name}))}})},r))]})},ru=()=>{const{plugin:t}=se(),e=ce(()=>f("bN"),[t]),[n,i]=O(t.settings.$.units.settingsPagination.perPage),{units:o}=dt(),[s,r]=O({mode:"none",index:-1}),{navigateToPage:l,totalPages:d,pageStartIndex:u,pageEndIndex:p,page:c}=ou({itemsPerPage:n,totalItems:o.length}),{updateUndoStack:v,undo:m,canUndo:x,canRedo:C,getRedoLabel:E,redo:N,getUndoLabel:I}=ui();q(()=>{const M=async()=>{i(t.settings.$.units.settingsPagination.perPage)};return t.settings.emitter.on(t.settings.$$.units.settingsPagination.perPage.$path,M),()=>{t.settings.emitter.off(t.settings.$$.units.settingsPagination.perPage.$path,M)}},[t]);const L=ce(()=>o.slice(u,p),[o,u,p]),D=M=>{const A=M==="next"?c<d:c>1;if(s.mode==="edit"&&A)return f("bI");switch(M){case"previous":return f(A?"bM":"bL");case"next":return f(A?"bK":"bJ")}};return a(W,{children:[a(z,{name:f("bo"),heading:!0}),a(z,{name:f("bO"),disabled:s.mode==="edit",children:a("input",{type:"range",min:1,max:50,step:1,onChange:async M=>{t.settings.$.units.settingsPagination.perPage=parseInt(M.target.value,10),await t.settings.save()}})}),a(Jc,{children:[a(Qc,{onClick:m,disabled:!x,"aria-label":I(),children:a(xs,{size:"20px"})}),a(tu,{children:[a(ao,{onClick:()=>l(-1),disabled:c===1||s.mode==="edit","aria-label":D("previous"),children:a(bl,{size:"20px"})}),ie(e,{current:c.toString(),total:d.toString(),count:o.length.toString()}),a(ao,{onClick:()=>l(1),disabled:c===d||s.mode==="edit","aria-label":D("next"),children:a(_l,{size:"20px"})})]}),a(eu,{disabled:!C,onClick:N,"aria-label":E(),children:a(Al,{size:"20px"})})]}),L.map((M,A)=>a(iu,{unit:M,index:u+A,modeState:s,setModeState:r},`${M.name}-${M.selector}`)),s.mode==="options"&&s.index!==-1&&a(su,{unitIndex:s.index,onChanges:v,onClose:()=>{r({mode:"none",index:-1})}})]})},au=()=>{const{units:t,saveUnits:e}=dt();return a(Wc,{state:t,updateState:e,children:[a(Xc,{}),a(ru,{})]})},lu=()=>{const[t,e]=an();return a(Kc,{children:a(Rs,{location:t,children:[a(Ge,{path:"/general",children:()=>a(ro,{})}),a(Ge,{path:"/presets",children:()=>a(au,{})}),a(Ge,{path:"/controls",children:()=>a(Fc,{})}),a(Ge,{path:"",children:()=>a(ro,{})})," "]})})},cu=B.button.withConfig({displayName:"Sidebarstyled__SidebarButton",componentId:"sc-4b9op8-0"})(["z-index:101;transition:all 0.2s ease;&:hover{transform:scale(1.05);background-color:var(--background-modifier-hover);}"]),uu=B.div.withConfig({displayName:"Sidebarstyled__Overlay",componentId:"sc-4b9op8-1"})(["position:absolute;top:0;left:0;width:100%;height:100%;z-index:99;"]),Je=B.div.withConfig({displayName:"Sidebarstyled__Section",componentId:"sc-4b9op8-2"})(["display:flex;padding:5px 10px;border-bottom:1px solid var(--background-modifier-border);margin-left:",";background-color:",";border-left:",";cursor:pointer;transition:all 0.2s ease;&:last-child{border-bottom:none;}&:hover{background-color:",";}svg{width:14px;height:14px;transition:transform 0.2s ease;flex-shrink:0;}"],t=>t.$nested?"20px":"0",t=>t.$active?"var(--interactive-accent)":"transparent",t=>t.$active?"3px solid var(--text-accent)":"3px solid transparent",t=>t.$active?"var(--interactive-accent-hover)":"var(--background-modifier-hover)"),du=B.div.withConfig({displayName:"Sidebarstyled__SectionHeader",componentId:"sc-4b9op8-3"})(["display:flex;align-items:center;justify-content:space-between;width:100%;svg{transition:transform 0.2s ease;}"]),hu=B.div.withConfig({displayName:"Sidebarstyled__SidebarContainer",componentId:"sc-4b9op8-4"})(["background:var(--background-primary);position:absolute;height:100%;width:250px;top:0;left:0;z-index:100;border-right:1px solid var(--border-color);box-shadow:2px 0 8px rgba(0,0,0,0.15);transform:translateX(-100%);animation:slideIn 0.3s ease forwards;@keyframes slideIn{to{transform:translateX(0);}}"]),pu=B.div.withConfig({displayName:"Sidebarstyled__SidebarContent",componentId:"sc-4b9op8-5"})(["padding-top:60px;height:100%;overflow-y:auto;"]),gu=B.div.withConfig({displayName:"Sidebarstyled__CollapsibleSection",componentId:"sc-4b9op8-6"})(["overflow:hidden;max-height:",";transition:max-height 0.3s ease;"],t=>t.$expanded?"200px":"0");var Bs=(t=>(t.IMAGES="images",t.PANELS="panels",t))(Bs||{});const mu=()=>{const[t,e]=O(!1),[n,i]=O({images:!1,panels:!1}),o=d=>{i(u=>({...u,[d]:!u[d]}))},[s,r]=an(),l=d=>r(d);return q(()=>{const d=document.querySelector(".izd-settings");d&&d.classList.toggle("sidebar-open",t)},[t]),a(W,{children:[a(cu,{"aria-label":f("cc"),onClick:()=>e(d=>!d),children:a(Pl,{size:18})}),t&&a(W,{children:[a(uu,{onClick:()=>e(!1)}),a(hu,{children:a(pu,{children:[a(Je,{onClick:()=>o(Bs.IMAGES),children:a(du,{children:["Images",n.images?a(Cl,{size:16}):a($l,{size:16})]})}),a(gu,{$expanded:n.images,children:[a(Je,{$nested:!0,$active:["/images/general","/images"].includes(s),onClick:()=>l("/images/general"),children:"General"}),a(Je,{$nested:!0,$active:s==="/images/presets",onClick:()=>l("/images/presets"),children:"Presets"}),a(Je,{$nested:!0,$active:s==="/images/controls",onClick:()=>l("/images/controls"),children:"Controls"})]}),a(Je,{onClick:()=>l("/debug"),$active:s==="/debug",children:"Debug"}),a(Je,{onClick:()=>l("/about"),$active:s==="/about",children:"About"})]})})]})]})},fu=B.div.withConfig({displayName:"Toolbarstyled__ToolbarComponent",componentId:"sc-12wg4bk-0"})(["display:flex;align-items:center;width:100%;justify-content:space-between;margin-top:20px;margin-bottom:40px;"]),vu=()=>{const{plugin:t,forceReload:e,setCurrentPath:n}=se(),[i,o]=an(),s=le(async()=>{n(i),await t.settings.reset(),t.settings.emitter.emit("settings-reset",{eventName:"settings-reset",oldValue:void 0,newValue:void 0}),e(),t.showNotice(f("ca"))},[t,e,n,i]);return a("button",{"aria-label":f("cb"),onClick:s,children:a(xs,{size:18})})},yu=()=>a(fu,{children:[a(mu,{}),a(vu,{})]}),bu=()=>{const[t]=an();return a($c,{children:[a(yu,{}),a(Ec,{children:a(Rs,{location:t,children:[a(Ge,{path:"/images",nest:!0,children:()=>a(lu,{})}),a(Ge,{path:"/debug",children:()=>a(Sc,{})}),a(Ge,{path:"/about",children:()=>a(Cc,{})})]})})]})},wu=()=>{const{reloadCount:t,currentPath:e}=se(),{hook:n}=bc({path:e});return a(Os,{hook:n,children:a(bu,{})},t)},_u=({app:t,plugin:e})=>a(Zl,{app:t,plugin:e,children:a(wu,{})});class xu extends R.PluginSettingTab{constructor(e,n){super(e,n),this.app=e,this.plugin=n,this.containerEl.addClass("izd-settings")}root=void 0;display(){this.plugin.settings.emitter.on("**",e=>{this.plugin.emitter.emit(e.eventName,e)}),this.root=Jt(this.containerEl),this.root.render(a(_u,{app:this.app,plugin:this.plugin}))}hide(){this.plugin.settings.emitter.removeAllListeners(),this.root?.unmount(),this.containerEl.empty()}}const Cu=B.div.withConfig({displayName:"HelpSection__n",componentId:"sc-1ygybyw-0"})(["margin-bottom:24px;&:last-child{margin-bottom:0;}"]),Su=B.h3.withConfig({displayName:"HelpSection__i",componentId:"sc-1ygybyw-1"})(["margin:0 0 12px 0;font-size:16px;font-weight:600;color:var(--text-normal);border-bottom:1px solid var(--background-modifier-border);padding-bottom:8px;"]),$u=B.div.withConfig({displayName:"HelpSection__a",componentId:"sc-1ygybyw-2"})(["color:var(--text-muted);line-height:1.6;p{margin:0 0 12px 0;&:last-child{margin-bottom:0;}}kbd{background:var(--background-modifier-border);border:1px solid var(--background-modifier-border-hover);border-radius:3px;padding:2px 6px;font-size:0.85em;font-family:var(--font-monospace);color:var(--text-normal);}strong{color:var(--text-normal);font-weight:600;}code{background:var(--code-background);padding:2px 4px;border-radius:3px;font-family:var(--font-monospace);font-size:0.9em;}"]),_n=({title:t,children:e})=>a(Cu,{children:[a(Su,{children:t}),a($u,{children:e})]}),ku=B.div.withConfig({displayName:"HelpContent__f",componentId:"sc-1xpaofg-0"})(["margin-bottom:16px;padding:8px 12px;background:var(--background-secondary);border-radius:6px;display:flex;justify-content:space-between;align-items:center;font-size:14px;"]),Eu=B.button.withConfig({displayName:"HelpContent__w",componentId:"sc-1xpaofg-1"})(["padding:4px 8px;border-radius:4px;border:1px solid var(--border-color);background:var(--background-primary);cursor:pointer;&:hover{background:var(--background-modifier-hover);}"]),Nu=B.div.withConfig({displayName:"HelpContent__y",componentId:"sc-1xpaofg-2"})(["display:flex;gap:20px;"]),Pu=B.div.withConfig({displayName:"HelpContent__C",componentId:"sc-1xpaofg-3"})(["flex:0 0 300px;max-height:calc(100vh - 40px);position:sticky;top:20px;overflow:hidden;display:flex;align-items:flex-start;justify-content:center;"]),Iu=B.div.withConfig({displayName:"HelpContent__v",componentId:"sc-1xpaofg-4"})(["flex:1;min-width:0;"]),Un=`
\`\`\`mermaid
graph TD
    A[Start] --> B[Process 1]
    B --> C{Decision}
    C -->|Yes| D[Process 2]
    C -->|No| E[Process 3]
    D --> F[End]
    E --> F
\`\`\`
`,Mu=t=>{const e={};return e.element=t,e.elementType="svg",e.origin="generated",e.mode="preview",e.sourceData={source:Un,lineStart:0,lineEnd:Un.length-1},e},Lu=async(t,e,n)=>{await R.MarkdownRenderer.render(t.plugin.app,Un,e,"",n);const i=e.querySelector("svg");if(i){const o=Mu(i);t.plugin.emitter.emit("create-integrated-element-outside-view",o)}await new Promise(o=>requestAnimationFrame(o))},Du=({onClose:t,mode:e,help:n})=>{const i=pe(null),[o,s]=O(e);return q(()=>{let r=null;return(async()=>i.current&&(r=new R.Component,r.load(),await Lu(n,i.current,r)))(),()=>{r?.unload()}},[n,i]),a(ct,{onClose:t,title:"Image Zoom & Drag Help",height:"100%",width:"100%",children:[a(ku,{children:[a("span",{children:["Help mode: ",o==="full"?"Detailed":"Quick"]}),a(Eu,{onClick:()=>s(o==="full"?"minimal":"full"),children:o==="full"?"Show less":"Show more"})]}),o==="full"&&a(_n,{title:"Picker mode",children:[a("p",{children:"Picker mode allows you to convert any image into both modes mentioned below: integrated and popup."}),a("p",{children:"Works with images 64px+ (smaller ones aren't practical to interact with)"}),a("p",{children:["You can enable picker mode at: Settings \u2192 Image Zoom & Drag Settings \u2192 Images \u2192 General \u2192"," ",a("kbd",{children:"Enable Picker Mode"})]}),a("p",{children:["Activate picker mode: ribbon button on the left or command in command palette:"," ",a("kbd",{children:"Toggle picker mode"})]}),a("p",{children:"This mode allows you to convert any suitable image into integrated or popup modes"}),a("p",{children:"In this mode, the plugin automatically scans the DOM and highlights all suitable images with a light blue dashed outline."}),a("p",{children:[a("kbd",{children:"Click"})," on a suitable image will toggle it to integrated mode"]}),a("p",{children:[a("kbd",{children:"Alt + Click"})," on an integrated image will toggle it to popup mode"]})]}),a(Nu,{children:[a(Iu,{children:a(_n,{title:"Integrated Mode",children:[a("p",{children:"Basic controls:"}),a("p",{children:[a("kbd",{children:"Click"})," - focus on image"]}),a("p",{children:[a("kbd",{children:"Click + Drag"})," - change visual position by dx/dy"]}),a("p",{children:[a("kbd",{children:"Ctrl + Wheel up / down"})," - change diagram scale"]}),a("p",{children:[a("kbd",{children:"Shift + Wheel"})," - move diagram horizontally"]}),a("p",{children:[a("kbd",{children:"Shift + Alt + Wheel"})," - move diagram vertically"]}),a("p",{children:[a("kbd",{children:"Ctrl + ` (backtick)"})," - collapse / expand diagram"]}),a("p",{children:[a("kbd",{children:"Ctrl + Alt + F"})," - switch fullscreen mode"]}),a("p",{children:[a("kbd",{children:"Double click / Double tap"})," - reset position and scale"]}),a("p",{children:[a("kbd",{children:"Arrow keys"})," - move diagram in specified direction"]}),a("p",{children:[a("kbd",{children:"Ctrl + Minus"})," - zoom out"]}),a("p",{children:[a("kbd",{children:"Ctrl + Plus"})," - zoom in"]}),a("p",{children:[a("kbd",{children:"Ctrl + 0"})," - reset scale"]}),a("p",{children:[a("kbd",{children:"Right click"})," - open context menu"]}),o==="full"&&a(W,{children:[a("p",{children:"Integrated mode is the default mode for interactive images in your notes."}),a("p",{children:"By default, the plugin only works with auto-generated diagrams (Mermaid, PlantUML, etc.) that match built-in presets."}),a("p",{children:"To enable for regular images: Obsidian Settings \u2192 Plugins \u2192 Image Zoom & Drag Settings \u2192 Images \u2192 Presets \u2192 IMG_SVG."}),a("p",{children:'Enable the "IMG_SVG" preset to make all images interactive, not just diagrams.'}),a("p",{children:"An image that becomes interactive gets extended capabilities: zoom, drag, etc."}),a("p",{children:"Doesn't affect performance - all images are cleaned up when closing the note."}),a("p",{children:"Besides basic functions, you can enable control panels on images."}),a("p",{children:"Control panels available: zoom, movement, collapse/expand and fullscreen mode."}),a("p",{children:"Disabled by default."}),a("p",{children:"Enable for all diagrams: Settings \u2192 Images \u2192 Controls."}),a("p",{children:"Configure for specific type: Settings \u2192 Images \u2192 Presets."})]})]})}),a(Pu,{ref:i})]}),o==="full"&&a(_n,{title:"Popup mode",children:[a("p",{children:"Popup mode displays images in a fullscreen overlay window."}),a("p",{children:"Three ways to open popup:"}),a("p",{children:"\u2022 Alt + Click in picker mode"}),a("p",{children:"\u2022 Through image context menu"}),a("p",{children:"\u2022 Note panel button (for all images in the note)"}),a("p",{children:["Controls: ",a("kbd",{children:"Wheel"})," - zoom,"," ",a("kbd",{children:"Click + Drag"})," - pan"]}),a("p",{children:"Popup mode supports working with multiple images simultaneously"}),a("p",{children:"Close popup with Esc key or the close button in the top right corner"}),a("p",{children:"You can minimize the popup by clicking the minimize button next to the close button. It collapses to a floating button in the bottom right corner"}),a("p",{children:"The button shows the number of open images and can be moved anywhere."}),a("p",{children:"Switch between images: click any image in the gallery at the bottom of the screen."}),a("p",{children:"Limitation: works only with regular images (PNG, JPG). SVG support is planned for future versions."})]})]})},Au=({mode:t,onClose:e,help:n})=>a(Du,{help:n,mode:t,onClose:e});class Tu extends R.Component{constructor(e){super(),this.plugin=e}rootDiv=null;root=null;isHelpOpen=!1;onload(){this.plugin.userState.isFirstLaunch&&this.plugin.showInteractiveNotice("New to Image Zoom & Drag? Click here for quick start guide (auto-hide in 1 min)",()=>{this.showModal("full")},6e4),this.setupCommands()}showModal(e){this.closeModal(),this.rootDiv??=document.createElement("div"),this.root=Jt(this.rootDiv),this.root.render(a(Au,{help:this,mode:e,onClose:()=>this.closeModal()})),this.isHelpOpen=!0}closeModal(){this.root?.unmount(),this.rootDiv?.remove(),this.isHelpOpen=!1}onunload(){this.closeModal()}setupCommands(){this.plugin.addCommand({id:"open-help-guide",name:"Open help guide",callback:()=>this.showModal("full")})}}class Ou{constructor(e){this.plugin=e,this.storageKey=`${e.manifest.id}-logs`,this.checkStorageAvailability()}maxEntries=2e3;isStorageAvailable=!0;async init(){await this.ensureLogsDirExists(),this.plugin.settings.$.debug.enabled&&await this.writeSystemInfo()}async saveLogsToFile(e){try{const n=`logs-${R.moment().format("YYYY-MM-DD HH:mm:ss")}.json`,i=R.normalizePath(`${this.logsDir}/${n}`);await this.plugin.app.vault.adapter.write(i,e),await this.rotateLogFiles(this.logsDir)}catch(n){console.error("Image Zoom & Drag: Error in the file:",n)}}async ensureLogsDirExists(){const e=this.plugin.manifest.dir;if(e===void 0)throw new Error(`Image Zoom & Drag: It was not possible to get the way to the plugin. Path:${e}`);this.logsDir=R.normalizePath(`${e}/logs`),!await this.plugin.app.vault.adapter.exists(this.logsDir)&&await this.plugin.app.vault.adapter.mkdir(this.logsDir)}async rotateLogFiles(e){try{const n=await this.plugin.app.vault.adapter.list(e),i=R.moment().unix()*1e3,o=10080*60*1e3;for(const s of n.files){if(!s.endsWith(".json"))continue;const r=`${e}/${s}`,l=await this.plugin.app.vault.adapter.stat(r);l&&i-l.mtime>o&&(await this.plugin.app.vault.adapter.remove(r),console.log(`Image Zoom & Drag: Remove the old log-file${s}`))}}catch(n){console.error("Image Zoom & Drag: Log Rotation Error:",n)}}getObsidianVersion(){const e=document.title.match(/Obsidian v([\d.]+)/);return e?e[1]:"unknown"}async writeSystemInfo(){const e=this.getSystemInfo();this.addLogEntry(e)}getSystemInfo(){return{timestamp:R.moment().toISOString(),session_start:!0,obsidian:{version:this.getObsidianVersion(),title:document.title,enabledPlugins_count:this.plugin.app.plugins.enabledPlugins.size,enabledPlugins_list:Array.from(this.plugin.app.plugins.enabledPlugins),vault_name:this.plugin.app.vault.getName(),is_mobile:R.Platform.isMobile,is_desktop:R.Platform.isDesktopApp},system:{platform:this.getPlatformInfo(),userAgent:navigator.userAgent,language:navigator.language,screen_resolution:`${screen.width}x${screen.height}`,viewport_size:`${window.innerWidth}x${window.innerHeight}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,online_status:navigator.onLine,cpu_cores:navigator.hardwareConcurrency||"unknown",device_memory:navigator.deviceMemory||"unknown",connection_type:navigator.connection?.effectiveType||"unknown"},plugin:{name:this.plugin.manifest.name,version:this.plugin.manifest.version,minAppVersion:this.plugin.manifest.minAppVersion,id:this.plugin.manifest.id,author:this.plugin.manifest.author,description:this.plugin.manifest.description},performance:{memory_used:performance.memory?.usedJSHeapSize||"unknown",memory_total:performance.memory?.totalJSHeapSize||"unknown",memory_limit:performance.memory?.jsHeapSizeLimit||"unknown",load_time:performance.now()},storage:{localStorage_usage:this.getStorageUsage()}}}getShortSystemInfo(){return{timestamp:R.moment().toISOString(),obsidian:{version:this.getObsidianVersion(),vault_name:this.plugin.app.vault.getName(),is_mobile:R.Platform.isMobile},system:{platform:this.getPlatformInfo(),language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},plugin:{name:this.plugin.manifest.name,version:this.plugin.manifest.version,id:this.plugin.manifest.id}}}getPlatformInfo(){return"userAgentData"in navigator?navigator.userAgentData.platform??"unknown":navigator.platform??"unknown"}getStorageUsage(){try{const e=localStorage.getItem(this.storageKey);return e?`${((e.length+this.storageKey.length)/1024).toFixed(2)} KB`:"0 B"}catch{return"unknown"}}checkStorageAvailability(){try{localStorage.setItem("test","test"),localStorage.removeItem("test")}catch{this.isStorageAvailable=!1,console.warn("Image Zoom & Drag: Localstorage is not available")}}addLogEntry(e){if(this.isStorageAvailable)try{const n=this.getAllLogs();n.push(e),n.length>this.maxEntries&&n.splice(0,n.length-this.maxEntries),localStorage.setItem(this.storageKey,JSON.stringify(n)),this.plugin.emitter.emit("logs-changed",{storage:this.getStorageUsage(),entries:this.getAllLogs().length})}catch(n){console.error("Logger: \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u043F\u0438\u0441\u0438 \u0432 localStorage:",n),this.isStorageAvailable=!1}}getAllLogs(){const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):[]}log(e,n,i){if(!this.plugin.settings.$.debug.enabled)return;const o={timestamp:new Date().toISOString(),level:e,message:n,context:i};this.addLogEntry(o)}shouldLog(e){const n=["none","debug","info","warn","error"],i=this.plugin.settings.$.debug.level;if(i==="none")return!1;const o=n.indexOf(e.toLowerCase()),s=n.indexOf(i);return o>=s}debug(e,n){this.shouldLog("debug")&&this.log("DEBUG",e,n)}info(e,n){this.shouldLog("info")&&this.log("INFO",e,n)}warn(e,n){this.shouldLog("warn")&&this.log("WARNING",e,n)}error(e,n){this.shouldLog("error")&&this.log("ERROR",e,n)}exportLogs(){const e=this.getAllLogs();if(e.length===0)return"";const n=e.filter(s=>s.session_start),i=e.filter(s=>!s.session_start);let o=`=== SYSTEM INFO ===
`;return n.forEach(s=>{o+=JSON.stringify(s,null,2)+`

`}),o+=`
=== LOGS ===
`,i.forEach(s=>{const r=new Date(s.timestamp).toLocaleTimeString(),l=s.context,d=l?.file?`${l.file}:${l.lineNumber}${l.functionName?` (${l.functionName})`:""}`:"unknown";o+=`[${r}] ${s.level.toUpperCase().padEnd(5)} | ${d}
`,o+=`  ${s.message}
`;const u={...l};delete u.file,delete u.lineNumber,delete u.columnNumber,delete u.functionName,Object.keys(u).length>0&&(o+=`  Context: ${JSON.stringify(u)}
`),o+=`
`}),o}clearAllLogs(){localStorage.removeItem(this.storageKey),this.plugin.emitter.emit("logs-changed",{storage:this.getStorageUsage(),entries:this.getAllLogs().length})}}class zu extends R.Plugin{async onload(){await this.initialize(),this.logger.info("Plugin loaded successfully",{functionName:"onload",lineNumber:39,columnNumber:1202,fileName:"src\\core\\izd-plugin.ts"})}async onunload(){super.onunload(),this.emitter.removeAllListeners(),this.logger.info("Plugin unloaded successfully",{functionName:"onunload",lineNumber:46,columnNumber:1482,fileName:"src\\core\\izd-plugin.ts"})}async initialize(){await this.initializeCore(),await this.initializeServices(),await this.initializeUI()}async initializeCore(){await Zs,this.settings=new ql(this),this.addChild(this.settings),await this.settings.load(),this.addSettingTab(new xu(this.app,this)),this.emitter=new Ss({wildcard:!0,delimiter:"."})}async initializeUI(){this.pickerMode=new Jr(this),this.integratedMode=new Xr(this),this.popupMode=new Gl(this),this.pickerMode.initialize(),this.integratedMode.initialize(),this.popupMode.initialize(),this.addChild(this.pickerMode),this.addChild(this.integratedMode),this.addChild(this.popupMode)}async initializeServices(){this.leafIndex=new Ys(this),this.addChild(this.leafIndex),this.domWatcher=new Gs,this.addChild(this.domWatcher),this.logger=new Ou(this),await this.logger.init(),this.userState=new Ks(this),await this.userState.initialize(),this.help=new Tu(this),this.addChild(this.help)}showNotice(e,n){this.noticeEl?.remove();const i=new R.Notice(e,n);this.noticeEl=i.containerEl}showInteractiveNotice(e,n,i){this.showNotice(e,i),this.noticeEl?.addEventListener("click",n,{once:!0})}}const Hs={a:"Picker mode is disabled",b:"Control panels hidden",c:"No active images found",d:"This command can only be used when a markdown note is open.",e:"Control panels shown",f:"Fold",g:"Expand",h:"Fold",i:"Move down",j:"Move down left",k:"Move down right",l:"Move left",m:"Move",n:"Move right",o:"Move up",p:"Move up left",q:"Move up right",r:"Fullscreen",s:"Open in fullscreen mode",t:"Exit fullscreen mode",u:"Show panels",v:"Panel Visibility",w:"Hide panels",x:"Service",y:"Zoom in",z:"Zoom",A:"Zoom out",B:"Reset zoom and position",C:"Cannot initialize this image. Consult for docs for more info",D:"Activate interactive mode",E:"Deactivate interactive mode",F:"Picker mode disabled",G:`Picker mode enabled
Click on image to toggle interactive mode
Alt + click on image to open in in Popup viewer
Press Esc to exit`,H:"Go to GitHub page of this plugin",I:"GitHub page",J:["Exported logs contain:","\u2022 Complete system information (OS, hardware, plugins)","\u2022 Debug events with timestamps","\u2022 Performance metrics","Review logs before sharing - remove sensitive data if needed."],K:"About exported logs",L:"Clear logs storage",M:"Storage: {{storage}}, Entries: {{entries}}",N:"Clear logs storage",O:"Logs storage was cleared",P:"Copy logs to clipboard",Q:"Copy logs",R:"No logs data found",S:"Logs was copied to clipboard",T:"Enable debug logging for troubleshooting",U:"Enable logging",V:"Export logs",W:"Export logs",X:"Set minimum log level to display",Y:"Log level",Z:["If you encounter any issues or have suggestions, please report them on GitHub.","How to report an issue:","1. Enable debug logging below and set level to `Debug`.","Warning: This may impact performance temporarily.","2. Reproduce the issue with logging enabled.","3. Export logs using the button below.","4. Click `Report an issue` and fill out the form.","5. Attach the exported log file.","6. Submit the issue."],_:"Report an issue",$:"Report an issue",aa:"Service panel will always be visible regardless of visibility mode",ab:"Ignore controls visibility rule for service panel",ac:"Set when panels will be visible",ad:"Always",ae:"On focus",af:"On hover",ag:"Controls visibility",ah:"Controls stay visible when enabled (globally and per preset)",ai:"Controls appear when image is clicked",aj:"Controls appear on hover",ak:"Automatically fold images on focus change",al:"Fold images by default",am:"Fold",an:"When enabled, the plugin will automatically scan and prepare all suitable images for potential interactivity.",ao:"Auto-detect images",ap:"Interactivity options",aq:["Adds a ribbon button and command palette entry for toggling picker mode.","When activated, hover over images/SVG elements to see availability status, then click to initialize or toggle interactivity."],ar:"Enable picker mode",as:["Set the container dimensions for expanded state."],at:"Expanded image container size",au:["Set the container dimensions for folded state."],av:"Folded image container size",aw:"Image size",ax:"Height:",ay:"Width:",az:"Save changes",aA:"Please fix validation errors",aB:"Invalid height. Please enter number in range {{range}}.",aC:"Invalid width. Please enter number in range {{range}}.",aD:"Nothing to save",aE:"Saved successfully",aF:"Configure which buttons are shown on each panel",aG:"Full",aH:"Minimal",aI:"Presentation mode",aJ:"Quick presets",aK:"Buttons layout",aL:"Buttons layout",aM:"Open control buttons layout editor",aN:"Change where controls appear and when they show",aO:["\u2022 Move Panel: Arrow buttons to move the image around","\u2022 Zoom Panel: Zoom in, zoom out, and reset to original size","\u2022 Service Panel: Extra tools and options"],aP:"Available panels",aQ:["1. Use checkboxes below to toggle panel visibility on/off","2. Click and drag any panel to reposition it on the image","3. Panel positions are saved automatically","4. Close and reopen the note to see your changes to see your changes take effect"],aR:"How to customize panels",aS:"Customize control panels appearance and position",aT:"Panel configuration",aU:"Controls layout",aV:"Controls layout",aW:"Open controls layout editor",aX:["Add new image preset to override default settings for specific images.","Name: any UTF-8 characters allowed","Selector: CSS selector for target images"],aY:"Add new image preset",aZ:"New image preset was added",a_:"Example preset name",a$:".example-preset-selector",ba:"Click for more information on how the plugin works",bb:"Add this preset",bc:`Add image preset
Name: {{name}}
Selector: {{selector}}`,bd:"Selectors are only needed for specific behavior overrides. For example, to disable UI panels for SVG inside Mermaid diagrams.",be:"Custom selectors (optional)",bf:["1. Open DevTools (Ctrl+Shift+I)","2. Use element selector (Ctrl+Shift+C)","3. Click on the specific element you want to customize","4. Find the class attribute: `.mermaid`, `.block-language-plantuml`, etc.","5. Use this selector to create specific settings overrides"],bg:"Finding selectors (when needed):",bh:"User Guide",bi:["The plugin automatically processes all images and SVG elements in your markdown files.","In auto-detect mode, it finds all suitable images and makes them interactive","In picker mode, hover over any image and click to make it interactive with zoom, drag, and control panels."],bj:"How this plugin works",bk:"Video failed to load. Please try again later.",bl:"Loading video...",bm:["\u2022 Auto-detect: Plugin automatically finds and processes all images","\u2022 Picker toggle: Hover over images and click to activate interaction","\u2022 Use ribbon button or command palette to toggle picker mode"],bn:"Working modes",bo:"Available image presets",bp:'name: "{{old}}" \u2192 "{{new}}"',bq:'selector: "{{old}}" \u2192 "{{new}}"',br:"Delete preset\n`Name: {{name}}\nSelector: {{selector}}`",bs:"Disable {{name}} preset",bt:`Edit preset "{{name}}":
{{changes}}`,bu:"Enable {{name}} preset",bv:"Cancel operation? All changes will be lost.",bw:"Delete {{name}} preset",bx:"Edit {{name}} preset",by:"Options for {{name}} preset",bz:"Save changes for {{name}}?",bA:"Disable {{name}} preset",bB:"Enable {{name}} preset",bC:"These settings will only apply to this preset.",bD:"{{name}} preset options",bE:"Turn {{state}} panel `{{panel}}` for preset `{{name}}`",bF:"Panels",bG:"off",bH:"on",bI:"Can`t change page while editing",bJ:"No next page",bK:"Go to next page",bL:"No previous page",bM:"Go to previous page",bN:"{{current}}/{{total}} \u2022 {{count}}",bO:"Image presets per page",bP:"Nothing to redo",bQ:"Nothing to undo",bR:`Redo
{{description}}{{count}}
Shortcut: CTRL+SHIFT+Z`,bS:`Nothing to redo
Shortcut: CTRL+SHIFT+Z`,bT:`Undo
{{description}}{{count}}
Shortcut: CTRL+Z`,bU:`Nothing to undo
Shortcut: CTRL+Z`,bV:"Preset name and selector are both invalid",bW:"Fill out preset {{field}} field!",bX:"Invalid CSS selector: {{err}}",bY:"Preset with that name already exists",bZ:"Nothing to save",b_:"Preset {{field}} is invalid",b$:"Preset with that selector already exists",ca:"Settings have been reset to default.",cb:"Reset settings to default",cc:"Toggle sidebar"},jn={en:Hs};function Vs(){const t=R.moment.locale(),e=t in jn?t:"en";return jn[e]}const Ru=Vs();function Fu(t){return Ru[t]??Hs[t]??`[missing: ${t}]`}var Uu=Object.freeze({__proto__:null,initLocale:Vs,locales:jn,t:Fu});module.exports=zu;
/* End of bundle */

/* nosourcemap */