ğŸ”‘ 1ï¸âƒ£ Who Generates What

|Item|Generated By|Stored By|Visibility|
|---|---|---|---|
|**code_verifier**|**Client** (random, secret)|Client only|âŒ Not sent to anyone until the `/token` request|
|**code_challenge**|**Client** (from SHA256(verifier))|Client + Authorization Server|âœ… Sent to Auth Server in `/authorize` query|
|**authorization_code**|**Authorization Server**|Authorization Server + Client (via redirect)|âœ… Sent via browser redirect (query param)|

So:

- The **client** creates the PKCE pair (`verifier`, `challenge`).
- The **auth server** never sees the verifier until the final `/token` request.
- The **authorization code** is a short-lived, random one-time value generated by the **authorization server** after the user logs in.
    

---

## ğŸ” 2ï¸âƒ£ Are These â€œSecureâ€?

### ğŸ”¸ Authorization Code

- **Visible** in browser redirect (e.g., `?code=abc123`).
- Thatâ€™s fine because:
    - Itâ€™s **short-lived** (30â€“60 seconds).
    - Itâ€™s **bound to the PKCE challenge**.
    - It can only be exchanged **once** and **only by the same client** that sent the original `challenge`.
- So even if someone sees it (e.g., browser history, proxy), itâ€™s useless without the verifier.
    

### ğŸ”¸ PKCE Code Challenge
- Also **visible** (in the `/authorize` request).
    
- Thatâ€™s fine too â€” itâ€™s a **hash** of the verifier.
    - You canâ€™t derive the verifier (`v`) from the challenge (`c = SHA256(v)`).    
    - So itâ€™s a one-way binding        

### ğŸ”¸ PKCE Code Verifier
- **Secret**, never appears in any redirect.
- Only sent directly from client â†’ auth server at `/token`.
- Thatâ€™s the â€œproofâ€ step.
    

---

## ğŸ§­ 3ï¸âƒ£ The Login Screen â€” Who Owns It?

When youâ€™re redirected to login (e.g., Keycloak login page), youâ€™re **actually at the Authorization Server**, not your client app.

Example:
Client app: https://app.example.com/
Auth Server (Keycloak): https://auth.example.com/auth



|Concept|Where It Lives|Who Sees It|Purpose|
|---|---|---|---|
|`code_verifier`|Client memory|Only client|Secret proof for PKCE|
|`code_challenge`|Query param to auth server|Public|One-way hash of verifier|
|`authorization_code`|Query param redirect|Client + anyone in redirect chain|Temporary handle for tokens|
|**Login Screen**|Hosted by Authorization Server (Keycloak)|User interacts via browser|Handles authentication|