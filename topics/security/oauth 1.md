## ğŸ”‘ 1ï¸âƒ£ Authentication vs Authorization

| Concept            | Meaning                                                                      | Who handles it                             |
| ------------------ | ---------------------------------------------------------------------------- | ------------------------------------------ |
| **Authentication** | Verifying **who** the user is (login, password, MFA)                         | **Authorization Server (IdP)**             |
| **Authorization**  | Deciding **what** the client/app is allowed to access on behalf of that user | **Authorization Server + Resource Server** |
In OAuth2/OIDC:

- **Authentication** = user proves identity to the **Authorization Server** (e.g., via login form).
    
- **Authorization** = user (resource owner) grants **the client** permission (scopes) to act on their behalf.

## Who generates What

|Item|Generated By|Stored By|Visibility|
|---|---|---|---|
|**code_verifier**|**Client** (random, secret)|Client only|âŒ Not sent to anyone until the `/token` request|
|**code_challenge**|**Client** (from SHA256(verifier))|Client + Authorization Server|âœ… Sent to Auth Server in `/authorize` query|
|**authorization_code**|**Authorization Server**|Authorization Server + Client (via redirect)|âœ… Sent via browser redirect (query param)|

---

## ğŸ” 2ï¸âƒ£ Where Authentication Happens

- The **userâ€™s credentials (username/password, MFA, etc.)** are **never sent to the client app**.
    
- They go **only to the Authorization Server**, over **TLS**.
    
- The **client app never sees the userâ€™s password** â€” thatâ€™s the _whole point_ of OAuth.
    

So yes:

> â€œThe user and pw is just encrypted via TLS to the auth serverâ€

âœ… Correct â€” thatâ€™s the authentication step.

---

## ğŸ”„ 3ï¸âƒ£ Where Authorization Happens

- After login, the user is shown a **consent page**:  
    â€œThis app wants to read your profile, email, and calendar. Allow?â€
    
- When the user clicks â€œAllow,â€ they are **granting authorization** to the client for specific scopes.
    

At that point, the **Authorization Server**:

- Issues an **Authorization Code** â†’ given to the client.
    
- That code represents â€œUser X granted App Y permission Z.â€
    

---

## ğŸ§© 4ï¸âƒ£ Why Auth Code + PKCE Exists

Itâ€™s a **security wrapper** to protect the authorization process.

Without it, an attacker could:

- Intercept or replay tokens,
    
- Steal an authorization code from redirect URIs.
    

PKCE fixes that by **binding the authorization code to the client** using a challenge/verifier pair.

So:

- Auth Code = temporary proof that the user logged in + consented.
    
- PKCE = ensures only the original client can exchange that code for tokens.
    

---

## ğŸ« 5ï¸âƒ£ Where JWT Fits

- Once the client exchanges the **authorization code** at `/token`, it receives:
    
    - **Access Token (JWT)** â†’ used for API access (authorization).
        
    - **ID Token (JWT)** â†’ describes the userâ€™s identity (authentication).
        
    - **Refresh Token** â†’ allows new access tokens later.
        

These JWTs **contain claims** like:


## ğŸ§­ 6ï¸âƒ£ Why Browser Redirects Exist

Because:

- The **Authorization Server** needs the userâ€™s interaction (login + consent UI).
    
- The **Client App** must not handle the credentials directly.
    
- The browser (user-agent) mediates between them.
    

**Browser flow:**


| Step                    | What Happens                      | Who Talks                          |
| ----------------------- | --------------------------------- | ---------------------------------- |
| 1. Authentication       | User enters credentials           | User â†” Auth Server (TLS)           |
| 2. Authorization        | User consents to client scopes    | User â†” Auth Server                 |
| 3. Auth Code issued     | Proof of login+consent            | Auth Server â†’ Client (via browser) |
| 4. PKCE verifies client | Prevents stolen code use          | Client â†” Auth Server               |
| 5. Tokens issued        | JWTs = results of login & consent | Auth Server â†’ Client               |
| 6. Resource access      | Client uses JWT to call API       | Client â†” Resource Server           |